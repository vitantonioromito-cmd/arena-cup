<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Arena Cup</title>
    
    <!-- PWA METADATA -->
    <meta name="theme-color" content="#1a1a2e"/>
    <meta name="description" content="App per la gestione del torneo di calcetto Arena Cup">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="ArenaCup">
    
    <!-- ICONE iOS -->
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 180 180'><rect width='180' height='180' fill='%23121212'/><text x='50%' y='60%' font-size='100' text-anchor='middle' fill='%234CAF50'>‚öΩ</text></svg>">
    
    <!-- NOTIFICHE PUSH MIGLIORATE -->
    <script src="https://cdn.jsdelivr.net/npm/push.js@1.0.12/bin/push.min.js"></script>
    
    <!-- EXTERNAL LIBRARIES -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    
    <style>
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
            -webkit-tap-highlight-color: transparent;
        }
        
        body { 
            background: linear-gradient(135deg, #121212 0%, #1a1a2e 100%); 
            min-height: 100vh;
            min-height: -webkit-fill-available;
            color: white;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        }
        
        html {
            height: -webkit-fill-available;
        }
        
        #root { 
            min-height: 100vh;
            min-height: -webkit-fill-available;
        }
        
        .app-container {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        /* STILI LOGIN CORRETTI */
        .login-container {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .login-form {
            text-align: center;
            background: rgba(255,255,255,0.1);
            padding: 40px 30px;
            border-radius: 20px;
            max-width: 400px;
            width: 100%;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .login-input {
            padding: 15px;
            font-size: 16px;
            margin-bottom: 15px;
            width: 100%;
            border-radius: 12px;
            border: 2px solid transparent;
            background: rgba(255,255,255,0.95);
            color: #000;
            transition: all 0.3s ease;
        }
        
        .login-input:focus {
            outline: none;
            border-color: #4CAF50;
            background: white;
        }
        
        .login-button {
            padding: 15px 30px;
            font-size: 16px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-weight: bold;
            width: 100%;
            transition: all 0.3s ease;
        }
        
        .login-button:hover {
            background: #45a049;
            transform: translateY(-2px);
        }
        
        .login-button:active {
            transform: translateY(0);
        }
        
        .password-hint {
            color: #FFD700;
            font-size: 0.8rem;
            margin-top: 10px;
        }

        .app-header {
            background: rgba(26, 26, 46, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255,255,255,0.1);
            padding: 15px 20px;
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        .app-content {
            flex: 1;
            padding: 20px;
            padding-bottom: 80px;
        }
        
        .app-bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(26, 26, 46, 0.95);
            backdrop-filter: blur(10px);
            border-top: 1px solid rgba(255,255,255,0.1);
            display: flex;
            padding: 10px;
            z-index: 1000;
        }
        
        .nav-button {
            flex: 1;
            padding: 12px 5px;
            background: transparent;
            color: rgba(255,255,255,0.7);
            border: none;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.8rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            transition: all 0.3s ease;
            border-radius: 10px;
            position: relative;
        }
        
        .nav-button.active {
            color: #4CAF50;
            background: rgba(76, 175, 80, 0.1);
        }
        
        .nav-button .icon {
            font-size: 1.2rem;
        }
        
        /* NOTIFICHE BADGE - STILE WHATSAPP */
        .notification-badge {
            position: absolute;
            top: 5px;
            right: 20%;
            background: #ff4444;
            color: white;
            border-radius: 50%;
            min-width: 18px;
            height: 18px;
            font-size: 0.7rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: pulse 1.5s infinite;
            box-shadow: 0 2px 8px rgba(255, 68, 68, 0.4);
            border: 2px solid rgba(26, 26, 46, 0.95);
        }
        
        .notification-badge.small {
            min-width: 8px;
            height: 8px;
            font-size: 0;
            right: 25%;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .stats-grid { 
            display: grid; 
            grid-template-columns: repeat(2, 1fr); 
            gap: 12px; 
            margin: 20px 0; 
        }
        
        .stat-card { 
            background: rgba(255,255,255,0.1); 
            padding: 20px; 
            border-radius: 15px; 
            text-align: center;
            backdrop-filter: blur(10px);
        }
        
        .player-card { 
            background: rgba(255,255,255,0.05); 
            padding: 15px; 
            border-radius: 12px; 
            margin: 10px 0; 
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .player-card.current-user { 
            background: rgba(76, 175, 80, 0.2); 
            border: 2px solid #4CAF50; 
            box-shadow: 0 0 20px rgba(76, 175, 80, 0.3);
        }
        
        .match-card { 
            background: rgba(255,255,255,0.1); 
            padding: 20px; 
            border-radius: 15px; 
            margin: 15px 0;
            backdrop-filter: blur(10px);
        }
        
        .message-bubble { 
            margin-bottom: 15px; 
            padding: 15px; 
            background: rgba(255,255,255,0.1); 
            border-radius: 15px; 
            border-left: 4px solid #2196F3;
            backdrop-filter: blur(10px);
        }
        
        .own-message { 
            background: rgba(76, 175, 80, 0.2); 
            border-left: 4px solid #4CAF50; 
        }
        
        .admin-message { 
            background: rgba(255, 193, 7, 0.2); 
            border-left: 4px solid #FFC107; 
        }
        
        /* STILI PAGELLE MIGLIORATI */
        .pagella-card {
            background: rgba(255,255,255,0.05);
            padding: 20px;
            border-radius: 15px;
            margin: 15px 0;
            border: 1px solid rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
        }
        
        .pagella-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .pagella-giocatore {
            font-size: 1.2rem;
            font-weight: bold;
            color: #4CAF50;
        }
        
        .pagella-data {
            font-size: 0.8rem;
            color: #ccc;
        }
        
        .pagella-voto {
            background: rgba(255, 193, 7, 0.2);
            color: #FFC107;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 1.1rem;
            border: 1px solid rgba(255, 193, 7, 0.3);
        }
        
        .pagella-commento {
            background: rgba(255,255,255,0.05);
            padding: 15px;
            border-radius: 10px;
            margin-top: 10px;
            border-left: 3px solid #2196F3;
            font-style: italic;
        }
        
        .pagella-form {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            backdrop-filter: blur(10px);
        }
        
        .voto-select {
            background: rgba(255,255,255,0.9);
            color: #000;
            border: none;
            padding: 10px;
            border-radius: 8px;
            font-size: 1rem;
            margin-right: 10px;
        }
        
        .giocatore-select {
            background: rgba(255,255,255,0.9);
            color: #000;
            border: none;
            padding: 10px;
            border-radius: 8px;
            font-size: 1rem;
            margin-right: 10px;
            min-width: 150px;
        }
        
        .fazione-select {
            background: rgba(255,255,255,0.9);
            color: #000;
            border: none;
            padding: 10px;
            border-radius: 8px;
            font-size: 1rem;
            margin-right: 10px;
            min-width: 150px;
        }
        
        .pagella-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        /* STILI FAZIONI CORRETTI - SOLO BIANCA/NERA/ROSSA */
        .fazione-bianca {
            border-left: 4px solid #ffffff;
            background: rgba(255, 255, 255, 0.1);
        }
        
        .fazione-nera {
            border-left: 4px solid #000000;
            background: rgba(0, 0, 0, 0.2);
        }
        
        .fazione-rossa {
            border-left: 4px solid #ff4444;
            background: rgba(255, 68, 68, 0.1);
        }
        
        .badge-fazione {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: bold;
            margin-left: 8px;
        }
        
        .badge-bianca {
            background: white;
            color: black;
            border: 1px solid #ccc;
        }
        
        .badge-nera {
            background: black;
            color: white;
            border: 1px solid #333;
        }
        
        .badge-rossa {
            background: #ff4444;
            color: white;
            border: 1px solid #cc0000;
        }

        /* MODIFICA PAGELLA */
        .modifica-pagella-form {
            background: rgba(255, 193, 7, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin-top: 10px;
            border: 1px solid rgba(255, 193, 7, 0.3);
        }

        .modifica-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        /* CLASSIFICHE STYLES */
        .classifica-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .classifica-card {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .classifica-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .classifica-item:last-child {
            border-bottom: none;
        }
        
        .classifica-pos {
            font-weight: bold;
            font-size: 1.1rem;
            width: 30px;
            text-align: center;
        }
        
        .classifica-pos.oro { 
            background: linear-gradient(135deg, #FFD700, #FFC107);
            color: black;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .classifica-pos.argento { 
            background: linear-gradient(135deg, #C0C0C0, #E0E0E0);
            color: black;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .classifica-pos.bronzo { 
            background: linear-gradient(135deg, #CD7F32, #B08D57);
            color: white;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .classifica-nome {
            flex: 1;
            margin: 0 15px;
        }
        
        .classifica-valore {
            font-weight: bold;
            font-size: 1.1rem;
            color: #4CAF50;
        }
        
        /* MVP STYLES */
        .mvp-badge {
            background: linear-gradient(135deg, #FFD700, #FFC107);
            color: #000;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: bold;
            margin-left: 8px;
            animation: glow-gold 2s infinite;
        }
        
        @keyframes glow-gold {
            0% { box-shadow: 0 0 5px #FFD700; }
            50% { box-shadow: 0 0 15px #FFD700; }
            100% { box-shadow: 0 0 5px #FFD700; }
        }
        
        /* BENJI PRICE STYLES */
        .benji-price-badge {
            background: linear-gradient(135deg, #0096FF, #00D4FF);
            color: white;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: bold;
            margin-left: 8px;
            animation: glow-blue 2s infinite;
        }
        
        @keyframes glow-blue {
            0% { box-shadow: 0 0 5px #0096FF; }
            50% { box-shadow: 0 0 15px #0096FF; }
            100% { box-shadow: 0 0 5px #0096FF; }
        }

        /* PRESENZE BADGE */
        .presenze-badge {
            background: linear-gradient(135deg, #9C27B0, #E91E63);
            color: white;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: bold;
            margin-left: 8px;
            animation: glow-purple 2s infinite;
        }
        
        @keyframes glow-purple {
            0% { box-shadow: 0 0 5px #9C27B0; }
            50% { box-shadow: 0 0 15px #9C27B0; }
            100% { box-shadow: 0 0 5px #9C27B0; }
        }
        
        .mvp-stats {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            flex-wrap: wrap;
        }
        
        .mvp-stat {
            background: rgba(255, 193, 7, 0.2);
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid rgba(255, 193, 7, 0.3);
            font-size: 0.8rem;
        }
        
        /* INPUT NEGATIVI */
        .number-input {
            background: rgba(255,255,255,0.9);
            color: #000;
            border: none;
            padding: 8px;
            border-radius: 5px;
            width: 70px;
            text-align: center;
            font-size: 14px;
        }
        
        .number-input.negative {
            background: rgba(244, 67, 54, 0.2);
            color: #F44336;
            border: 1px solid rgba(244, 67, 54, 0.5);
        }
        
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #888;
        }
        
        .empty-state .icon {
            font-size: 3rem;
            margin-bottom: 15px;
            opacity: 0.5;
        }
        
        /* NOTIFICATION SETTINGS */
        .notification-settings {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 12px;
            margin: 15px 0;
            backdrop-filter: blur(10px);
        }
        
        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .setting-item:last-child {
            border-bottom: none;
        }
        
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }
        
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background-color: #4CAF50;
        }
        
        input:checked + .slider:before {
            transform: translateX(26px);
        }
        
        input, button, textarea { 
            padding: 15px; 
            border-radius: 12px; 
            border: none; 
            margin: 5px; 
            font-size: 16px;
        }
        
        input, textarea {
            background: rgba(255,255,255,0.9);
            color: #000;
            width: 100%;
        }
        
        textarea {
            min-height: 100px;
            resize: vertical;
            font-family: inherit;
        }
        
        button { 
            cursor: pointer; 
            font-weight: bold;
        }
        
        .current-user-badge {
            background: #4CAF50;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.7rem;
            margin-left: 10px;
            font-weight: bold;
            animation: glow 2s infinite;
        }
        
        @keyframes glow {
            0% { box-shadow: 0 0 5px #4CAF50; }
            50% { box-shadow: 0 0 15px #4CAF50; }
            100% { box-shadow: 0 0 5px #4CAF50; }
        }
        
        .confermato-list {
            margin-top: 10px;
        }
        
        .confermato-item {
            padding: 8px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .confermato-item.current-user {
            background: rgba(76, 175, 80, 0.3);
            padding: 10px;
            border-radius: 8px;
            font-weight: bold;
            border-left: 3px solid #4CAF50;
        }
        
        /* IL MIO SCORE STYLES */
        .score-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .score-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, #4CAF50, #45a049);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            margin: 0 auto 15px;
            border: 4px solid rgba(255,255,255,0.2);
        }
        
        .score-stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }
        
        .score-stat-card {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .score-stat-value {
            font-size: 2rem;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .score-stat-label {
            font-size: 0.9rem;
            color: #ccc;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255,255,255,0.2);
            border-radius: 4px;
            margin: 10px 0;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s ease;
        }
        
        .progress-fill.vinte { background: linear-gradient(90deg, #4CAF50, #45a049); }
        .progress-fill.perse { background: linear-gradient(90deg, #F44336, #d32f2f); }
        .progress-fill.pareggiate { background: linear-gradient(90deg, #FFC107, #FFA000); }
        
        /* DESKTOP STYLES MIGLIORATI */
        @media (min-width: 768px) {
            .stats-grid { 
                grid-template-columns: repeat(4, 1fr); 
                gap: 20px; 
            }
            
            .score-stats-grid {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .app-content {
                max-width: 1200px;
                margin: 0 auto;
                padding-bottom: 20px;
            }
            
            .app-bottom-nav {
                display: none;
            }
            
            /* DESKTOP NAVIGATION MIGLIORATA */
            .desktop-nav {
                display: flex;
                gap: 10px;
                margin-top: 15px;
                flex-wrap: wrap;
            }
            
            .desktop-nav-button {
                padding: 12px 20px;
                background: rgba(255,255,255,0.1);
                color: white;
                border: none;
                border-radius: 8px;
                cursor: pointer;
                transition: all 0.3s ease;
                font-size: 0.9rem;
                position: relative;
            }
            
            .desktop-nav-button.active {
                background: #4CAF50;
                color: white;
            }
            
            .desktop-nav-button:hover {
                background: rgba(255,255,255,0.2);
            }
            
            .desktop-nav-button.active:hover {
                background: #45a049;
            }
            
            .desktop-notification-badge {
                position: absolute;
                top: -5px;
                right: -5px;
                background: #ff4444;
                color: white;
                border-radius: 50%;
                min-width: 20px;
                height: 20px;
                font-size: 0.7rem;
                font-weight: bold;
                display: flex;
                align-items: center;
                justify-content: center;
            }
        }
        
        /* NASCONDI NAV MOBILE SU DESKTOP */
        @media (min-width: 768px) {
            .app-bottom-nav {
                display: none;
            }
        }
        
        /* MOSTRA NAV DESKTOP */
        .desktop-nav {
            display: none;
        }
        
        @media (min-width: 768px) {
            .desktop-nav {
                display: flex;
            }
        }

        /* ADMIN BADGE */
        .admin-badge {
            background: linear-gradient(135deg, #FF6B35, #FF8E53);
            color: white;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: bold;
            margin-left: 8px;
            animation: glow-orange 2s infinite;
        }
        
        @keyframes glow-orange {
            0% { box-shadow: 0 0 5px #FF6B35; }
            50% { box-shadow: 0 0 15px #FF6B35; }
            100% { box-shadow: 0 0 5px #FF6B35; }
        }

        /* BACKUP STYLES */
        .backup-section {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            backdrop-filter: blur(10px);
        }

        .backup-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        .backup-info {
            background: rgba(255, 193, 7, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            border-left: 4px solid #FFC107;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script>
        // SERVICE WORKER MIGLIORATO per notifiche push
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('./sw.js')
                .then(registration => {
                    console.log('SW registered');
                    registration.update();
                })
                .catch(error => console.log('SW registration failed'));
        }
        
        // Richiedi permesso notifiche MIGLIORATO
        function requestNotificationPermission() {
            if ("Notification" in window) {
                Notification.requestPermission().then(permission => {
                    if (permission === "granted") {
                        console.log("Notifiche abilitate!");
                        localStorage.setItem('notificationsEnabled', 'true');
                        
                        if (localStorage.getItem('notificationTestShown') !== 'true') {
                            new Notification("Arena Cup - Notifiche Attive", {
                                body: "Ora riceverai notifiche per nuovi messaggi e partite!",
                                icon: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y=".9em" font-size="90">‚öΩ</text></svg>',
                                tag: 'arena-cup-welcome'
                            });
                            localStorage.setItem('notificationTestShown', 'true');
                        }
                    }
                });
            }
        }
        
        // Mostra notifica push MIGLIORATO - SEMPRE VISIBILE
        function showPushNotification(title, message, tag = 'arena-cup') {
            console.log(`üîî Tentativo notifica: ${title} - ${message}`);
            
            if (localStorage.getItem('notificationsEnabled') !== 'true') {
                console.log("‚ùå Notifiche disabilitate nelle impostazioni");
                return;
            }
            
            if ("Notification" in window && Notification.permission === "granted") {
                try {
                    const notification = new Notification(title, {
                        body: message,
                        icon: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y=".9em" font-size="90">‚öΩ</text></svg>',
                        tag: tag,
                        requireInteraction: true,
                    });
                    
                    notification.onclick = function() {
                        window.focus();
                        this.close();
                    };
                    
                    console.log("‚úÖ Notifica browser creata con successo");
                    
                    setTimeout(() => {
                        notification.close();
                    }, 8000);
                    
                } catch (error) {
                    console.log("‚ùå Errore notifica browser:", error);
                }
            } else {
                console.log("‚ùå Permesso notifiche non garantito");
            }
            
            // FALLBACK CON PUSH.JS
            if (typeof Push !== 'undefined') {
                try {
                    Push.create(title, {
                        body: message,
                        icon: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y=".9em" font-size="90">‚öΩ</text></svg>',
                        timeout: 8000,
                        onClick: function () {
                            window.focus();
                            this.close();
                        }
                    });
                    console.log("‚úÖ Notifica Push.js creata con successo");
                } catch (e) {
                    console.log("‚ùå Errore Push.js:", e);
                }
            }
            
            playNotificationSound();
        }
        
        // Vibrazione (solo mobile)
        function vibrate() {
            if (navigator.vibrate) {
                navigator.vibrate([100, 50, 100]);
            }
        }
        
        // üéµ NOTIFICA SONORA MIGLIORATA
        function playNotificationSound() {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = 800;
                gainNode.gain.value = 0.1;
                
                oscillator.start();
                gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.3);
                setTimeout(() => oscillator.stop(), 300);
                
                vibrate();
            } catch (e) {
                console.log("Audio non supportato, usa vibrazione");
                vibrate();
            }
        }
        
        // üîî FORZA RICHIESTA PERMESSI NOTIFICHE AL CARICAMENTO
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                if ("Notification" in window && Notification.permission === "default") {
                    requestNotificationPermission();
                }
            }, 1000);
        });
    </script>
    
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const firebaseConfig = {
            apiKey: "AIzaSyB5SnZlEKD-LO4i2wfgh_oawW5Pgn6mnQI",
            authDomain: "arenacup-18302.firebaseapp.com",
            databaseURL: "https://arenacup-18302-default-rtdb.firebaseio.com",
            projectId: "arenacup-18302",
            storageBucket: "arenacup-18302.firebasestorage.app",
            messagingSenderId: "801433859154",
            appId: "1:801433859154:web:7d1f76129a59b3521c5b8b"
        };

        const app = firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        function App() {
            const [loginForm, setLoginForm] = useState({
                username: localStorage.getItem("username") || "",
                password: ""
            });
            const [isLogged, setIsLogged] = useState(!!localStorage.getItem("username"));
            const [activeTab, setActiveTab] = useState("classifica");
            
            const [giocatori, setGiocatori] = useState([]);
            const [messaggi, setMessaggi] = useState([]);
            const [partite, setPartite] = useState([]);
            const [pagelle, setPagelle] = useState([]);
            const [form, setForm] = useState({ nome: "", gol: 0, assist: 0, voto: "" });
            const [nuovoMessaggio, setNuovoMessaggio] = useState("");
            const [ultimoMessaggioVisto, setUltimoMessaggioVisto] = useState(0);
            const [haNuoviMessaggi, setHaNuoviMessaggi] = useState(false);
            const [statistiche, setStatistiche] = useState({ download: 0, utentiUnici: 0 });
            
            // üîî STATI NOTIFICHE MIGLIORATI
            const [notificheChat, setNotificheChat] = useState(0);
            const [notificheCalendario, setNotificheCalendario] = useState(0);
            const [notificationsEnabled, setNotificationsEnabled] = useState(
                localStorage.getItem('notificationsEnabled') === 'true'
            );
            const [chatNotificationsEnabled, setChatNotificationsEnabled] = useState(
                localStorage.getItem('chatNotificationsEnabled') !== 'false'
            );
            const [calendarNotificationsEnabled, setCalendarNotificationsEnabled] = useState(
                localStorage.getItem('calendarNotificationsEnabled') !== 'false'
            );

            // üìù STATI PAGELLE MIGLIORATI
            const [pagellaForm, setPagellaForm] = useState({
                giocatore: "",
                voto: "6.0",
                fazione: "bianca",
                commento: "",
                gol: 0,
                assist: 0
            });
            const [modificaPagella, setModificaPagella] = useState(null);
            const [pagelleFiltrate, setPagelleFiltrate] = useState([]);
            const [filtroFazione, setFiltroFazione] = useState("tutte");

            // üéØ STATI PARTITE MIGLIORATI
            const [partitaForm, setPartitaForm] = useState({
                data: new Date().toISOString().split('T')[0],
                ora: "20:00",
                luogo: "Campo Arena",
                squadraCasa: "",
                squadraOspite: "",
                confermati: []
            });
            const [confermaPartita, setConfermaPartita] = useState(null);

            // üìä STATI CLASSIFICHE AVANZATE
            const [classificaGol, setClassificaGol] = useState([]);
            const [classificaAssist, setClassificaAssist] = useState([]);
            const [classificaVoto, setClassificaVoto] = useState([]);
            const [classificaPresenze, setClassificaPresenze] = useState([]);

            // üëë SISTEMA ADMIN
            const [adminMode, setAdminMode] = useState(false);
            const [nuovoGiocatore, setNuovoGiocatore] = useState("");
            const [backupData, setBackupData] = useState(null);

            const messagesEndRef = useRef(null);

            // üîê VERIFICA SE √à ADMIN
            const isAdminUser = (username) => {
                const admins = ["TuoNome", "Fabrizio", "admin"];
                return admins.includes(username);
            };

            // üîê SISTEMA DI LOGIN MIGLIORATO CON ADMIN
            const handleLogin = (e) => {
                e.preventDefault();
                const username = loginForm.username.trim();
                const password = loginForm.password.trim();

                if (!username || !password) {
                    alert("Inserisci username e password");
                    return;
                }

                // VERIFICA CREDENZIALI 
                const validUsers = {
                    "TuoNome": "arenacup2024",
                    "Fabrizio": "arenacup2024", 
                    "admin": "admin",
                    "giocatore1": "password1",
                    "giocatore2": "password2"
                };

                if (validUsers[username] && password === validUsers[username]) {
                    localStorage.setItem("username", username);
                    setIsLogged(true);
                    setAdminMode(isAdminUser(username));
                    
                    // Traccia statistiche accesso
                    const userStats = JSON.parse(localStorage.getItem('userStats') || '{}');
                    userStats[username] = {
                        primoAccesso: userStats[username]?.primoAccesso || new Date().toISOString(),
                        ultimoAccesso: new Date().toISOString(),
                        accessi: (userStats[username]?.accessi || 0) + 1,
                        isAdmin: isAdminUser(username)
                    };
                    localStorage.setItem('userStats', JSON.stringify(userStats));
                    
                    // Notifica benvenuto
                    showPushNotification(
                        `Benvenuto ${username}!`, 
                        isAdminUser(username) ? "Accesso come Admin üëë" : "Arena Cup √® pronta! ‚öΩ"
                    );
                } else {
                    alert("Credenziali errate! Prova con 'arenacup2024'");
                }
            };

            const handleLogout = () => {
                localStorage.removeItem("username");
                setIsLogged(false);
                setAdminMode(false);
                setLoginForm({ username: "", password: "" });
            };

            // üì• FETCH DATI DA FIREBASE
            useEffect(() => {
                if (!isLogged) return;

                // Fetch giocatori
                database.ref('giocatori').on('value', (snapshot) => {
                    const data = snapshot.val();
                    if (data) {
                        const giocatoriArray = Object.entries(data).map(([id, giocatore]) => ({
                            id,
                            ...giocatore
                        }));
                        setGiocatori(giocatoriArray);
                    }
                });

                // Fetch messaggi
                database.ref('messaggi').on('value', (snapshot) => {
                    const data = snapshot.val();
                    if (data) {
                        const messaggiArray = Object.entries(data).map(([id, messaggio]) => ({
                            id,
                            ...messaggio
                        })).sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                        
                        setMessaggi(messaggiArray);
                        
                        // Controlla nuovi messaggi
                        const lastSeen = localStorage.getItem('lastMessageSeen') || 0;
                        const newMessages = messaggiArray.filter(msg => 
                            new Date(msg.timestamp) > new Date(lastSeen) && 
                            msg.autore !== localStorage.getItem("username")
                        ).length;
                        
                        setNotificheChat(newMessages);
                        setHaNuoviMessaggi(newMessages > 0);
                    }
                });

                // Fetch partite
                database.ref('partite').on('value', (snapshot) => {
                    const data = snapshot.val();
                    if (data) {
                        const partiteArray = Object.entries(data).map(([id, partita]) => ({
                            id,
                            ...partita
                        })).sort((a, b) => new Date(a.data) - new Date(b.data));
                        setPartite(partiteArray);
                        
                        // Controlla nuove partite
                        const upcomingMatches = partiteArray.filter(partita => 
                            new Date(partita.data) > new Date() &&
                            !partita.confermati?.includes(localStorage.getItem("username"))
                        ).length;
                        
                        setNotificheCalendario(upcomingMatches);
                    }
                });

                // Fetch pagelle
                database.ref('pagelle').on('value', (snapshot) => {
                    const data = snapshot.val();
                    if (data) {
                        const pagelleArray = Object.entries(data).map(([id, pagella]) => ({
                            id,
                            ...pagella
                        })).sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                        setPagelle(pagelleArray);
                        calcolaClassifiche(pagelleArray);
                    }
                });

            }, [isLogged]);

            // üéØ CALCOLO CLASSIFICHE AVANZATO
            const calcolaClassifiche = (pagelleData) => {
                const stats = {};
                
                pagelleData.forEach(pagella => {
                    if (!stats[pagella.giocatore]) {
                        stats[pagella.giocatore] = {
                            gol: 0,
                            assist: 0,
                            voti: [],
                            presenze: 0,
                            fazioni: { bianca: 0, nera: 0, rossa: 0 }
                        };
                    }
                    
                    stats[pagella.giocatore].gol += parseInt(pagella.gol) || 0;
                    stats[pagella.giocatore].assist += parseInt(pagella.assist) || 0;
                    stats[pagella.giocatore].voti.push(parseFloat(pagella.voto));
                    stats[pagella.giocatore].presenze += 1;
                    if (pagella.fazione) {
                        stats[pagella.giocatore].fazioni[pagella.fazione] += 1;
                    }
                });

                // Classifica Gol
                setClassificaGol(
                    Object.entries(stats)
                        .map(([nome, stat]) => ({ nome, valore: stat.gol }))
                        .sort((a, b) => b.valore - a.valore)
                );

                // Classifica Assist
                setClassificaAssist(
                    Object.entries(stats)
                        .map(([nome, stat]) => ({ nome, valore: stat.assist }))
                        .sort((a, b) => b.valore - a.valore)
                );

                // Classifica Voto Medio
                setClassificaVoto(
                    Object.entries(stats)
                        .map(([nome, stat]) => ({ 
                            nome, 
                            valore: stat.voti.length > 0 ? 
                                (stat.voti.reduce((a, b) => a + b, 0) / stat.voti.length).toFixed(2) : 0 
                        }))
                        .sort((a, b) => b.valore - a.valore)
                );

                // Classifica Presenze
                setClassificaPresenze(
                    Object.entries(stats)
                        .map(([nome, stat]) => ({ nome, valore: stat.presenze }))
                        .sort((a, b) => b.valore - a.valore)
                );
            };

            // üí¨ INVIO MESSAGGIO MIGLIORATO
            const inviaMessaggio = () => {
                if (!nuovoMessaggio.trim()) return;

                const messaggio = {
                    autore: localStorage.getItem("username"),
                    testo: nuovoMessaggio.trim(),
                    timestamp: new Date().toISOString(),
                    tipo: adminMode ? "admin" : "user"
                };

                database.ref('messaggi').push(messaggio);
                setNuovoMessaggio("");
                
                // Scroll to bottom
                messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
                
                // Notifica nuovi messaggi a tutti tranne mittente
                giocatori.forEach(giocatore => {
                    if (giocatore.nome !== localStorage.getItem("username")) {
                        showPushNotification(
                            `üí¨ ${messaggio.autore}`,
                            messaggio.testo,
                            'arena-cup-chat'
                        );
                    }
                });
            };

            // üìù GESTIONE PAGELLE COMPLETA CON MEZZI VOTI
            const aggiungiPagella = () => {
                if (!pagellaForm.giocatore || !pagellaForm.voto) {
                    alert("Seleziona un giocatore e inserisci un voto");
                    return;
                }

                const pagella = {
                    ...pagellaForm,
                    autore: localStorage.getItem("username"),
                    timestamp: new Date().toISOString(),
                    gol: parseInt(pagellaForm.gol) || 0,
                    assist: parseInt(pagellaForm.assist) || 0,
                    voto: parseFloat(pagellaForm.voto).toFixed(1)
                };

                database.ref('pagelle').push(pagella);
                setPagellaForm({
                    giocatore: "",
                    voto: "6.0",
                    fazione: "bianca",
                    commento: "",
                    gol: 0,
                    assist: 0
                });

                showPushNotification(
                    "üìù Pagella aggiunta!",
                    `Voto ${pagella.voto} per ${pagella.giocatore}`,
                    'arena-cup-pagelle'
                );
            };

            const modificaPagellaEsistente = (pagellaId, nuoveInfo) => {
                database.ref(`pagelle/${pagellaId}`).update({
                    ...nuoveInfo,
                    voto: parseFloat(nuoveInfo.voto).toFixed(1)
                });
                setModificaPagella(null);
            };

            const eliminaPagella = (pagellaId) => {
                if (window.confirm("Sei sicuro di voler eliminare questa pagella?")) {
                    database.ref(`pagelle/${pagellaId}`).remove();
                }
            };

            // üë• GESTIONE GIOCATORI (SOLO ADMIN)
            const aggiungiGiocatore = () => {
                if (!nuovoGiocatore.trim()) {
                    alert("Inserisci il nome del giocatore");
                    return;
                }

                const giocatoreEsistente = giocatori.find(g => 
                    g.nome.toLowerCase() === nuovoGiocatore.trim().toLowerCase()
                );

                if (giocatoreEsistente) {
                    alert("Questo giocatore esiste gi√†!");
                    return;
                }

                const giocatore = {
                    nome: nuovoGiocatore.trim(),
                    creatoDa: localStorage.getItem("username"),
                    timestamp: new Date().toISOString(),
                    attivo: true
                };

                database.ref('giocatori').push(giocatore);
                setNuovoGiocatore("");

                showPushNotification(
                    "üë• Nuovo Giocatore",
                    `${giocatore.nome} aggiunto al torneo`,
                    'arena-cup-giocatori'
                );
            };

            const eliminaGiocatore = (giocatoreId) => {
                if (window.confirm("Sei sicuro di voler eliminare questo giocatore?")) {
                    database.ref(`giocatori/${giocatoreId}`).remove();
                }
            };

            // üóìÔ∏è GESTIONE PARTITE AVANZATA
            const creaPartita = () => {
                if (!partitaForm.squadraCasa || !partitaForm.squadraOspite) {
                    alert("Inserisci entrambe le squadre");
                    return;
                }

                const partita = {
                    ...partitaForm,
                    creatore: localStorage.getItem("username"),
                    timestamp: new Date().toISOString(),
                    confermati: [],
                    stato: "programmata"
                };

                database.ref('partite').push(partita);
                setPartitaForm({
                    data: new Date().toISOString().split('T')[0],
                    ora: "20:00",
                    luogo: "Campo Arena",
                    squadraCasa: "",
                    squadraOspite: "",
                    confermati: []
                });

                showPushNotification(
                    "üóìÔ∏è Nuova Partita!",
                    `${partita.squadraCasa} vs ${partita.squadraOspite} - ${partita.data}`,
                    'arena-cup-partite'
                );
            };

            const confermaPartecipazione = (partitaId, conferma) => {
                const username = localStorage.getItem("username");
                const partitaRef = database.ref(`partite/${partitaId}/confermati`);
                
                if (conferma) {
                    partitaRef.transaction(currentConfermati => {
                        if (currentConfermati && currentConfermati.includes(username)) {
                            return currentConfermati;
                        }
                        return currentConfermati ? [...currentConfermati, username] : [username];
                    });
                } else {
                    partitaRef.transaction(currentConfermati => {
                        if (!currentConfermati) return [];
                        return currentConfermati.filter(user => user !== username);
                    });
                }
                
                setConfermaPartita(null);
            };

            // üíæ SISTEMA BACKUP COMPLETO
            const creaBackup = () => {
                const backupData = {
                    giocatori: giocatori,
                    messaggi: messaggi,
                    partite: partite,
                    pagelle: pagelle,
                    timestamp: new Date().toISOString(),
                    creatoDa: localStorage.getItem("username"),
                    versione: "1.0"
                };
                
                setBackupData(backupData);
                
                const blob = new Blob([JSON.stringify(backupData, null, 2)], {
                    type: 'application/json'
                });
                
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `arena-cup-backup-${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                URL.revokeObjectURL(url);

                showPushNotification(
                    "üíæ Backup Creato",
                    "Tutti i dati sono stati esportati con successo",
                    'arena-cup-backup'
                );
            };

            const importaBackup = (event) => {
                const file = event.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const backupData = JSON.parse(e.target.result);
                        
                        if (window.confirm("Sei sicuro di voler importare questo backup? I dati attuali verranno sovrascritti.")) {
                            // Importa giocatori
                            if (backupData.giocatori) {
                                database.ref('giocatori').set(backupData.giocatori.reduce((acc, giocatore) => {
                                    acc[giocatore.id] = giocatore;
                                    return acc;
                                }, {}));
                            }
                            
                            // Importa altri dati...
                            showPushNotification(
                                "üíæ Backup Importato",
                                "Tutti i dati sono stati ripristinati",
                                'arena-cup-backup'
                            );
                        }
                    } catch (error) {
                        alert("Errore nell'importare il backup: " + error.message);
                    }
                };
                reader.readAsText(file);
            };

            // üèÜ COMPONENTE CLASSIFICHE AVANZATO
            const ClassificheAvanzate = () => {
                const classifiche = [
                    { titolo: "üèÜ Classifica Gol", dati: classificaGol, icon: "‚öΩ" },
                    { titolo: "üéØ Classifica Assist", dati: classificaAssist, icon: "üÖ∞Ô∏è" },
                    { titolo: "‚≠ê Voto Medio", dati: classificaVoto, icon: "‚≠ê" },
                    { titolo: "üìä Presenze", dati: classificaPresenze, icon: "üë•" }
                ];

                return (
                    <div>
                        <h2>üèÜ Classifiche</h2>
                        <div className="classifica-grid">
                            {classifiche.map((classifica, index) => (
                                <div key={index} className="classifica-card">
                                    <h3>{classifica.titolo}</h3>
                                    {classifica.dati.slice(0, 10).map((item, pos) => (
                                        <div key={pos} className="classifica-item">
                                            <div className={`classifica-pos ${
                                                pos === 0 ? 'oro' : 
                                                pos === 1 ? 'argento' : 
                                                pos === 2 ? 'bronzo' : ''
                                            }`}>
                                                {pos + 1}
                                            </div>
                                            <div className="classifica-nome">
                                                {item.nome}
                                                {item.nome === localStorage.getItem("username") && (
                                                    <span className="current-user-badge">TU</span>
                                                )}
                                                {isAdminUser(item.nome) && (
                                                    <span className="admin-badge">ADMIN</span>
                                                )}
                                            </div>
                                            <div className="classifica-valore">
                                                {classifica.icon} {item.valore}
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            ))}
                        </div>
                    </div>
                );
            };

            // üëë COMPONENTE ADMIN PANEL
            const AdminPanel = () => {
                if (!adminMode) return null;

                return (
                    <div>
                        <h2>üëë Pannello Admin</h2>
                        
                        {/* Gestione Giocatori */}
                        <div className="pagella-form">
                            <h3>üë• Gestione Giocatori</h3>
                            <div style={{display: 'flex', gap: '10px', alignItems: 'center'}}>
                                <input
                                    type="text"
                                    placeholder="Nome nuovo giocatore"
                                    value={nuovoGiocatore}
                                    onChange={(e) => setNuovoGiocatore(e.target.value)}
                                    style={{flex: 1}}
                                />
                                <button onClick={aggiungiGiocatore} style={{background: '#4CAF50'}}>
                                    Aggiungi
                                </button>
                            </div>
                            
                            <div style={{marginTop: '15px'}}>
                                <h4>Giocatori Registrati:</h4>
                                {giocatori.map(giocatore => (
                                    <div key={giocatore.id} className="player-card">
                                        <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center'}}>
                                            <span>{giocatore.nome}</span>
                                            <button 
                                                onClick={() => eliminaGiocatore(giocatore.id)}
                                                style={{background: '#f44336', padding: '5px 10px', fontSize: '0.8rem'}}
                                            >
                                                Elimina
                                            </button>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>

                        {/* Sistema Backup */}
                        <div className="backup-section">
                            <h3>üíæ Sistema Backup</h3>
                            <div className="backup-info">
                                <strong>Ultimo Backup:</strong> {backupData ? new Date(backupData.timestamp).toLocaleString() : 'Mai effettuato'}
                            </div>
                            <div className="backup-actions">
                                <button onClick={creaBackup} style={{background: '#2196F3'}}>
                                    üì• Crea Backup
                                </button>
                                <label style={{background: '#FF9800', padding: '10px 15px', borderRadius: '8px', cursor: 'pointer'}}>
                                    üì§ Importa Backup
                                    <input 
                                        type="file" 
                                        accept=".json" 
                                        onChange={importaBackup}
                                        style={{display: 'none'}}
                                    />
                                </label>
                            </div>
                        </div>

                        {/* Statistiche Sistema */}
                        <div className="stats-grid">
                            <div className="stat-card">
                                <div style={{fontSize: '2rem'}}>üë•</div>
                                <div>Giocatori</div>
                                <div style={{fontSize: '1.5rem', fontWeight: 'bold'}}>
                                    {giocatori.length}
                                </div>
                            </div>
                            <div className="stat-card">
                                <div style={{fontSize: '2rem'}}>üí¨</div>
                                <div>Messaggi</div>
                                <div style={{fontSize: '1.5rem', fontWeight: 'bold'}}>
                                    {messaggi.length}
                                </div>
                            </div>
                            <div className="stat-card">
                                <div style={{fontSize: '2rem'}}>üìù</div>
                                <div>Pagelle</div>
                                <div style={{fontSize: '1.5rem', fontWeight: 'bold'}}>
                                    {pagelle.length}
                                </div>
                            </div>
                            <div className="stat-card">
                                <div style={{fontSize: '2rem'}}>‚öΩ</div>
                                <div>Partite</div>
                                <div style={{fontSize: '1.5rem', fontWeight: 'bold'}}>
                                    {partite.length}
                                </div>
                            </div>
                        </div>
                    </div>
                );
            };

            // üì± COMPONENTE PRINCIPALE
            if (!isLogged) {
                return (
                    <div className="app-container">
                        <div className="login-container">
                            <form onSubmit={handleLogin} className="login-form">
                                <h1>‚öΩ Arena Cup</h1>
                                <p style={{marginBottom: '20px', color: '#ccc'}}>
                                    Accedi per gestire il torneo
                                </p>
                                
                                <input
                                    type="text"
                                    placeholder="Username"
                                    value={loginForm.username}
                                    onChange={(e) => setLoginForm({...loginForm, username: e.target.value})}
                                    className="login-input"
                                    autoComplete="username"
                                />
                                
                                <input
                                    type="password"
                                    placeholder="Password"
                                    value={loginForm.password}
                                    onChange={(e) => setLoginForm({...loginForm, password: e.target.value})}
                                    className="login-input"
                                    autoComplete="current-password"
                                />
                                
                                <button type="submit" className="login-button">
                                    ACCEDI
                                </button>
                                
                                <div className="password-hint">
                                    Password demo: arenacup2024
                                </div>
                                <div style={{fontSize: '0.8rem', color: '#ccc', marginTop: '10px'}}>
                                    Admin: TuoNome/Fabrizio - Password: arenacup2024
                                </div>
                            </form>
                        </div>
                    </div>
                );
            }

            // üéØ RENDER PRINCIPALE DOPO LOGIN
            return (
                <div className="app-container">
                    {/* HEADER */}
                    <div className="app-header">
                        <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center'}}>
                            <div>
                                <h1>‚öΩ Arena Cup {adminMode && "üëë"}</h1>
                                <p style={{color: '#ccc', fontSize: '0.9rem'}}>
                                    Benvenuto, {localStorage.getItem("username")}!
                                    {adminMode && <span className="admin-badge" style={{marginLeft: '10px'}}>ADMIN</span>}
                                </p>
                            </div>
                            <button 
                                onClick={handleLogout}
                                style={{background: '#f44336', padding: '8px 15px', fontSize: '0.8rem'}}
                            >
                                üîì Logout
                            </button>
                        </div>
                        
                        {/* DESKTOP NAV */}
                        <div className="desktop-nav">
                            {[
                                { id: "classifica", label: "üèÜ Classifica", icon: "üèÜ" },
                                { id: "partite", label: "üóìÔ∏è Partite", icon: "üóìÔ∏è" },
                                { id: "chat", label: "üí¨ Chat", icon: "üí¨" },
                                { id: "pagelle", label: "üìù Pagelle", icon: "üìù" },
                                { id: "score", label: "‚≠ê Il Mio Score", icon: "‚≠ê" },
                                ...(adminMode ? [{ id: "admin", label: "üëë Admin", icon: "üëë" }] : []),
                                { id: "impostazioni", label: "‚öôÔ∏è Impostazioni", icon: "‚öôÔ∏è" }
                            ].map(tab => (
                                <button
                                    key={tab.id}
                                    className={`desktop-nav-button ${activeTab === tab.id ? 'active' : ''}`}
                                    onClick={() => setActiveTab(tab.id)}
                                >
                                    {tab.label}
                                    {(tab.id === "chat" && notificheChat > 0) && (
                                        <div className="desktop-notification-badge">
                                            {notificheChat}
                                        </div>
                                    )}
                                    {(tab.id === "partite" && notificheCalendario > 0) && (
                                        <div className="desktop-notification-badge">
                                            {notificheCalendario}
                                        </div>
                                    )}
                                </button>
                            ))}
                        </div>
                    </div>

                    {/* CONTENUTO PRINCIPALE */}
                    <div className="app-content">
                        {activeTab === "classifica" && <ClassificheAvanzate />}
                        
                        {activeTab === "admin" && <AdminPanel />}
                        
                        {activeTab === "partite" && (
                            <div>
                                <h2>üóìÔ∏è Partite</h2>
                                
                                {/* Form nuova partita */}
                                {adminMode && (
                                    <div className="pagella-form">
                                        <h3>Crea Nuova Partita</h3>
                                        <input
                                            type="date"
                                            value={partitaForm.data}
                                            onChange={(e) => setPartitaForm({...partitaForm, data: e.target.value})}
                                        />
                                        <input
                                            type="time"
                                            value={partitaForm.ora}
                                            onChange={(e) => setPartitaForm({...partitaForm, ora: e.target.value})}
                                        />
                                        <input
                                            type="text"
                                            placeholder="Luogo"
                                            value={partitaForm.luogo}
                                            onChange={(e) => setPartitaForm({...partitaForm, luogo: e.target.value})}
                                        />
                                        <input
                                            type="text"
                                            placeholder="Squadra Casa"
                                            value={partitaForm.squadraCasa}
                                            onChange={(e) => setPartitaForm({...partitaForm, squadraCasa: e.target.value})}
                                        />
                                        <input
                                            type="text"
                                            placeholder="Squadra Ospite"
                                            value={partitaForm.squadraOspite}
                                            onChange={(e) => setPartitaForm({...partitaForm, squadraOspite: e.target.value})}
                                        />
                                        <button onClick={creaPartita} style={{background: '#4CAF50'}}>
                                            Crea Partita
                                        </button>
                                    </div>
                                )}

                                {/* Lista partite */}
                                {partite.map(partita => (
                                    <div key={partita.id} className="match-card">
                                        <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center'}}>
                                            <div>
                                                <h3>{partita.squadraCasa} vs {partita.squadraOspite}</h3>
                                                <p>{partita.data} alle {partita.ora} - {partita.luogo}</p>
                                                <p style={{fontSize: '0.8rem', color: '#ccc'}}>
                                                    Creata da: {partita.creatore}
                                                </p>
                                            </div>
                                            <div>
                                                {!partita.confermati?.includes(localStorage.getItem("username")) ? (
                                                    <button 
                                                        onClick={() => confermaPartecipazione(partita.id, true)}
                                                        style={{background: '#4CAF50'}}
                                                    >
                                                        ‚úÖ Conferma
                                                    </button>
                                                ) : (
                                                    <button 
                                                        onClick={() => confermaPartecipazione(partita.id, false)}
                                                        style={{background: '#ff9800'}}
                                                    >
                                                        ‚ùå Annulla
                                                    </button>
                                                )}
                                            </div>
                                        </div>
                                        
                                        {partita.confermati && partita.confermati.length > 0 && (
                                            <div className="confermato-list">
                                                <strong>Confermati ({partita.confermati.length}):</strong>
                                                {partita.confermati.map((user, idx) => (
                                                    <div 
                                                        key={idx} 
                                                        className={`confermato-item ${user === localStorage.getItem("username") ? 'current-user' : ''}`}
                                                    >
                                                        {user} {user === localStorage.getItem("username") && "(TU)"}
                                                        {isAdminUser(user) && <span className="admin-badge">ADMIN</span>}
                                                    </div>
                                                ))}
                                            </div>
                                        )}
                                    </div>
                                ))}
                            </div>
                        )}
                        
                        {activeTab === "chat" && (
                            <div>
                                <h2>üí¨ Chat</h2>
                                
                                {/* Lista messaggi */}
                                <div style={{maxHeight: '400px', overflowY: 'auto', marginBottom: '20px'}}>
                                    {messaggi.map(messaggio => (
                                        <div 
                                            key={messaggio.id}
                                            className={`message-bubble ${
                                                messaggio.autore === localStorage.getItem("username") ? 'own-message' : 
                                                messaggio.tipo === 'admin' ? 'admin-message' : ''
                                            }`}
                                        >
                                            <div style={{fontWeight: 'bold', marginBottom: '5px'}}>
                                                {messaggio.autore}
                                                {messaggio.autore === localStorage.getItem("username") && " (TU)"}
                                                {messaggio.tipo === 'admin' && " üëë"}
                                                {isAdminUser(messaggio.autore) && <span className="admin-badge">ADMIN</span>}
                                            </div>
                                            <div>{messaggio.testo}</div>
                                            <div style={{fontSize: '0.8rem', color: '#ccc', marginTop: '5px'}}>
                                                {new Date(messaggio.timestamp).toLocaleString()}
                                            </div>
                                        </div>
                                    ))}
                                    <div ref={messagesEndRef} />
                                </div>
                                
                                {/* Input messaggio */}
                                <div style={{display: 'flex', gap: '10px'}}>
                                    <input
                                        type="text"
                                        placeholder="Scrivi un messaggio..."
                                        value={nuovoMessaggio}
                                        onChange={(e) => setNuovoMessaggio(e.target.value)}
                                        onKeyPress={(e) => e.key === 'Enter' && inviaMessaggio()}
                                        style={{flex: 1}}
                                    />
                                    <button onClick={inviaMessaggio} style={{background: '#2196F3'}}>
                                        Invia
                                    </button>
                                </div>
                            </div>
                        )}
                        
                        {activeTab === "pagelle" && (
                            <div>
                                <h2>üìù Pagelle</h2>
                                
                                {/* Form pagella */}
                                <div className="pagella-form">
                                    <h3>Aggiungi Pagella</h3>
                                    <select
                                        value={pagellaForm.giocatore}
                                        onChange={(e) => setPagellaForm({...pagellaForm, giocatore: e.target.value})}
                                        className="giocatore-select"
                                    >
                                        <option value="">Seleziona Giocatore</option>
                                        {giocatori.map(g => (
                                            <option key={g.id} value={g.nome}>{g.nome}</option>
                                        ))}
                                    </select>
                                    
                                    <select
                                        value={pagellaForm.voto}
                                        onChange={(e) => setPagellaForm({...pagellaForm, voto: e.target.value})}
                                        className="voto-select"
                                    >
                                        <option value="1.0">1</option>
                                        <option value="1.5">1.5</option>
                                        <option value="2.0">2</option>
                                        <option value="2.5">2.5</option>
                                        <option value="3.0">3</option>
                                        <option value="3.5">3.5</option>
                                        <option value="4.0">4</option>
                                        <option value="4.5">4.5</option>
                                        <option value="5.0">5</option>
                                        <option value="5.5">5.5</option>
                                        <option value="6.0">6</option>
                                        <option value="6.5">6.5</option>
                                        <option value="7.0">7</option>
                                        <option value="7.5">7.5</option>
                                        <option value="8.0">8</option>
                                        <option value="8.5">8.5</option>
                                        <option value="9.0">9</option>
                                        <option value="9.5">9.5</option>
                                        <option value="10.0">10</option>
                                    </select>
                                    
                                    <select
                                        value={pagellaForm.fazione}
                                        onChange={(e) => setPagellaForm({...pagellaForm, fazione: e.target.value})}
                                        className="fazione-select"
                                    >
                                        <option value="bianca">Bianca</option>
                                        <option value="nera">Nera</option>
                                        <option value="rossa">Rossa</option>
                                    </select>
                                    
                                    <input
                                        type="number"
                                        placeholder="Gol"
                                        value={pagellaForm.gol}
                                        onChange={(e) => setPagellaForm({...pagellaForm, gol: e.target.value})}
                                        className="number-input"
                                        min="0"
                                    />
                                    
                                    <input
                                        type="number"
                                        placeholder="Assist"
                                        value={pagellaForm.assist}
                                        onChange={(e) => setPagellaForm({...pagellaForm, assist: e.target.value})}
                                        className="number-input"
                                        min="0"
                                    />
                                    
                                    <textarea
                                        placeholder="Commento (opzionale)"
                                        value={pagellaForm.commento}
                                        onChange={(e) => setPagellaForm({...pagellaForm, commento: e.target.value})}
                                    />
                                    
                                    <button onClick={aggiungiPagella} style={{background: '#4CAF50'}}>
                                        Aggiungi Pagella
                                    </button>
                                </div>

                                {/* Lista pagelle */}
                                <div style={{marginTop: '30px'}}>
                                    <h3>Ultime Pagelle</h3>
                                    
                                    {/* Filtri */}
                                    <div style={{marginBottom: '20px'}}>
                                        <select 
                                            value={filtroFazione}
                                            onChange={(e) => setFiltroFazione(e.target.value)}
                                            className="fazione-select"
                                        >
                                            <option value="tutte">Tutte le fazioni</option>
                                            <option value="bianca">Bianca</option>
                                            <option value="nera">Nera</option>
                                            <option value="rossa">Rossa</option>
                                        </select>
                                    </div>
                                    
                                    {pagelle
                                        .filter(p => filtroFazione === "tutte" || p.fazione === filtroFazione)
                                        .map(pagella => (
                                        <div key={pagella.id} className={`pagella-card fazione-${pagella.fazione}`}>
                                            {modificaPagella === pagella.id ? (
                                                <div className="modifica-pagella-form">
                                                    <select
                                                        value={modificaPagella.voto}
                                                        onChange={(e) => setModificaPagella({
                                                            ...modificaPagella, 
                                                            voto: e.target.value
                                                        })}
                                                        className="voto-select"
                                                    >
                                                        {[1.0,1.5,2.0,2.5,3.0,3.5,4.0,4.5,5.0,5.5,6.0,6.5,7.0,7.5,8.0,8.5,9.0,9.5,10.0].map(voto => (
                                                            <option key={voto} value={voto}>{voto}</option>
                                                        ))}
                                                    </select>
                                                    
                                                    <input
                                                        type="number"
                                                        placeholder="Gol"
                                                        value={modificaPagella.gol}
                                                        onChange={(e) => setModificaPagella({
                                                            ...modificaPagella, 
                                                            gol: e.target.value
                                                        })}
                                                        className="number-input"
                                                    />
                                                    
                                                    <input
                                                        type="number"
                                                        placeholder="Assist"
                                                        value={modificaPagella.assist}
                                                        onChange={(e) => setModificaPagella({
                                                            ...modificaPagella, 
                                                            assist: e.target.value
                                                        })}
                                                        className="number-input"
                                                    />
                                                    
                                                    <textarea
                                                        placeholder="Commento"
                                                        value={modificaPagella.commento}
                                                        onChange={(e) => setModificaPagella({
                                                            ...modificaPagella, 
                                                            commento: e.target.value
                                                        })}
                                                    />
                                                    
                                                    <div className="modifica-actions">
                                                        <button 
                                                            onClick={() => modificaPagellaEsistente(pagella.id, {
                                                                voto: modificaPagella.voto,
                                                                gol: parseInt(modificaPagella.gol) || 0,
                                                                assist: parseInt(modificaPagella.assist) || 0,
                                                                commento: modificaPagella.commento
                                                            })}
                                                            style={{background: '#4CAF50'}}
                                                        >
                                                            Salva
                                                        </button>
                                                        <button 
                                                            onClick={() => setModificaPagella(null)}
                                                            style={{background: '#ff9800'}}
                                                        >
                                                            Annulla
                                                        </button>
                                                    </div>
                                                </div>
                                            ) : (
                                                <>
                                                    <div className="pagella-header">
                                                        <div className="pagella-giocatore">
                                                            {pagella.giocatore}
                                                            <span className={`badge-fazione badge-${pagella.fazione}`}>
                                                                {pagella.fazione.toUpperCase()}
                                                            </span>
                                                            {pagella.autore === localStorage.getItem("username") && (
                                                                <span className="current-user-badge">TU</span>
                                                            )}
                                                            {isAdminUser(pagella.autore) && (
                                                                <span className="admin-badge">ADMIN</span>
                                                            )}
                                                        </div>
                                                        <div className="pagella-voto">
                                                            Voto: {pagella.voto}
                                                        </div>
                                                    </div>
                                                    
                                                    <div style={{display: 'flex', gap: '15px', marginBottom: '10px'}}>
                                                        <div>‚öΩ Gol: {pagella.gol || 0}</div>
                                                        <div>üÖ∞Ô∏è Assist: {pagella.assist || 0}</div>
                                                    </div>
                                                    
                                                    {pagella.commento && (
                                                        <div className="pagella-commento">
                                                            "{pagella.commento}"
                                                        </div>
                                                    )}
                                                    
                                                    <div className="pagella-actions">
                                                        <div style={{fontSize: '0.8rem', color: '#ccc'}}>
                                                            Da {pagella.autore} - {new Date(pagella.timestamp).toLocaleString()}
                                                        </div>
                                                        
                                                        {(pagella.autore === localStorage.getItem("username") || adminMode) && (
                                                            <div style={{marginLeft: 'auto', display: 'flex', gap: '10px'}}>
                                                                <button 
                                                                    onClick={() => setModificaPagella(pagella)}
                                                                    style={{background: '#FFC107', color: 'black', padding: '5px 10px', fontSize: '0.8rem'}}
                                                                >
                                                                    Modifica
                                                                </button>
                                                                <button 
                                                                    onClick={() => eliminaPagella(pagella.id)}
                                                                    style={{background: '#f44336', padding: '5px 10px', fontSize: '0.8rem'}}
                                                                >
                                                                    Elimina
                                                                </button>
                                                            </div>
                                                        )}
                                                    </div>
                                                </>
                                            )}
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}
                        
                        {activeTab === "score" && (
                            <div>
                                <h2>‚≠ê Il Mio Score</h2>
                                
                                <div className="score-header">
                                    <div className="score-avatar">
                                        {localStorage.getItem("username")?.charAt(0).toUpperCase()}
                                    </div>
                                    <h3>{localStorage.getItem("username")}</h3>
                                    {adminMode && <span className="admin-badge">ADMIN</span>}
                                </div>
                                
                                <div className="score-stats-grid">
                                    <div className="score-stat-card">
                                        <div className="score-stat-label">Voto Medio</div>
                                        <div className="score-stat-value">
                                            {classificaVoto.find(g => g.nome === localStorage.getItem("username"))?.valore || "0.0"}
                                        </div>
                                    </div>
                                    
                                    <div className="score-stat-card">
                                        <div className="score-stat-label">Gol Totali</div>
                                        <div className="score-stat-value">
                                            {classificaGol.find(g => g.nome === localStorage.getItem("username"))?.valore || "0"}
                                        </div>
                                    </div>
                                    
                                    <div className="score-stat-card">
                                        <div className="score-stat-label">Assist Totali</div>
                                        <div className="score-stat-value">
                                            {classificaAssist.find(g => g.nome === localStorage.getItem("username"))?.valore || "0"}
                                        </div>
                                    </div>
                                    
                                    <div className="score-stat-card">
                                        <div className="score-stat-label">Presenze</div>
                                        <div className="score-stat-value">
                                            {classificaPresenze.find(g => g.nome === localStorage.getItem("username"))?.valore || "0"}
                                        </div>
                                    </div>
                                </div>
                                
                                {/* Statistiche dettagliate */}
                                <div style={{marginTop: '30px'}}>
                                    <h3>Le Tue Ultime Pagelle</h3>
                                    {pagelle
                                        .filter(p => p.giocatore === localStorage.getItem("username"))
                                        .slice(0, 5)
                                        .map(pagella => (
                                        <div key={pagella.id} className={`pagella-card fazione-${pagella.fazione}`}>
                                            <div className="pagella-header">
                                                <div className="pagella-voto">Voto: {pagella.voto}</div>
                                                <div className="pagella-data">
                                                    {new Date(pagella.timestamp).toLocaleDateString()}
                                                </div>
                                            </div>
                                            <div style={{display: 'flex', gap: '15px'}}>
                                                <div>‚öΩ Gol: {pagella.gol || 0}</div>
                                                <div>üÖ∞Ô∏è Assist: {pagella.assist || 0}</div>
                                                <div className={`badge-fazione badge-${pagella.fazione}`}>
                                                    {pagella.fazione.toUpperCase()}
                                                </div>
                                            </div>
                                            {pagella.commento && (
                                                <div className="pagella-commento">
                                                    "{pagella.commento}"
                                                </div>
                                            )}
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}
                        
                        {activeTab === "impostazioni" && (
                            <div>
                                <h2>‚öôÔ∏è Impostazioni</h2>
                                
                                <div className="notification-settings">
                                    <h3>üîî Notifiche</h3>
                                    
                                    <div className="setting-item">
                                        <span>Notifiche Push</span>
                                        <label className="switch">
                                            <input 
                                                type="checkbox" 
                                                checked={notificationsEnabled}
                                                onChange={(e) => {
                                                    setNotificationsEnabled(e.target.checked);
                                                    localStorage.setItem('notificationsEnabled', e.target.checked);
                                                    if (e.target.checked) {
                                                        requestNotificationPermission();
                                                    }
                                                }}
                                            />
                                            <span className="slider"></span>
                                        </label>
                                    </div>
                                    
                                    <div className="setting-item">
                                        <span>Notifiche Chat</span>
                                        <label className="switch">
                                            <input 
                                                type="checkbox" 
                                                checked={chatNotificationsEnabled}
                                                onChange={(e) => {
                                                    setChatNotificationsEnabled(e.target.checked);
                                                    localStorage.setItem('chatNotificationsEnabled', e.target.checked);
                                                }}
                                            />
                                            <span className="slider"></span>
                                        </label>
                                    </div>
                                    
                                    <div className="setting-item">
                                        <span>Notifiche Partite</span>
                                        <label className="switch">
                                            <input 
                                                type="checkbox" 
                                                checked={calendarNotificationsEnabled}
                                                onChange={(e) => {
                                                    setCalendarNotificationsEnabled(e.target.checked);
                                                    localStorage.setItem('calendarNotificationsEnabled', e.target.checked);
                                                }}
                                            />
                                            <span className="slider"></span>
                                        </label>
                                    </div>
                                </div>
                                
                                {adminMode && (
                                    <div className="backup-section">
                                        <h3>üíæ Backup Dati</h3>
                                        <p style={{marginBottom: '15px', color: '#ccc'}}>
                                            Crea un backup di tutti i dati o importa un backup precedente.
                                        </p>
                                        <div className="backup-actions">
                                            <button onClick={creaBackup} style={{background: '#2196F3'}}>
                                                üì• Esporta Backup
                                            </button>
                                            <label style={{background: '#FF9800', padding: '10px 15px', borderRadius: '8px', cursor: 'pointer'}}>
                                                üì§ Importa Backup
                                                <input 
                                                    type="file" 
                                                    accept=".json" 
                                                    onChange={importaBackup}
                                                    style={{display: 'none'}}
                                                />
                                            </label>
                                        </div>
                                    </div>
                                )}
                                
                                <div style={{marginTop: '30px'}}>
                                    <h3>üìä Statistiche</h3>
                                    <div className="stats-grid">
                                        <div className="stat-card">
                                            <div style={{fontSize: '2rem'}}>üë•</div>
                                            <div>Utenti Unici</div>
                                            <div style={{fontSize: '1.5rem', fontWeight: 'bold'}}>
                                                {Object.keys(JSON.parse(localStorage.getItem('userStats') || '{}')).length}
                                            </div>
                                        </div>
                                        <div className="stat-card">
                                            <div style={{fontSize: '2rem'}}>üí¨</div>
                                            <div>Messaggi</div>
                                            <div style={{fontSize: '1.5rem', fontWeight: 'bold'}}>
                                                {messaggi.length}
                                            </div>
                                        </div>
                                        <div className="stat-card">
                                            <div style={{fontSize: '2rem'}}>üìù</div>
                                            <div>Pagelle</div>
                                            <div style={{fontSize: '1.5rem', fontWeight: 'bold'}}>
                                                {pagelle.length}
                                            </div>
                                        </div>
                                        <div className="stat-card">
                                            <div style={{fontSize: '2rem'}}>‚öΩ</div>
                                            <div>Partite</div>
                                            <div style={{fontSize: '1.5rem', fontWeight: 'bold'}}>
                                                {partite.length}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <button 
                                    onClick={handleLogout}
                                    style={{background: '#f44336', marginTop: '30px', width: '100%'}}
                                >
                                    üîì Logout
                                </button>
                            </div>
                        )}
                    </div>

                    {/* MOBILE NAVIGATION */}
                    <div className="app-bottom-nav">
                        {[
                            { id: "classifica", label: "Classifica", icon: "üèÜ" },
                            { id: "partite", label: "Partite", icon: "üóìÔ∏è" },
                            { id: "chat", label: "Chat", icon: "üí¨" },
                            { id: "pagelle", label: "Pagelle", icon: "üìù" },
                            { id: "score", label: "Il Mio", icon: "‚≠ê" },
                            ...(adminMode ? [{ id: "admin", label: "Admin", icon: "üëë" }] : []),
                            { id: "impostazioni", label: "Impost.", icon: "‚öôÔ∏è" }
                        ].map(tab => (
                            <button
                                key={tab.id}
                                className={`nav-button ${activeTab === tab.id ? 'active' : ''}`}
                                onClick={() => setActiveTab(tab.id)}
                            >
                                <div className="icon">{tab.icon}</div>
                                <div>{tab.label}</div>
                                
                                {/* Badge notifiche */}
                                {(tab.id === "chat" && notificheChat > 0) && (
                                    <div className="notification-badge">
                                        {notificheChat}
                                    </div>
                                )}
                                {(tab.id === "partite" && notificheCalendario > 0) && (
                                    <div className="notification-badge">
                                        {notificheCalendario}
                                    </div>
                                )}
                            </button>
                        ))}
                    </div>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>