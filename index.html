<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Arena Cup</title>
    
    <!-- METADATI ESSENZIALI -->
    <meta name="theme-color" content="#1a1a2e"/>
    <meta name="description" content="App per la gestione del torneo di calcetto Arena Cup">
    
    <!-- LIBRERIE ESTERNE NECESSARIE -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>
    
    <style>
        /* RESET E STILI BASE */
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
            -webkit-tap-highlight-color: transparent;
        }
        
        /* MODIFICA PRINCIPALE - sfondo tricolore per login */
        body {
            /* Mantieni lo sfondo originale come default */
            background: linear-gradient(135deg, #121212 0%, #1a1a2e 100%);
            min-height: 100vh;
            min-height: -webkit-fill-available;
            color: white;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        }

        /* Sovrascrivi solo quando c'Ã¨ il container di login */
        .login-container {
            background: linear-gradient(90deg, 
                #009246 0%, 
                #009246 33.33%, 
                #FFFFFF 33.33%, 
                #FFFFFF 66.66%, 
                #CE2B37 66.66%, 
                #CE2B37 100%) !important;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            position: relative;
        }

        /* Assicurati che tutto il viewport sia tricolore durante il login */
        body:has(.login-container) {
            background: linear-gradient(90deg, 
                #009246 0%, 
                #009246 33.33%, 
                #FFFFFF 33.33%, 
                #FFFFFF 66.66%, 
                #CE2B37 66.66%, 
                #CE2B37 100%) !important;
        }

        .app-container {
            max-width: 100%;
            margin: 0 auto;
            padding-bottom: 80px;
        }

        /* HEADER */
        .app-header {
            background: rgba(26, 26, 46, 0.95);
            padding: 15px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .desktop-nav {
            display: none;
        }

        .app-content {
            padding: 15px;
        }

        /* BANDIERA ITALIANA SVENTOLANTE */
        .bandiera-sfondo {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: -1;
            opacity: 0.15;
            pointer-events: none;
        }

        .bandiera-container {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 300px;
            height: 200px;
            animation: sventola 3s ease-in-out infinite;
            transform-origin: center;
        }

        .bandiera-italiana {
            display: flex;
            width: 100%;
            height: 100%;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        .bandiera-verde {
            flex: 1;
            background: #009246;
        }

        .bandiera-bianca {
            flex: 1;
            background: #FFFFFF;
        }

        .bandiera-rossa {
            flex: 1;
            background: #CE2B37;
        }

        @keyframes sventola {
            0%, 100% {
                transform: translate(-50%, -50%) rotate(0deg) scale(1);
            }
            25% {
                transform: translate(-50%, -50%) rotate(2deg) scale(1.05);
            }
            75% {
                transform: translate(-50%, -50%) rotate(-2deg) scale(1.05);
            }
        }

        /* BANDIERA HEADER */
        .bandiera-header {
            display: inline-flex;
            width: 30px;
            height: 20px;
            border-radius: 3px;
            overflow: hidden;
            margin-right: 10px;
            vertical-align: middle;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }

        .bandiera-header-verde {
            flex: 1;
            background: #009246;
        }

        .bandiera-header-bianca {
            flex: 1;
            background: #FFFFFF;
        }

        .bandiera-header-rossa {
            flex: 1;
            background: #CE2B37;
        }

        /* BOTTOM NAV MOBILE */
        .app-bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(26, 26, 46, 0.95);
            display: flex;
            padding: 10px;
            border-top: 1px solid rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
        }

        .nav-button {
            flex: 1;
            background: none;
            border: none;
            color: #ccc;
            padding: 8px 5px;
            font-size: 0.7rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .nav-button.active {
            color: #4CAF50;
            background: rgba(76, 175, 80, 0.1);
        }

        .nav-button .icon {
            font-size: 1.2rem;
        }

        /* LOGIN PAGE */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            position: relative;
        }

        .login-form {
            background: rgba(255, 255, 255, 0.95);
            padding: 40px 30px;
            border-radius: 20px;
            width: 100%;
            max-width: 400px;
            text-align: center;
            border: 2px solid rgba(0, 0, 0, 0.1);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
            z-index: 1;
            position: relative;
            color: #333;
        }

        .login-input {
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            border: 1px solid rgba(0,0,0,0.2);
            border-radius: 10px;
            background: rgba(255,255,255,0.9);
            color: #333;
            font-size: 1rem;
            backdrop-filter: blur(10px);
        }

        .login-input::placeholder {
            color: #666;
        }

        .login-button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #009246 0%, #008000 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            cursor: pointer;
            margin-top: 10px;
            font-weight: bold;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .login-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 146, 70, 0.4);
        }

        /* PLAYER CARD */
        .player-card {
            background: rgba(255,255,255,0.05);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            border-left: 4px solid #4CAF50;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .player-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .current-user {
            border-left-color: #FFC107;
            background: rgba(255,193,7,0.1);
        }

        .current-user-badge {
            background: #FFC107;
            color: black;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.7rem;
            margin-left: 8px;
            font-weight: bold;
        }

        /* STATS GRID */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin: 20px 0;
        }

        .stat-card {
            background: rgba(255,255,255,0.05);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-2px);
        }

        /* CLASSIFICA */
        .classifica-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin: 20px 0;
        }

        .classifica-card {
            background: rgba(255,255,255,0.05);
            padding: 15px;
            border-radius: 10px;
        }

        .classifica-item {
            display: flex;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .classifica-pos {
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: #333;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            margin-right: 10px;
        }

        .classifica-pos.oro { 
            background: linear-gradient(135deg, #FFD700 0%, #FFC107 100%);
            color: black;
            font-weight: bold;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }
        .classifica-pos.argento { 
            background: linear-gradient(135deg, #C0C0C0 0%, #A0A0A0 100%);
            color: black;
            font-weight: bold;
        }
        .classifica-pos.bronzo { 
            background: linear-gradient(135deg, #CD7F32 0%, #B87333 100%);
            color: black;
            font-weight: bold;
        }

        .classifica-nome {
            flex: 1;
        }

        .classifica-valore {
            font-weight: bold;
            color: #4CAF50;
        }

        /* MATCH CARD */
        .match-card {
            background: rgba(255,255,255,0.05);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            transition: transform 0.3s ease;
        }

        .match-card:hover {
            transform: translateY(-2px);
        }

        /* MESSAGGI CHAT */
        .message-bubble {
            background: rgba(255,255,255,0.05);
            padding: 10px;
            border-radius: 10px;
            margin-bottom: 10px;
            border-left: 4px solid #2196F3;
        }

        .own-message {
            border-left-color: #4CAF50;
            background: rgba(76, 175, 80, 0.1);
        }

        .admin-message {
            border-left-color: #FFC107;
            background: rgba(255, 193, 7, 0.1);
        }

        /* PAGELLE */
        .pagella-card {
            background: rgba(255,255,255,0.05);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            border-left: 4px solid #9C27B0;
        }

        .fazione-bianca { border-left-color: #FFFFFF; }
        .fazione-nera { border-left-color: #000000; }
        .fazione-rossa { border-left-color: #F44336; }

        .badge-fazione {
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.7rem;
            margin-left: 8px;
            font-weight: bold;
        }

        .badge-bianca { background: #FFFFFF; color: black; }
        .badge-nera { background: #000000; color: white; }
        .badge-rossa { background: #F44336; color: white; }

        /* BACKUP SECTION */
        .backup-section {
            background: rgba(255,255,255,0.05);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        /* SCORE STATS */
        .score-stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin: 15px 0;
        }

        .score-stat-card {
            background: rgba(255,255,255,0.08);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .score-stat-label {
            font-size: 0.8rem;
            color: #ccc;
            margin-bottom: 5px;
        }

        .score-stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #4CAF50;
        }

        /* BACKUP STATS */
        .backup-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin: 15px 0;
        }

        .backup-stat {
            text-align: center;
            padding: 10px;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
        }

        /* BACKUP ACTIONS */
        .backup-actions {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin: 15px 0;
        }

        .btn-backup {
            padding: 12px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            color: white;
            transition: transform 0.3s ease;
        }

        .btn-backup:hover {
            transform: translateY(-2px);
        }

        .btn-backup.export { background: #4CAF50; }
        .btn-backup.restore { background: #2196F3; }
        .btn-backup.danger { background: #F44336; }

        .file-input-label {
            padding: 12px;
            background: #FFC107;
            color: black;
            text-align: center;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: transform 0.3s ease;
        }

        .file-input-label:hover {
            transform: translateY(-2px);
        }

        .file-input {
            display: none;
        }

        /* EMPTY STATE */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #888;
        }

        .empty-state .icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        /* NOTIFICATION BADGE */
        .notification-badge {
            background: #F44336;
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
            position: absolute;
            top: -2px;
            right: -2px;
        }

        /* NUMBER INPUT */
        .number-input {
            padding: 8px;
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 6px;
            background: rgba(255,255,255,0.1);
            color: white;
            width: 70px;
            font-size: 0.8rem;
        }

        /* SETTINGS */
        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: #4CAF50;
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        /* PROGRESS BAR */
        .progress-bar {
            width: 100%;
            height: 6px;
            background: rgba(255,255,255,0.1);
            border-radius: 3px;
            margin-top: 8px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        .progress-fill.vinte { background: #4CAF50; }
        .progress-fill.perse { background: #F44336; }

        /* SCORE HEADER */
        .score-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .score-avatar {
            width: 60px;
            height: 60px;
            background: #4CAF50;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: bold;
            margin: 0 auto 15px;
        }

        /* BADGES */
        .mvp-badge {
            background: #FFC107;
            color: black;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.7rem;
            margin-left: 8px;
            font-weight: bold;
        }

        .presenze-badge {
            background: #2196F3;
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.7rem;
            margin-left: 8px;
            font-weight: bold;
        }

        /* MVP STATS */
        .mvp-stats {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 8px;
        }

        .mvp-stat {
            background: rgba(255,255,255,0.1);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.7rem;
        }

        /* GESTIONE GIOCATORI ADMIN */
        .giocatore-admin-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .giocatore-admin-nome {
            flex: 1;
            font-weight: bold;
        }

        .giocatore-admin-stats {
            display: flex;
            gap: 15px;
            margin: 0 15px;
        }

        .giocatore-admin-actions {
            display: flex;
            gap: 5px;
        }

        .btn-elimina {
            background: #F44336;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.7rem;
        }

        /* AGGIUNGI GIOCATORE */
        .aggiungi-giocatore-form {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .aggiungi-giocatore-input {
            flex: 1;
            padding: 10px;
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            background: rgba(255,255,255,0.1);
            color: white;
            min-width: 200px;
        }

        /* CONFERMATI PARTITA */
        .confermato-list {
            margin-top: 15px;
        }

        .confermato-item {
            display: inline-block;
            background: rgba(76, 175, 80, 0.2);
            padding: 5px 10px;
            border-radius: 15px;
            margin: 2px 5px 2px 0;
            font-size: 0.8rem;
        }

        .confermato-item.current-user {
            background: rgba(255, 193, 7, 0.3);
            font-weight: bold;
        }

        /* PAGELLA HEADER */
        .pagella-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }

        .pagella-giocatore {
            font-weight: bold;
            font-size: 1.1rem;
            margin-bottom: 5px;
        }

        .pagella-data {
            font-size: 0.8rem;
            color: #ccc;
        }

        .pagella-voto {
            font-size: 1.5rem;
            font-weight: bold;
            color: #FFC107;
        }

        .pagella-commento {
            font-style: italic;
            color: #ccc;
            margin-bottom: 10px;
            padding: 10px;
            background: rgba(255,255,255,0.05);
            border-radius: 6px;
        }

        .pagella-actions {
            text-align: right;
        }

        /* MODIFICA PAGELLA */
        .modifica-pagella-form {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
        }

        .modifica-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        /* SELECT */
        .voto-select, .fazione-select, .giocatore-select {
            padding: 10px;
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            background: rgba(255,255,255,0.1);
            color: white;
            min-width: 120px;
        }

        /* NOTIFICATION SETTINGS */
        .notification-settings {
            background: rgba(255,255,255,0.05);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        /* GESTIONE GIOCATORI */
        .gestione-giocatori {
            background: rgba(255,255,255,0.05);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .lista-giocatori-admin {
            max-height: 300px;
            overflow-y: auto;
            margin-top: 15px;
        }

        /* PASSWORD HINT */
        .password-hint {
            font-size: 0.8rem;
            color: #CE2B37;
            margin: 5px 0;
            text-align: left;
        }

        /* TEXTAREA PAGELLA */
        .pagella-textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            background: rgba(255,255,255,0.1);
            color: white;
            font-size: 1rem;
            resize: vertical;
            min-height: 100px;
            font-family: inherit;
        }

        /* MVP GLOW EFFECT */
        .mvp-glow {
            position: relative;
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.15) 0%, rgba(255, 193, 7, 0.25) 100%) !important;
            border: 2px solid rgba(255, 215, 0, 0.3) !important;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.4), 0 0 40px rgba(255, 193, 7, 0.2);
            animation: mvpPulse 2s ease-in-out infinite alternate;
        }

        @keyframes mvpPulse {
            0% {
                box-shadow: 0 0 15px rgba(255, 215, 0, 0.3), 0 0 30px rgba(255, 193, 7, 0.15);
                transform: scale(1);
            }
            100% {
                box-shadow: 0 0 25px rgba(255, 215, 0, 0.6), 0 0 50px rgba(255, 193, 7, 0.3);
                transform: scale(1.02);
            }
        }

        .mvp-glow-item {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.1) 0%, rgba(255, 193, 7, 0.2) 100%) !important;
            border-left: 4px solid #FFD700 !important;
            animation: mvpItemPulse 3s ease-in-out infinite;
        }

        @keyframes mvpItemPulse {
            0%, 100% {
                background: linear-gradient(135deg, rgba(255, 215, 0, 0.1) 0%, rgba(255, 193, 7, 0.2) 100%);
            }
            50% {
                background: linear-gradient(135deg, rgba(255, 215, 0, 0.15) 0%, rgba(255, 193, 7, 0.25) 100%);
            }
        }

        .mvp-crown {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #FFD700;
            color: black;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
            box-shadow: 0 2px 8px rgba(255, 215, 0, 0.5);
            animation: crownSpin 4s linear infinite;
        }

        @keyframes crownSpin {
            0% { transform: rotate(0deg) scale(1); }
            25% { transform: rotate(5deg) scale(1.1); }
            50% { transform: rotate(0deg) scale(1); }
            75% { transform: rotate(-5deg) scale(1.1); }
            100% { transform: rotate(0deg) scale(1); }
        }

        /* RISULTATO PARTITA */
        .risultato-partita {
            margin: 10px 0;
            padding: 12px;
            border-radius: 8px;
            text-align: center;
            font-weight: bold;
            font-size: 1.1rem;
        }

        .risultato-vittoria {
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.2) 0%, rgba(76, 175, 80, 0.3) 100%);
            border: 2px solid #4CAF50;
            color: #4CAF50;
        }

        .risultato-sconfitta {
            background: linear-gradient(135deg, rgba(244, 67, 54, 0.2) 0%, rgba(244, 67, 54, 0.3) 100%);
            border: 2px solid #F44336;
            color: #F44336;
        }

        .risultato-pareggio {
            background: linear-gradient(135deg, rgba(255, 193, 7, 0.2) 0%, rgba(255, 193, 7, 0.3) 100%);
            border: 2px solid #FFC107;
            color: #FFC107;
        }

        /* FAZIONE VINCENTE */
        .fazione-vincente {
            display: inline-block;
            padding: 8px 15px;
            margin: 5px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 1rem;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        .fazione-bianca-vittoria {
            background: linear-gradient(135deg, #FFFFFF 0%, #E0E0E0 100%);
            color: #333;
            border: 2px solid #FFFFFF;
        }

        .fazione-nera-vittoria {
            background: linear-gradient(135deg, #333 0%, #000 100%);
            color: white;
            border: 2px solid #666;
        }

        .fazione-rossa-vittoria {
            background: linear-gradient(135deg, #F44336 0%, #D32F2F 100%);
            color: white;
            border: 2px solid #F44336;
        }

        /* BADGE RISULTATO */
        .badge-risultato {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 5px 10px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: bold;
            z-index: 2;
        }

        .badge-vittoria { background: #4CAF50; color: white; }
        .badge-sconfitta { background: #F44336; color: white; }
        .badge-pareggio { background: #FFC107; color: black; }

        /* BADGE COPPA */
        .badge-coppa {
            background: linear-gradient(135deg, #FFD700 0%, #FFC107 100%);
            color: black;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: bold;
            margin-left: 8px;
            border: 1px solid #FFC107;
            box-shadow: 0 2px 4px rgba(255, 193, 7, 0.3);
        }

        /* FOTO PROFILO */
        .foto-profilo-container {
            position: relative;
            display: inline-block;
        }

        .foto-profilo {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid #4CAF50;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 1.2rem;
        }

        .foto-profilo-small {
            width: 35px;
            height: 35px;
            font-size: 0.9rem;
        }

        .foto-profilo-large {
            width: 80px;
            height: 80px;
            font-size: 2rem;
        }

        .foto-profilo-placeholder {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .aggiungi-foto-btn {
            position: absolute;
            bottom: -5px;
            right: -5px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }

        /* MODAL FOTO */
        .modal-foto {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 20px;
        }

        .modal-foto-content {
            background: #1a1a2e;
            padding: 30px;
            border-radius: 15px;
            max-width: 500px;
            width: 100%;
            text-align: center;
        }

        .modal-foto-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .btn-foto {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            color: white;
            flex: 1;
            min-width: 120px;
        }

        .btn-foto.scatta { background: #2196F3; }
        .btn-foto.carica { background: #4CAF50; }
        .btn-foto.annulla { background: #F44336; }
        .btn-foto.rimuovi { background: #FF9800; }

        .anteprima-foto {
            width: 200px;
            height: 200px;
            border-radius: 10px;
            object-fit: cover;
            margin: 15px auto;
            border: 3px solid #4CAF50;
            display: none;
        }

        .video-camera {
            width: 100%;
            max-width: 400px;
            height: 300px;
            background: #000;
            border-radius: 10px;
            margin: 15px auto;
            display: none;
        }

        .controlli-camera {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 15px;
        }

        /* RIMUOVI MVP */
        .btn-rimuovi-mvp {
            background: #F44336;
            color: white;
            border: none;
            padding: 6px 10px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.7rem;
            margin-left: 5px;
        }

        .btn-rimuovi-mvp:disabled {
            background: #666;
            cursor: not-allowed;
        }

        /* CLASSIFICA CON FOTO */
        .classifica-item-con-foto {
            display: flex;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .classifica-foto {
            margin-right: 10px;
        }

        .classifica-info {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        /* GIOCATORE NON GIOCANTE */
        .giocatore-non-giocante {
            opacity: 0.6;
            filter: grayscale(0.5);
        }

        .giocatore-non-giocante .classifica-nome {
            color: #888 !important;
        }

        .badge-non-giocante {
            background: #666;
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.7rem;
            margin-left: 8px;
            font-weight: bold;
        }

        /* CLASSIFICA WINRATE */
        .classifica-winrate {
            background: linear-gradient(135deg, rgba(26, 26, 46, 0.9) 0%, rgba(18, 18, 32, 0.9) 100%);
            border: 1px solid rgba(255, 215, 0, 0.3);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .winrate-stats {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .winrate-numbers {
            display: flex;
            gap: 15px;
            font-size: 0.9rem;
        }

        .winrate-vittorie {
            color: #4CAF50;
            font-weight: bold;
        }

        .winrate-sconfitte {
            color: #F44336;
            font-weight: bold;
        }

        .winrate-pareggi {
            color: #FFC107;
            font-weight: bold;
        }

        .winrate-percentuale {
            font-size: 1.2rem;
            font-weight: bold;
            color: #FFD700;
        }

        /* PROGRESS CONTAINER */
        .progress-container {
            margin-top: 10px;
        }

        .progress-labels {
            display: flex;
            justify-content: space-between;
            font-size: 0.7rem;
            color: #ccc;
            margin-top: 5px;
        }

        .progress-bar-winrate {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 5px;
        }

        .progress-fill-winrate {
            height: 100%;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.6rem;
            color: white;
            font-weight: bold;
            transition: width 0.5s ease;
        }

        .progress-vittorie { background: linear-gradient(90deg, #4CAF50, #8BC34A); }
        .progress-sconfitte { background: linear-gradient(90deg, #F44336, #FF5722); }
        .progress-pareggi { background: linear-gradient(90deg, #FFC107, #FF9800); }

        /* BADGE PARTITE GIOCATE */
        .badge-partite-giocate {
            background: #2196F3;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            margin-left: 8px;
            font-weight: bold;
        }

        .badge-media-voto {
            background: #9C27B0;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            margin-left: 8px;
            font-weight: bold;
        }

        /* PAGELLA GROUP HEADER */
        .pagella-group-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 15px;
            border-radius: 10px;
            margin: 20px 0 15px 0;
            text-align: center;
            font-weight: bold;
            border-left: 4px solid #FFD700;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }

        /* CREDITS */
        .credits {
            font-size: 0.8rem;
            color: #666;
            margin-top: 20px;
            text-align: center;
        }

        /* DESKTOP STYLES */
        @media (min-width: 768px) {
            .desktop-nav {
                display: flex;
                gap: 10px;
                margin-top: 15px;
                flex-wrap: wrap;
            }

            .desktop-nav-button {
                background: rgba(255,255,255,0.05);
                border: none;
                color: #ccc;
                padding: 10px 15px;
                border-radius: 8px;
                cursor: pointer;
                transition: all 0.3s ease;
                position: relative;
            }

            .desktop-nav-button.active {
                background: #4CAF50;
                color: white;
            }

            .desktop-notification-badge {
                background: #F44336;
                color: white;
                border-radius: 50%;
                width: 20px;
                height: 20px;
                font-size: 0.7rem;
                display: flex;
                align-items: center;
                justify-content: center;
                position: absolute;
                top: -5px;
                right: -5px;
            }

            .app-bottom-nav {
                display: none;
            }

            .stats-grid {
                grid-template-columns: repeat(4, 1fr);
            }

            .classifica-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .score-stats-grid {
                grid-template-columns: repeat(4, 1fr);
            }

            .backup-stats {
                grid-template-columns: repeat(4, 1fr);
            }

            .backup-actions {
                flex-direction: row;
                flex-wrap: wrap;
            }

            .btn-backup {
                flex: 1;
                min-width: 150px;
            }

            .pagella-textarea {
                min-height: 120px;
            }

            .mvp-glow {
                animation: mvpPulse 2s ease-in-out infinite alternate;
            }

            .foto-profilo {
                width: 60px;
                height: 60px;
                font-size: 1.4rem;
            }

            .foto-profilo-small {
                width: 40px;
                height: 40px;
                font-size: 1rem;
            }

            .foto-profilo-large {
                width: 100px;
                height: 100px;
                font-size: 2.5rem;
            }

            .pagella-group-header {
                font-size: 1.1rem;
                padding: 15px 20px;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        // ==================== CONFIGURAZIONE ====================
        const { useState, useEffect, useRef } = React;

        // ðŸ” COSTANTI DI ACCESSO
        const ADMIN_PASSWORD = "giulia85";
        const FABRIZIO_PASSWORD = "manetta2025";

        // ðŸ”¥ CONFIGURAZIONE FIREBASE
        const firebaseConfig = {
            apiKey: "AIzaSyB5SnZlEKD-LO4i2wfgh_oawW5Pgn6mnQI",
            authDomain: "arenacup-18302.firebaseapp.com",
            databaseURL: "https://arenacup-18302-default-rtdb.firebaseio.com",
            projectId: "arenacup-18302",
            storageBucket: "arenacup-18302.firebasestorage.app",
            messagingSenderId: "801433859154",
            appId: "1:801433859154:web:7d1f76129a59b3521c5b8b"
        };

        // ðŸš€ INIZIALIZZA FIREBASE
        const app = firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const storage = firebase.storage();

        // ==================== COMPONENTE FOTO PROFILO ====================
        const FotoProfiloManager = ({ giocatore, onFotoCambiata, size = "medium" }) => {
            const [showModal, setShowModal] = useState(false);
            const [fotoSelezionata, setFotoSelezionata] = useState(null);
            const [anteprimaFoto, setAnteprimaFoto] = useState(null);
            const [modalitaCamera, setModalitaCamera] = useState(false);
            
            const videoRef = useRef(null);
            const canvasRef = useRef(null);
            const streamRef = useRef(null);
            const fileInputRef = useRef(null);

            const dimensioni = {
                small: "foto-profilo-small",
                medium: "foto-profilo",
                large: "foto-profilo-large"
            };

            const classeDimensione = dimensioni[size] || dimensioni.medium;
            const [fotoUrl, setFotoUrl] = useState(null);

            // CARICA FOTO DA STORAGE
            const caricaFotoProfilo = async () => {
                try {
                    const fotoUrl = await storage.ref(`profili/${giocatore.id}.jpg`).getDownloadURL();
                    return fotoUrl;
                } catch (error) {
                    return null;
                }
            };

            useEffect(() => {
                caricaFotoProfilo().then(url => setFotoUrl(url));
            }, [giocatore.id]);

            // INIZIALIZZA CAMERA
            const inizializzaCamera = async () => {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ 
                        video: { facingMode: 'user' } 
                    });
                    streamRef.current = stream;
                    videoRef.current.srcObject = stream;
                    setModalitaCamera(true);
                } catch (error) {
                    console.error("Errore accesso camera:", error);
                    alert("Impossibile accedere alla fotocamera. Controlla i permessi.");
                }
            };

            // SCATTA FOTO
            const scattaFoto = () => {
                const video = videoRef.current;
                const canvas = canvasRef.current;
                const context = canvas.getContext('2d');
                
                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;
                context.drawImage(video, 0, 0);
                
                const fotoDataUrl = canvas.toDataURL('image/jpeg');
                setAnteprimaFoto(fotoDataUrl);
                setFotoSelezionata(fotoDataUrl);
                setModalitaCamera(false);
                
                if (streamRef.current) {
                    streamRef.current.getTracks().forEach(track => track.stop());
                }
            };

            // CARICA FOTO DA DISPOSITIVO
            const gestisciCaricamentoFoto = (event) => {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        setAnteprimaFoto(e.target.result);
                        setFotoSelezionata(e.target.result);
                    };
                    reader.readAsDataURL(file);
                }
            };

            // SALVA FOTO SU STORAGE
            const salvaFoto = async () => {
                if (!fotoSelezionata) return;
                
                try {
                    const response = await fetch(fotoSelezionata);
                    const blob = await response.blob();
                    
                    const uploadTask = storage.ref(`profili/${giocatore.id}.jpg`).put(blob);
                    
                    uploadTask.on('state_changed',
                        (snapshot) => {
                            const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                            console.log(`Upload: ${progress}%`);
                        },
                        (error) => {
                            console.error("Errore upload:", error);
                            alert("Errore nel salvataggio della foto");
                        },
                        async () => {
                            const downloadURL = await uploadTask.snapshot.ref.getDownloadURL();
                            setFotoUrl(downloadURL);
                            setShowModal(false);
                            setFotoSelezionata(null);
                            setAnteprimaFoto(null);
                            
                            await database.ref(`giocatori/${giocatore.id}`).update({
                                foto_profilo: downloadURL
                            });
                            
                            if (onFotoCambiata) {
                                onFotoCambiata(downloadURL);
                            }
                            
                            alert("âœ… Foto profilo aggiornata con successo!");
                        }
                    );
                    
                } catch (error) {
                    console.error("Errore salvataggio foto:", error);
                    alert("Errore nel salvataggio della foto");
                }
            };

            // RIMUOVI FOTO
            const rimuoviFoto = async () => {
                try {
                    await storage.ref(`profili/${giocatore.id}.jpg`).delete();
                    
                    await database.ref(`giocatori/${giocatore.id}`).update({
                        foto_profilo: null
                    });
                    
                    setFotoUrl(null);
                    setShowModal(false);
                    
                    if (onFotoCambiata) {
                        onFotoCambiata(null);
                    }
                    
                    alert("âœ… Foto profilo rimossa!");
                } catch (error) {
                    console.error("Errore rimozione foto:", error);
                    alert("Errore nella rimozione della foto");
                }
            };

            // CHIUDI MODAL
            const chiudiModal = () => {
                setShowModal(false);
                setFotoSelezionata(null);
                setAnteprimaFoto(null);
                setModalitaCamera(false);
                
                if (streamRef.current) {
                    streamRef.current.getTracks().forEach(track => track.stop());
                }
            };

            return (
                <div className="foto-profilo-container">
                    {fotoUrl ? (
                        <img 
                            src={fotoUrl} 
                            alt={`Foto di ${giocatore.nome}`}
                            className={`${classeDimensione} foto-profilo`}
                            onClick={() => setShowModal(true)}
                            style={{ cursor: 'pointer' }}
                        />
                    ) : (
                        <div 
                            className={`${classeDimensione} foto-profilo foto-profilo-placeholder`}
                            onClick={() => setShowModal(true)}
                            style={{ cursor: 'pointer' }}
                        >
                            {giocatore.nome.charAt(0).toUpperCase()}
                        </div>
                    )}
                    
                    <button 
                        className="aggiungi-foto-btn"
                        onClick={() => setShowModal(true)}
                        title="Cambia foto profilo"
                    >
                        ðŸ“·
                    </button>

                    {/* MODAL FOTO */}
                    {showModal && (
                        <div className="modal-foto">
                            <div className="modal-foto-content">
                                <h3>ðŸ“· Foto Profilo di {giocatore.nome}</h3>
                                
                                {fotoUrl && !anteprimaFoto && (
                                    <div style={{ textAlign: 'center', margin: '15px 0' }}>
                                        <p>Foto attuale:</p>
                                        <img 
                                            src={fotoUrl} 
                                            alt="Foto attuale"
                                            className="anteprima-foto"
                                            style={{ display: 'block' }}
                                        />
                                    </div>
                                )}
                                
                                {modalitaCamera && (
                                    <>
                                        <video 
                                            ref={videoRef}
                                            autoPlay
                                            playsInline
                                            className="video-camera"
                                            style={{ display: 'block' }}
                                        />
                                        <div className="controlli-camera">
                                            <button 
                                                className="btn-foto scatta"
                                                onClick={scattaFoto}
                                            >
                                                Scatta Foto
                                            </button>
                                            <button 
                                                className="btn-foto annulla"
                                                onClick={() => setModalitaCamera(false)}
                                            >
                                                Annulla
                                            </button>
                                        </div>
                                    </>
                                )}
                                
                                {anteprimaFoto && (
                                    <img 
                                        src={anteprimaFoto} 
                                        alt="Anteprima nuova foto"
                                        className="anteprima-foto"
                                        style={{ display: 'block' }}
                                    />
                                )}
                                
                                <canvas ref={canvasRef} style={{ display: 'none' }} />
                                
                                <input 
                                    type="file"
                                    ref={fileInputRef}
                                    accept="image/*"
                                    onChange={gestisciCaricamentoFoto}
                                    style={{ display: 'none' }}
                                />
                                
                                <div className="modal-foto-actions">
                                    {!modalitaCamera && !anteprimaFoto && (
                                        <>
                                            <button 
                                                className="btn-foto scatta"
                                                onClick={inizializzaCamera}
                                            >
                                                ðŸ“¸ Scatta Foto
                                            </button>
                                            <button 
                                                className="btn-foto carica"
                                                onClick={() => fileInputRef.current?.click()}
                                            >
                                                ðŸ“ Carica da Device
                                            </button>
                                        </>
                                    )}
                                    
                                    {anteprimaFoto && (
                                        <>
                                            <button 
                                                className="btn-foto carica"
                                                onClick={salvaFoto}
                                            >
                                                ðŸ’¾ Salva Foto
                                            </button>
                                            <button 
                                                className="btn-foto annulla"
                                                onClick={() => {
                                                    setAnteprimaFoto(null);
                                                    setFotoSelezionata(null);
                                                }}
                                            >
                                                ðŸ”„ Riprova
                                            </button>
                                        </>
                                    )}
                                    
                                    {fotoUrl && (
                                        <button 
                                            className="btn-foto rimuovi"
                                            onClick={rimuoviFoto}
                                        >
                                            ðŸ—‘ï¸ Rimuovi Foto
                                        </button>
                                    )}
                                    
                                    <button 
                                        className="btn-foto annulla"
                                        onClick={chiudiModal}
                                    >
                                        âŒ Annulla
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // ==================== BANDIERA ITALIANA ====================
        const BandieraSfondo = () => (
            <div className="bandiera-sfondo">
                <div className="bandiera-container">
                    <div className="bandiera-italiana">
                        <div className="bandiera-verde"></div>
                        <div className="bandiera-bianca"></div>
                        <div className="bandiera-rossa"></div>
                    </div>
                </div>
            </div>
        );

        const BandieraHeader = () => (
            <div className="bandiera-header">
                <div className="bandiera-header-verde"></div>
                <div className="bandiera-header-bianca"></div>
                <div className="bandiera-header-rossa"></div>
            </div>
        );

        // ==================== APP PRINCIPALE ====================
        function App() {
            const [loginForm, setLoginForm] = useState({
                username: localStorage.getItem("username") || "",
                password: ""
            });
            const [isLogged, setIsLogged] = useState(!!localStorage.getItem("username"));
            const [activeTab, setActiveTab] = useState("classifica");
            
            const [giocatori, setGiocatori] = useState([]);
            const [messaggi, setMessaggi] = useState([]);
            const [partite, setPartite] = useState([]);
            const [pagelle, setPagelle] = useState([]);
            const [nuovoMessaggio, setNuovoMessaggio] = useState("");
            const [nuovaPagella, setNuovaPagella] = useState({
                giocatore: "",
                voto: "",
                commento: "",
                data: new Date().toISOString().split('T')[0],
                fazione: "nessuna"
            });
            const [pagellaInModifica, setPagellaInModifica] = useState(null);
            const [modificaPagella, setModificaPagella] = useState({
                voto: "",
                commento: "",
                fazione: "nessuna"
            });
            const [nuovoGiocatore, setNuovoGiocatore] = useState("");
            const [currentMVP, setCurrentMVP] = useState(null);
            
            const chatContainerRef = useRef(null);
            const fileInputRef = useRef(null);

            // ðŸ” LOGIN
            const handleLogin = (e) => {
                e.preventDefault();
                if (!loginForm.username.trim()) {
                    alert("Inserisci un nome utente!");
                    return;
                }

                if (loginForm.username.toLowerCase() === "admin" || loginForm.username.toLowerCase() === "vitantonio") {
                    if (loginForm.password !== ADMIN_PASSWORD) {
                        alert("âŒ Password admin errata!");
                        return;
                    }
                }
                
                if (loginForm.username.toLowerCase() === "fabrizio") {
                    if (loginForm.password !== FABRIZIO_PASSWORD) {
                        alert("âŒ Password Fabrizio errata!");
                        return;
                    }
                }
                
                localStorage.setItem("username", loginForm.username);
                setIsLogged(true);
            };

            // ðŸ‘‘ CONTROLLO ADMIN
            const isAdminUser = () => {
                const username = loginForm.username.toLowerCase();
                return username === "admin" || username === "vitantonio" || username === "fabrizio";
            };

            // ðŸ“Š CONTROLLA SE GIOCATORE HA GIOCATO
            const hasGiocatoAlmenoUnaPartita = (giocatore) => {
                if (!giocatore) return false;
                
                if ((giocatore.presenze || 0) > 0) return true;
                
                const pagelleGiocatore = pagelle.filter(p => p.giocatore === giocatore.nome);
                if (pagelleGiocatore.length > 0) return true;
                
                if ((giocatore.parate || 0) > 0 || (giocatore.partite_portiere || 0) > 0) return true;
                
                return false;
            };

            // â­ CALCOLA MEDIA SICURA
            const getMediaSicura = (giocatore) => {
                if (!giocatore) return "0.00";
                
                if (!hasGiocatoAlmenoUnaPartita(giocatore)) return "0.00";
                
                const media = parseFloat(giocatore.media_calcolata);
                
                if (isNaN(media) || !isFinite(media)) {
                    const pagelleGiocatore = pagelle.filter(p => p.giocatore === giocatore.nome);
                    if (pagelleGiocatore.length === 0) return "0.00";
                    
                    const sommaVoti = pagelleGiocatore.reduce((sum, pagella) => {
                        const voto = parseFloat(pagella.voto);
                        return sum + (isNaN(voto) ? 0 : voto);
                    }, 0);
                    
                    const nuovaMedia = sommaVoti / pagelleGiocatore.length;
                    return nuovaMedia.toFixed(2);
                }
                
                return media.toFixed(2);
            };

            // ðŸŽ¯ AGGIORNA MEDIA GIOCATORE
            const aggiornaMediaGiocatore = (nomeGiocatore) => {
                const giocatore = giocatori.find(g => g.nome === nomeGiocatore);
                if (!giocatore) return;
                
                if (!hasGiocatoAlmenoUnaPartita(giocatore)) {
                    database.ref(`giocatori/${giocatore.id}`).update({
                        media_calcolata: 0,
                        voti: []
                    });
                    return;
                }
                
                const pagelleGiocatore = pagelle.filter(p => p.giocatore === nomeGiocatore);
                if (pagelleGiocatore.length === 0) {
                    database.ref(`giocatori/${giocatore.id}`).update({
                        media_calcolata: 0,
                        voti: []
                    });
                    return;
                }
                
                const sommaVoti = pagelleGiocatore.reduce((sum, pagella) => {
                    const voto = parseFloat(pagella.voto);
                    return sum + (isNaN(voto) ? 0 : voto);
                }, 0);
                
                const media = sommaVoti / pagelleGiocatore.length;
                
                database.ref(`giocatori/${giocatore.id}`).update({
                    media_calcolata: media.toFixed(2),
                    voti: pagelleGiocatore.map(p => parseFloat(p.voto))
                }).then(() => {
                    console.log(`âœ… Media aggiornata per ${nomeGiocatore}: ${media.toFixed(2)}`);
                });
            };

            // ðŸ§¤ AGGIUNGI STAT PORTIERE
            const aggiungiStatPortiere = (id, tipo, quantitaInput) => {
                if (!isAdminUser()) return alert("Solo gli admin possono aggiornare le statistiche portiere!");
                
                const giocatore = giocatori.find(g => g.id === id);
                if (!giocatore) return;
                
                const quantita = parseInt(quantitaInput);
                if (isNaN(quantita)) return alert("Inserisci un numero valido!");
                
                const nuovoValore = Math.max(0, (giocatore[tipo] || 0) + quantita);
                
                database.ref(`giocatori/${id}`).update({
                    [tipo]: nuovoValore
                }).then(() => {
                    const azione = quantita >= 0 ? "aggiunte" : "rimosse";
                    alert(`${Math.abs(quantita)} ${tipo} ${azione}!`);
                    document.getElementById(`${tipo}-${id}`).value = "";
                });
            };

            // ðŸ† TROVA MVP ATTUALE
            const getCurrentMVP = () => {
                if (giocatori.length === 0) return null;
                
                let ultimoTimestamp = 0;
                let ultimoMVP = null;
                
                giocatori.forEach(giocatore => {
                    if (giocatore.last_mvp_timestamp && giocatore.last_mvp_timestamp > ultimoTimestamp) {
                        ultimoTimestamp = giocatore.last_mvp_timestamp;
                        ultimoMVP = giocatore;
                    }
                });
                
                if (!ultimoMVP) {
                    const giocatoriCheHannoGiocato = giocatori.filter(hasGiocatoAlmenoUnaPartita);
                    if (giocatoriCheHannoGiocato.length === 0) return null;
                    
                    const maxMVP = Math.max(...giocatoriCheHannoGiocato.map(g => g.mvp_count || 0));
                    if (maxMVP === 0) return null;
                    
                    const giocatoriConMaxMVP = giocatoriCheHannoGiocato.filter(g => (g.mvp_count || 0) === maxMVP);
                    
                    if (giocatoriConMaxMVP.length === 1) return giocatoriConMaxMVP[0];
                    
                    if (giocatoriConMaxMVP.length > 1) {
                        let ultimo = giocatoriConMaxMVP[0];
                        giocatoriConMaxMVP.forEach(g => {
                            if ((g.last_mvp_timestamp || 0) > (ultimo.last_mvp_timestamp || 0)) {
                                ultimo = g;
                            }
                        });
                        return ultimo;
                    }
                }
                
                return ultimoMVP;
            };

            // ðŸ“ˆ CALCOLA STATISTICHE PARTITE
            const calcolaStatistichePartite = (giocatore) => {
                if (!hasGiocatoAlmenoUnaPartita(giocatore)) {
                    return {
                        vittorie: 0,
                        sconfitte: 0,
                        pareggi: 0,
                        partiteGiocate: 0,
                        percentualeVittorie: 0,
                        percentualeSconfitte: 0,
                        percentualePareggi: 0,
                        winRate: "0.0"
                    };
                }
                
                const vittorie = giocatore.vittorie || 0;
                const sconfitte = giocatore.sconfitte || 0;
                const pareggi = giocatore.pareggi || 0;
                const partiteGiocate = vittorie + sconfitte + pareggi;
                
                if (partiteGiocate === 0) {
                    return {
                        vittorie: 0,
                        sconfitte: 0,
                        pareggi: 0,
                        partiteGiocate: 0,
                        percentualeVittorie: 0,
                        percentualeSconfitte: 0,
                        percentualePareggi: 0,
                        winRate: "0.0"
                    };
                }
                
                const percentualeVittorie = (vittorie / partiteGiocate) * 100;
                const percentualeSconfitte = (sconfitte / partiteGiocate) * 100;
                const percentualePareggi = (pareggi / partiteGiocate) * 100;
                const winRate = partiteGiocate > 0 ? percentualeVittorie.toFixed(1) : "0.0";
                
                return {
                    vittorie,
                    sconfitte,
                    pareggi,
                    partiteGiocate,
                    percentualeVittorie: percentualeVittorie.toFixed(1),
                    percentualeSconfitte: percentualeSconfitte.toFixed(1),
                    percentualePareggi: percentualePareggi.toFixed(1),
                    winRate
                };
            };

            // ðŸ“Š CALCOLA VITTORIE PER FAZIONE
            const calcolaVittorieFazioni = () => {
                const vittorieFazioni = { bianca: 0, nera: 0, rossa: 0 };
                partite.forEach(partita => {
                    if (partita.risultato === 'Vittoria' && partita.fazione_vincente) {
                        vittorieFazioni[partita.fazione_vincente]++;
                    }
                });
                return vittorieFazioni;
            };

            // âž• AGGIUNGI GIOCATORE
            const aggiungiGiocatore = () => {
                if (!isAdminUser()) return alert("Solo gli admin possono aggiungere giocatori!");
                if (!nuovoGiocatore.trim()) return alert("Inserisci un nome per il giocatore!");
                
                const esisteGiÃ  = giocatori.some(g => 
                    g.nome.toLowerCase() === nuovoGiocatore.toLowerCase()
                );
                
                if (esisteGiÃ ) {
                    alert("âŒ Questo giocatore esiste giÃ !");
                    return;
                }
                
                database.ref('giocatori').push({
                    nome: nuovoGiocatore,
                    gol: 0,
                    assist: 0,
                    voti: [],
                    media_calcolata: 0,
                    mvp_count: 0,
                    presenze: 0,
                    vittorie: 0,
                    sconfitte: 0,
                    pareggi: 0,
                    partite_portiere: 0,
                    parate: 0,
                    gol_subiti: 0,
                    rigori_parati: 0,
                    uscite_vinte: 0,
                    assist_portiere: 0,
                    parate_difficili: 0,
                    rinvii_buoni: 0,
                    errori: 0,
                    interventi_decisivi: 0,
                    foto_profilo: null,
                    last_mvp_timestamp: 0,
                    created_at: new Date().toLocaleString('it-IT')
                }).then(() => {
                    setNuovoGiocatore("");
                    alert("âœ… Giocatore aggiunto con successo!");
                }).catch(error => {
                    console.error("Errore aggiunta giocatore:", error);
                    alert("âŒ Errore durante l'aggiunta del giocatore");
                });
            };

            // ðŸ—‘ï¸ ELIMINA GIOCATORE
            const eliminaGiocatore = (id, nome) => {
                if (!isAdminUser()) return alert("Solo gli admin possono eliminare giocatori!");
                if (!confirm(`Sei sicuro di voler eliminare ${nome}? Questa azione Ã¨ irreversibile!`)) return;
                
                try {
                    storage.ref(`profili/${id}.jpg`).delete().catch(() => {
                        console.log("Nessuna foto profilo da eliminare");
                    });
                } catch (error) {
                    console.log("Errore eliminazione foto profilo:", error);
                }
                
                database.ref(`giocatori/${id}`).remove()
                    .then(() => {
                        alert(`âœ… Giocatore ${nome} eliminato con successo!`);
                    })
                    .catch(error => {
                        console.error("Errore eliminazione giocatore:", error);
                        alert("âŒ Errore durante l'eliminazione del giocatore");
                    });
            };

            // ðŸ’¾ ESPORTA BACKUP
            const esportaBackup = () => {
                if (!isAdminUser()) return alert("Solo gli admin possono esportare backup!");
                
                Promise.all([
                    database.ref('giocatori').once('value'),
                    database.ref('messaggi').once('value'),
                    database.ref('partite').once('value'),
                    database.ref('pagelle').once('value')
                ]).then(([giocatoriSnap, messaggiSnap, partiteSnap, pagelleSnap]) => {
                    
                    const giocatoriData = giocatoriSnap.val() || {};
                    const messaggiData = messaggiSnap.val() || {};
                    const partiteData = partiteSnap.val() || {};
                    const pagelleData = pagelleSnap.val() || {};
                    
                    const countGiocatori = Object.keys(giocatoriData).length;
                    const countMessaggi = Object.keys(messaggiData).length;
                    const countPartite = Object.keys(partiteData).length;
                    const countPagelle = Object.keys(pagelleData).length;
                    
                    const backup = {
                        metadata: {
                            versione: "2.0.0",
                            data_creazione: new Date().toISOString(),
                            creato_da: getCurrentUserName(),
                            totale_dati: {
                                giocatori: countGiocatori,
                                messaggi: countMessaggi,
                                partite: countPartite,
                                pagelle: countPagelle
                            }
                        },
                        dati: {
                            giocatori: giocatoriData,
                            messaggi: messaggiData,
                            partite: partiteData,
                            pagelle: pagelleData
                        }
                    };

                    const dataStr = JSON.stringify(backup, null, 2);
                    const dataBlob = new Blob([dataStr], { type: 'application/json' });
                    const url = URL.createObjectURL(dataBlob);
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = `arena-cup-backup-${new Date().toISOString().split('T')[0]}.json`;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    URL.revokeObjectURL(url);

                    alert(`âœ… Backup esportato con successo!\n\nStatistiche:\nðŸ‘¥ ${countGiocatori} giocatori\nðŸ’¬ ${countMessaggi} messaggi\nðŸ—“ï¸ ${countPartite} partite\nðŸ“ ${countPagelle} pagelle`);

                }).catch(error => {
                    console.error("Errore esportazione backup:", error);
                    alert("âŒ Errore durante l'esportazione del backup");
                });
            };

            // ðŸ“¤ IMPORT BACKUP
            const importaBackup = (event) => {
                if (!isAdminUser()) return alert("Solo gli admin possono importare backup!");
                
                const file = event.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const backup = JSON.parse(e.target.result);
                        
                        if (!backup.metadata || !backup.dati) {
                            alert("âŒ File di backup non valido!");
                            return;
                        }

                        if (!confirm(`Sei sicuro di voler importare questo backup?\n\nData: ${backup.metadata.data_creazione}\nGiocatori: ${backup.metadata.totale_dati.giocatori}\nMessaggi: ${backup.metadata.totale_dati.messaggi}\nPartite: ${backup.metadata.totale_dati.partite}\nPagelle: ${backup.metadata.totale_dati.pagelle}\n\nâš ï¸ Questo sovrascriverÃ  i dati attuali!`)) {
                            return;
                        }

                        Promise.all([
                            database.ref('giocatori').set(backup.dati.giocatori),
                            database.ref('messaggi').set(backup.dati.messaggi),
                            database.ref('partite').set(backup.dati.partite),
                            database.ref('pagelle').set(backup.dati.pagelle)
                        ]).then(() => {
                            alert(`âœ… Backup importato con successo!\n\nDati importati:\nðŸ‘¥ ${backup.metadata.totale_dati.giocatori} giocatori\nðŸ’¬ ${backup.metadata.totale_dati.messaggi} messaggi\nðŸ—“ï¸ ${backup.metadata.totale_dati.partite} partite\nðŸ“ ${backup.metadata.totale_dati.pagelle} pagelle`);

                            event.target.value = '';

                        }).catch(error => {
                            console.error("Errore importazione backup:", error);
                            alert("âŒ Errore durante l'importazione del backup");
                        });

                    } catch (error) {
                        console.error("Errore lettura file backup:", error);
                        alert("âŒ Errore durante la lettura del file di backup");
                    }
                };
                reader.readAsText(file);
            };

            // ðŸ—‘ï¸ PULIZIA DATI
            const puliziaDati = () => {
                if (!isAdminUser()) return alert("Solo gli admin possono pulire i dati!");
                
                if (!confirm(`âš ï¸ ATTENZIONE!\n\nSei sicuro di voler cancellare TUTTI i dati?\n\nQuesto cancellerÃ :\nðŸ‘¥ Tutti i giocatori\nðŸ’¬ Tutti i messaggi\nðŸ—“ï¸ Tutte le partite\nðŸ“ Tutte le pagelle\n\nðŸš¨ QUESTA AZIONE Ãˆ IRREVERSIBILE!`)) {
                    return;
                }

                if (!confirm(`ðŸš¨ ULTIMA CONFERMA!\n\nStai per cancellare TUTTI i dati dell'applicazione!\n\nSei ASSOLUTAMENTE sicuro?`)) {
                    return;
                }

                Promise.all([
                    database.ref('giocatori').remove(),
                    database.ref('messaggi').remove(),
                    database.ref('partite').remove(),
                    database.ref('pagelle').remove()
                ]).then(() => {
                    alert("âœ… Tutti i dati sono stati cancellati!");

                }).catch(error => {
                    console.error("Errore pulizia dati:", error);
                    alert("âŒ Errore durante la pulizia dei dati");
                });
            };

            // ðŸ§¤ CALCOLA PUNTEGGIO BENJI PRICE
            const calcolaPunteggioBenjiPrice = (portiere) => {
                let punteggio = 0;
                punteggio += (portiere.parate || 0) * 3;
                punteggio += (portiere.parate_difficili || 0) * 5;
                punteggio += (portiere.rigori_parati || 0) * 10;
                punteggio += (portiere.uscite_vinte || 0) * 4;
                punteggio += (portiere.assist_portiere || 0) * 8;
                punteggio += (portiere.rinvii_buoni || 0) * 2;
                punteggio += (portiere.interventi_decisivi || 0) * 6;
                punteggio -= (portiere.errori || 0) * 3;
                punteggio += (portiere.partite_portiere || 0) * 2;
                return Math.max(0, punteggio);
            };

            // ðŸ“¥ CARICA DATI DA FIREBASE
            useEffect(() => {
                if (!isLogged) return;

                // Giocatori
                database.ref('giocatori').on('value', (snapshot) => {
                    const data = snapshot.val();
                    const giocatoriArray = data ? Object.keys(data).map(key => ({ 
                        ...data[key], 
                        id: key,
                        parate: data[key].parate || 0,
                        gol_subiti: data[key].gol_subiti || 0,
                        rigori_parati: data[key].rigori_parati || 0,
                        uscite_vinte: data[key].uscite_vinte || 0,
                        assist_portiere: data[key].assist_portiere || 0,
                        parate_difficili: data[key].parate_difficili || 0,
                        rinvii_buoni: data[key].rinvii_buoni || 0,
                        errori: data[key].errori || 0,
                        interventi_decisivi: data[key].interventi_decisivi || 0,
                        partite_portiere: data[key].partite_portiere || 0,
                        presenze: data[key].presenze || 0,
                        vittorie: data[key].vittorie || 0,
                        sconfitte: data[key].sconfitte || 0,
                        pareggi: data[key].pareggi || 0,
                        foto_profilo: data[key].foto_profilo || null,
                        last_mvp_timestamp: data[key].last_mvp_timestamp || 0
                    })) : [];
                    setGiocatori(giocatoriArray);
                    
                    const nuovoMVP = getCurrentMVP();
                    setCurrentMVP(nuovoMVP);
                });

                // Messaggi
                database.ref('messaggi').on('value', (snapshot) => {
                    const data = snapshot.val();
                    const messaggiArray = data ? Object.keys(data).map(key => ({ ...data[key], id: key })) : [];
                    setMessaggi(messaggiArray);
                });

                // Partite
                database.ref('partite').on('value', (snapshot) => {
                    const data = snapshot.val();
                    const partiteArray = data ? Object.keys(data).map(key => ({ ...data[key], id: key })) : [];
                    setPartite(partiteArray);
                });

                // Pagelle
                database.ref('pagelle').on('value', (snapshot) => {
                    const data = snapshot.val();
                    const pagelleArray = data ? Object.keys(data).map(key => ({ ...data[key], id: key })) : [];
                    pagelleArray.sort((a, b) => new Date(b.data) - new Date(a.data));
                    setPagelle(pagelleArray);
                    
                    giocatori.forEach(giocatore => {
                        aggiornaMediaGiocatore(giocatore.nome);
                    });
                });
            }, [isLogged]);

            // ðŸ“Š STATISTICHE
            const stats = {
                totaleGol: giocatori.filter(hasGiocatoAlmenoUnaPartita).reduce((sum, g) => sum + (g.gol || 0), 0),
                totaleAssist: giocatori.filter(hasGiocatoAlmenoUnaPartita).reduce((sum, g) => sum + (g.assist || 0), 0),
                totaleGiocatori: giocatori.filter(hasGiocatoAlmenoUnaPartita).length,
                totaleMVP: giocatori.filter(hasGiocatoAlmenoUnaPartita).reduce((sum, g) => sum + (g.mvp_count || 0), 0),
                totalePresenze: giocatori.filter(hasGiocatoAlmenoUnaPartita).reduce((sum, g) => sum + (g.presenze || 0), 0),
                partiteTotali: partite.length,
                partiteGiocate: giocatori.filter(hasGiocatoAlmenoUnaPartita).reduce((sum, g) => {
                    const statsPartite = calcolaStatistichePartite(g);
                    return sum + statsPartite.partiteGiocate;
                }, 0) / 2,
                mediaTotale: (() => {
                    const giocatoriCheHannoGiocato = giocatori.filter(hasGiocatoAlmenoUnaPartita);
                    if (giocatoriCheHannoGiocato.length === 0) return "0.00";
                    
                    const sommaMedie = giocatoriCheHannoGiocato.reduce((sum, g) => {
                        return sum + parseFloat(getMediaSicura(g));
                    }, 0);
                    
                    return (sommaMedie / giocatoriCheHannoGiocato.length).toFixed(2);
                })()
            };

            // ðŸ“Š CLASSIFICHE
            const classificaMarcatori = [...giocatori]
                .filter(g => hasGiocatoAlmenoUnaPartita(g) && (g.gol || 0) > 0)
                .sort((a, b) => (b.gol || 0) - (a.gol || 0))
                .slice(0, 10);

            const classificaAssist = [...giocatori]
                .filter(g => hasGiocatoAlmenoUnaPartita(g) && (g.assist || 0) > 0)
                .sort((a, b) => (b.assist || 0) - (a.assist || 0))
                .slice(0, 10);

            const classificaMVP = [...giocatori]
                .filter(g => hasGiocatoAlmenoUnaPartita(g) && (g.mvp_count || 0) > 0)
                .sort((a, b) => (b.mvp_count || 0) - (a.mvp_count || 0))
                .slice(0, 10);

            const classificaBenjiPrice = [...giocatori]
                .filter(g => hasGiocatoAlmenoUnaPartita(g) && calcolaPunteggioBenjiPrice(g) > 0)
                .map(g => ({
                    ...g,
                    punteggio_benji: calcolaPunteggioBenjiPrice(g)
                }))
                .sort((a, b) => b.punteggio_benji - a.punteggio_benji)
                .slice(0, 10);

            const classificaPresenze = [...giocatori]
                .filter(g => hasGiocatoAlmenoUnaPartita(g))
                .sort((a, b) => (b.presenze || 0) - (a.presenze || 0))
                .slice(0, 10);

            // ðŸ†• CLASSIFICA MEDIA VOTO
            const classificaMediaVoto = React.useMemo(() => {
                return giocatori
                    .map(giocatore => {
                        if (!hasGiocatoAlmenoUnaPartita(giocatore)) return null;
                        
                        const pagelleGiocatore = pagelle.filter(p => p.giocatore === giocatore.nome);
                        if (pagelleGiocatore.length === 0) {
                            return { ...giocatore, mediaReale: 0, partiteGiocate: 0 };
                        }
                        
                        const sommaVoti = pagelleGiocatore.reduce((sum, pagella) => {
                            const voto = parseFloat(pagella.voto);
                            return sum + (isNaN(voto) ? 0 : voto);
                        }, 0);
                        
                        const mediaReale = sommaVoti / pagelleGiocatore.length;
                        
                        return { ...giocatore, mediaReale, partiteGiocate: pagelleGiocatore.length };
                    })
                    .filter(g => g !== null && g.mediaReale > 0)
                    .sort((a, b) => b.mediaReale - a.mediaReale)
                    .slice(0, 10);
            }, [giocatori, pagelle]);

            // ðŸ“ˆ CLASSIFICA WINRATE
            const classificaWinrate = React.useMemo(() => {
                return giocatori
                    .filter(hasGiocatoAlmenoUnaPartita)
                    .map(giocatore => {
                        const stats = calcolaStatistichePartite(giocatore);
                        return {
                            ...giocatore,
                            ...stats,
                            dettagliWinrate: stats.partiteGiocate > 0 ? 
                                `${stats.vittorie}V ${stats.sconfitte}P ${stats.pareggi}N` : 
                                "Nessuna partita"
                        };
                    })
                    .filter(g => g.partiteGiocate > 0 && parseFloat(g.winRate) > 0)
                    .sort((a, b) => {
                        if (parseFloat(b.winRate) !== parseFloat(a.winRate)) {
                            return parseFloat(b.winRate) - parseFloat(a.winRate);
                        }
                        return b.partiteGiocate - a.partiteGiocate;
                    })
                    .slice(0, 10);
            }, [giocatori, partite, pagelle]);

            // ðŸŽ¯ LOGOUT
            const handleLogout = () => {
                localStorage.removeItem("username");
                setIsLogged(false);
                setLoginForm({ username: "", password: "" });
            };

            // ðŸ“ AGGIUNGI PAGELLA
            const aggiungiPagella = () => {
                if (!isAdminUser()) return alert("Solo gli admin possono aggiungere pagelle!");
                if (!nuovaPagella.giocatore.trim()) return alert("Seleziona un giocatore!");
                if (!nuovaPagella.voto) return alert("Inserisci un voto!");
                
                const votoNumero = parseFloat(nuovaPagella.voto);
                if (isNaN(votoNumero) || votoNumero < 1 || votoNumero > 10) {
                    return alert("Il voto deve essere un numero tra 1 e 10!");
                }
                
                database.ref('pagelle').push({
                    giocatore: nuovaPagella.giocatore,
                    voto: votoNumero,
                    commento: nuovaPagella.commento,
                    data: nuovaPagella.data,
                    fazione: nuovaPagella.fazione,
                    autore: getCurrentUserName(),
                    timestamp: Date.now(),
                    created_at: new Date().toLocaleString('it-IT')
                }).then(() => {
                    setNuovaPagella({
                        giocatore: "",
                        voto: "",
                        commento: "",
                        data: new Date().toISOString().split('T')[0],
                        fazione: "nessuna"
                    });
                    alert("ðŸ“ Pagella aggiunta!");
                    
                    setTimeout(() => {
                        aggiornaMediaGiocatore(nuovaPagella.giocatore);
                    }, 1000);
                });
            };

            // âœï¸ MODIFICA PAGELLA
            const avviaModificaPagella = (pagella) => {
                if (!isAdminUser()) return alert("Solo gli admin possono modificare pagelle!");
                setPagellaInModifica(pagella.id);
                setModificaPagella({
                    voto: pagella.voto.toString(),
                    commento: pagella.commento || "",
                    fazione: pagella.fazione || "nessuna"
                });
            };

            const salvaModificaPagella = () => {
                if (!pagellaInModifica) return;
                
                const votoNumero = parseFloat(modificaPagella.voto);
                if (isNaN(votoNumero) || votoNumero < 1 || votoNumero > 10) {
                    return alert("Il voto deve essere un numero tra 1 e 10!");
                }
                
                database.ref(`pagelle/${pagellaInModifica}`).update({
                    voto: votoNumero,
                    commento: modificaPagella.commento,
                    fazione: modificaPagella.fazione,
                    modificato_il: new Date().toLocaleString('it-IT')
                }).then(() => {
                    setPagellaInModifica(null);
                    setModificaPagella({ voto: "", commento: "", fazione: "nessuna" });
                    alert("âœ… Pagella modificata!");
                    
                    const pagellaModificata = pagelle.find(p => p.id === pagellaInModifica);
                    if (pagellaModificata) {
                        aggiornaMediaGiocatore(pagellaModificata.giocatore);
                    }
                }).catch(error => {
                    console.error("Errore modifica pagella:", error);
                    alert("âŒ Errore nella modifica della pagella");
                });
            };

            const annullaModificaPagella = () => {
                setPagellaInModifica(null);
                setModificaPagella({ voto: "", commento: "", fazione: "nessuna" });
            };

            const eliminaPagella = (id, giocatore) => {
                if (!isAdminUser()) return alert("Solo gli admin possono eliminare pagelle!");
                if (!confirm(`Eliminare la pagella di ${giocatore}?`)) return;
                database.ref(`pagelle/${id}`).remove().then(() => {
                    aggiornaMediaGiocatore(giocatore);
                });
            };

            // ðŸŽ¯ FUNZIONI UTILITY
            const getClasseFazione = (fazione) => {
                switch(fazione) {
                    case 'bianca': return 'fazione-bianca';
                    case 'nera': return 'fazione-nera';
                    case 'rossa': return 'fazione-rossa';
                    default: return '';
                }
            };

            const getBadgeFazione = (fazione) => {
                switch(fazione) {
                    case 'bianca': return <span className="badge-fazione badge-bianca">ARMATA BIANCA</span>;
                    case 'nera': return <span className="badge-fazione badge-nera">ARMATA NERA</span>;
                    case 'rossa': return <span className="badge-fazione badge-rossa">ARMATA ROSSA</span>;
                    default: return null;
                }
            };

            // ðŸ† BADGE COPPA VINCITORE
            const getBadgeCoppa = (pagella) => {
                if (!pagella.fazione || !pagella.data || pagella.fazione === "nessuna") return null;
                
                const partiteStessoGiorno = partite.filter(p => p.data === pagella.data);
                
                for (const partita of partiteStessoGiorno) {
                    if (partita.risultato === 'Vittoria' && partita.fazione_vincente === pagella.fazione) {
                        return <span className="badge-coppa">ðŸ† VINCITORE</span>;
                    }
                }
                
                return null;
            };

            const renderMVPGlow = (giocatore, isListItem = false) => {
                const mvp = getCurrentMVP();
                const isMVP = mvp && mvp.id === giocatore.id;
                
                if (isMVP) {
                    return isListItem ? 'mvp-glow-item' : 'mvp-glow';
                }
                return '';
            };

            // âš½ AGGIUNGI/RIMUOVI GOL/ASSIST
            const addGolAssist = (id, tipo, quantitaInput) => {
                if (!isAdminUser()) return alert("Solo gli admin possono aggiornare Gol/Assist!");
                
                const giocatore = giocatori.find(g => g.id === id);
                if (!giocatore) return;
                
                const quantita = parseInt(quantitaInput);
                if (isNaN(quantita)) return alert("Inserisci un numero valido!");
                
                const valoreAttuale = giocatore[tipo] || 0;
                const nuovoValore = valoreAttuale + quantita;
                
                if (nuovoValore < 0) {
                    if (!confirm(`âš ï¸ ATTENZIONE!\n\nStai per impostare ${tipo} a ${nuovoValore} (negativo!).\n\nSei sicuro?`)) {
                        return;
                    }
                }
                
                database.ref(`giocatori/${id}`).update({
                    [tipo]: nuovoValore
                }).then(() => {
                    const azione = quantita >= 0 ? "aggiunti" : "rimossi";
                    const emoji = tipo === 'gol' ? 'âš½' : 'ðŸŽ¯';
                    const nome = tipo === 'gol' ? 'gol' : 'assist';
                    alert(`${emoji} ${Math.abs(quantita)} ${nome} ${azione}! Nuovo totale: ${nuovoValore}`);
                    document.getElementById(`${tipo}-${id}`).value = "";
                });
            };

            // ðŸ† AGGIUNGI MVP
            const addMVP = (id) => {
                if (!isAdminUser()) return alert("Solo gli admin possono assegnare MVP!");
                
                const giocatore = giocatori.find(g => g.id === id);
                if (!giocatore) return;
                
                if (!hasGiocatoAlmenoUnaPartita(giocatore)) {
                    alert("âŒ Questo giocatore non ha ancora giocato nessuna partita!");
                    return;
                }
                
                const timestampAttuale = Date.now();
                const nuovoCount = (giocatore.mvp_count || 0) + 1;
                
                database.ref(`giocatori/${id}`).update({
                    mvp_count: nuovoCount,
                    last_mvp_timestamp: timestampAttuale
                }).then(() => {
                    alert("ðŸ† MVP assegnato!");
                });
            };

            // âž– RIMUOVI MVP
            const rimuoviMVP = (id) => {
                if (!isAdminUser()) return alert("Solo gli admin possono rimuovere MVP!");
                
                const giocatore = giocatori.find(g => g.id === id);
                if (!giocatore) return;
                
                const nuovoCount = Math.max(0, (giocatore.mvp_count || 0) - 1);
                
                if (nuovoCount === giocatore.mvp_count) {
                    alert("âŒ Il giocatore non ha MVP da rimuovere!");
                    return;
                }
                
                database.ref(`giocatori/${id}`).update({
                    mvp_count: nuovoCount
                }).then(() => {
                    alert("âž–ðŸ† MVP rimosso correttamente!");
                    
                }).catch(error => {
                    console.error("Errore rimozione MVP:", error);
                    alert("âŒ Errore nella rimozione dell'MVP");
                });
            };

            // ðŸ“Š AGGIUNGI STAT PARTITE
            const aggiungiStatPartita = (id, tipo, quantitaInput) => {
                if (!isAdminUser()) return alert("Solo gli admin possono aggiornare le statistiche partite!");
                
                const giocatore = giocatori.find(g => g.id === id);
                if (!giocatore) return;
                
                const quantita = parseInt(quantitaInput);
                if (isNaN(quantita)) return alert("Inserisci un numero valido!");
                
                const valoreAttuale = giocatore[tipo] || 0;
                const nuovoValore = valoreAttuale + quantita;
                
                if (nuovoValore < 0) {
                    if (!confirm(`âš ï¸ ATTENZIONE!\n\nStai per impostare ${tipo} a ${nuovoValore} (negativo!).\n\nSei sicuro?`)) {
                        return;
                    }
                }
                
                database.ref(`giocatori/${id}`).update({
                    [tipo]: nuovoValore
                }).then(() => {
                    const azione = quantita >= 0 ? "aggiunte" : "rimosse";
                    const emoji = 
                        tipo === 'vittorie' ? 'âœ…' :
                        tipo === 'sconfitte' ? 'âŒ' :
                        tipo === 'pareggi' ? 'âš¡' : 'ðŸ“Š';
                    
                    const nomeStat = 
                        tipo === 'vittorie' ? 'vittorie' :
                        tipo === 'sconfitte' ? 'sconfitte' :
                        tipo === 'pareggi' ? 'pareggi' : 'statistiche';
                    
                    alert(`${emoji} ${Math.abs(quantita)} ${nomeStat} ${azione}! Nuovo totale: ${nuovoValore}`);
                    document.getElementById(`${tipo}-${id}`).value = "";
                });
            };

            // ðŸ“Š AGGIUNGI PRESENZA
            const aggiungiPresenza = (id, quantitaInput) => {
                if (!isAdminUser()) return alert("Solo gli admin possono aggiornare le presenze!");
                
                const giocatore = giocatori.find(g => g.id === id);
                if (!giocatore) return;
                
                const quantita = parseInt(quantitaInput);
                if (isNaN(quantita)) return alert("Inserisci un numero valido!");
                
                const nuovoValore = Math.max(0, (giocatore.presenze || 0) + quantita);
                
                database.ref(`giocatori/${id}`).update({
                    presenze: nuovoValore
                }).then(() => {
                    const azione = quantita >= 0 ? "aggiunte" : "rimosse";
                    alert(`ðŸ“Š ${Math.abs(quantita)} presenze ${azione}!`);
                    document.getElementById(`presenze-${id}`).value = "";
                    
                    if (quantita > 0 && giocatore.presenze === 0) {
                        aggiornaMediaGiocatore(giocatore.nome);
                    }
                });
            };

            // ðŸ’¬ INVIA MESSAGGIO
            const inviaMessaggio = () => {
                if (!nuovoMessaggio.trim()) return;
                
                const mittenteVisualizzato = getCurrentUserName();
                
                database.ref('messaggi').push({
                    mittente: loginForm.username,
                    mittente_visualizzato: mittenteVisualizzato,
                    messaggio: nuovoMessaggio,
                    timestamp: Date.now(),
                    created_at: new Date().toLocaleString('it-IT')
                }).then(() => {
                    setNuovoMessaggio("");
                });
            };

            const eliminaMessaggio = (id) => {
                if (!confirm("Eliminare questo messaggio?")) return;
                database.ref(`messaggi/${id}`).remove();
            };

            // ðŸ—“ï¸ TOGGLE PRENOTAZIONE
            const togglePrenotazionePartita = (partitaId) => {
                const partita = partite.find(p => p.id === partitaId);
                if (!partita) return;
                
                const nomeVisualizzato = getCurrentUserName();
                let confermati = partita.confermati || [];
                
                const limite = partita.triangolare ? 15 : 10;
                const giaConfermato = confermati.includes(nomeVisualizzato);
                
                if (!giaConfermato && confermati.length >= limite) {
                    alert(`Partita al completo! ${limite} giocatori confermati.`);
                    return;
                }

                let nuoviConfermati;
                if (giaConfermato) {
                    nuoviConfermati = confermati.filter(name => name !== nomeVisualizzato);
                } else {
                    nuoviConfermati = [...confermati, nomeVisualizzato];
                }

                database.ref(`partite/${partitaId}`).update({
                    confermati: nuoviConfermati
                }).then(() => {
                    if (!giaConfermato) {
                        alert("âœ… Prenotazione confermata!");
                    } else {
                        alert("âŒ Prenotazione annullata!");
                    }
                }).catch(error => {
                    console.error("âŒ Errore aggiornamento partita:", error);
                    alert("âŒ Errore durante la prenotazione. Riprova.");
                });
            };

            // ðŸŽ¯ IMPOSTA RISULTATO PARTITA
            const impostaRisultatoPartita = (partitaId, risultato) => {
                if (!isAdminUser()) return alert("Solo gli admin possono impostare i risultati!");
                
                if (risultato === "Vittoria" || risultato === "Sconfitta") {
                    const fazioneVincente = prompt("Quale armata ha vinto? (bianca/nera/rossa)");
                    if (!fazioneVincente || !['bianca', 'nera', 'rossa'].includes(fazioneVincente.toLowerCase())) {
                        alert("Devi inserire un'armata valida: bianca, nera o rossa");
                        return;
                    }
                    
                    let fazionePerdente;
                    if (risultato === "Vittoria") {
                        fazionePerdente = prompt("Quale armata ha perso? (bianca/nera/rossa)");
                        if (!fazionePerdente || !['bianca', 'nera', 'rossa'].includes(fazionePerdente.toLowerCase())) {
                            alert("Devi inserire un'armata valida: bianca, nera o rossa");
                            return;
                        }
                    }
                    
                    database.ref(`partite/${partitaId}`).update({
                        risultato: risultato,
                        fazione_vincente: fazioneVincente.toLowerCase(),
                        fazione_perdente: fazionePerdente ? fazionePerdente.toLowerCase() : null
                    }).then(() => {
                        alert(`âœ… Risultato impostato: ${risultato}\nArmata vincente: ${fazioneVincente}${fazionePerdente ? `\nArmata perdente: ${fazionePerdente}` : ''}`);
                    });
                } else {
                    database.ref(`partite/${partitaId}`).update({
                        risultato: risultato,
                        fazione_vincente: null,
                        fazione_perdente: null
                    }).then(() => {
                        alert(`âœ… Risultato impostato: ${risultato}`);
                    });
                }
            };

            // ðŸ”º IMPOSTA TRIANGOLARE
            const impostaTriangolare = (partitaId, triangolare) => {
                if (!isAdminUser()) return alert("Solo gli admin possono modificare il formato partita!");
                
                database.ref(`partite/${partitaId}`).update({
                    triangolare: triangolare
                }).then(() => {
                    alert(triangolare ? "âœ… Partita impostata come triangolare!" : "âœ… Partita impostata come normale!");
                });
            };

            // ðŸŽ¯ RENDER RISULTATO PARTITA
            const renderRisultatoPartita = (partita) => {
                if (!partita.risultato) return null;

                let risultatoClass = '';
                let risultatoText = '';
                let fazioneVincente = null;
                let fazionePerdente = null;

                switch(partita.risultato) {
                    case 'Vittoria':
                        risultatoClass = 'risultato-vittoria';
                        risultatoText = 'âœ… VITTORIA';
                        fazioneVincente = partita.fazione_vincente;
                        fazionePerdente = partita.fazione_perdente;
                        break;
                    case 'Sconfitta':
                        risultatoClass = 'risultato-sconfitta';
                        risultatoText = 'âŒ SCONFITTA';
                        fazioneVincente = partita.fazione_vincente;
                        break;
                    case 'Pareggio':
                        risultatoClass = 'risultato-pareggio';
                        risultatoText = 'âš¡ PAREGGIO';
                        break;
                    default:
                        return null;
                }

                return (
                    <div className={`risultato-partita ${risultatoClass}`}>
                        <div style={{ fontSize: '1.2rem', marginBottom: '8px' }}>
                            {risultatoText}
                        </div>
                        {fazioneVincente && (
                            <div style={{ marginBottom: '5px' }}>
                                <strong>Armata Vincente: </strong>
                                <span className={`fazione-vincente ${
                                    fazioneVincente === 'bianca' ? 'fazione-bianca-vittoria' :
                                    fazioneVincente === 'nera' ? 'fazione-nera-vittoria' :
                                    'fazione-rossa-vittoria'
                                }`}>
                                    {fazioneVincente === 'bianca' ? 'âšª BIANCA' :
                                     fazioneVincente === 'nera' ? 'âš« NERA' : 'ðŸ”´ ROSSA'}
                                </span>
                            </div>
                        )}
                        {fazionePerdente && (
                            <div>
                                <strong>Armata Perdente: </strong>
                                <span style={{ 
                                    padding: '5px 10px', 
                                    borderRadius: '15px', 
                                    background: 'rgba(0,0,0,0.3)',
                                    color: '#ccc'
                                }}>
                                    {fazionePerdente === 'bianca' ? 'âšª BIANCA' :
                                     fazionePerdente === 'nera' ? 'âš« NERA' : 'ðŸ”´ ROSSA'}
                                </span>
                            </div>
                        )}
                    </div>
                );
            };

            const formattaData = (dataString) => {
                const data = new Date(dataString);
                return data.toLocaleDateString('it-IT', { 
                    weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' 
                });
            };

            const getStatoPartita = (partita) => {
                if (!partita) {
                    return { testo: "ðŸ”´ NON DISPONIBILE", colore: "#F44336" };
                }
                
                const confermati = partita.confermati || [];
                const limite = partita.triangolare ? 15 : 10;
                const numConfermati = confermati.length;
                
                if (numConfermati >= limite) return { testo: "ðŸŸ¢ COMPLETO", colore: "#4CAF50" };
                if (numConfermati >= 8) return { testo: "ðŸŸ¡ QUASI COMPLETO", colore: "#FFD700" };
                if (numConfermati >= 5) return { testo: "ðŸŸ  IN CORSO", colore: "#FF9800" };
                return { testo: "ðŸ”´ POCHI", colore: "#F44336" };
            };

            const getCurrentUserName = () => {
                if (loginForm.username === "admin" || loginForm.username === "vitantonio") {
                    return "Vitantonio";
                }
                if (loginForm.username === "fabrizio") {
                    return "Fabrizio";
                }
                return loginForm.username;
            };

            const getCurrentGiocatore = () => {
                return giocatori.find(g => g.nome === loginForm.username) || {};
            };

            const getMiePagelle = () => {
                return pagelle.filter(p => p.giocatore === loginForm.username);
            };

            // ==================== RENDER LOGIN ====================
            if (!isLogged) {
                return (
                    <div className="app-container">
                        <div className="login-container">
                            <form onSubmit={handleLogin} className="login-form">
                                <h1 style={{ fontSize: "2.5rem", marginBottom: "20px", color: "#333" }}>
                                    ðŸ† Arena Cup
                                </h1>
                                
                                <div style={{ marginBottom: "20px" }}>
                                    <p style={{ color: "#CE2B37", fontSize: "0.9rem" }}>
                                        Creato da <strong>Vitlollo</strong>, sviluppato da <strong>DeepSeek</strong>
                                    </p>
                                </div>
                                
                                <input 
                                    type="text"
                                    placeholder="Nome giocatore" 
                                    value={loginForm.username}
                                    onChange={(e) => setLoginForm(prev => ({...prev, username: e.target.value}))}
                                    className="login-input"
                                    autoComplete="username"
                                    autoFocus
                                />
                                
                                {(loginForm.username.toLowerCase() === "admin" || 
                                  loginForm.username.toLowerCase() === "vitantonio" ||
                                  loginForm.username.toLowerCase() === "fabrizio") && (
                                    <>
                                        <input 
                                            type="password"
                                            placeholder="Password" 
                                            value={loginForm.password}
                                            onChange={(e) => setLoginForm(prev => ({...prev, password: e.target.value}))}
                                            className="login-input"
                                            autoComplete="current-password"
                                        />
                                        <p className="password-hint">
                                            Inserisci la password corretta
                                        </p>
                                    </>
                                )}
                                
                                <button 
                                    type="submit"
                                    className="login-button"
                                >
                                    {loginForm.username.toLowerCase() === "admin" || 
                                     loginForm.username.toLowerCase() === "vitantonio" ||
                                     loginForm.username.toLowerCase() === "fabrizio" 
                                        ? "ðŸ” Accedi come Admin" 
                                        : "ðŸš€ Accedi"}
                                </button>
                                
                                <div className="credits">
                                    <p>ðŸ‡®ðŸ‡¹ App ufficiale del torneo Arena Cup</p>
                                </div>
                            </form>
                        </div>
                    </div>
                );
            }

            // ==================== RENDER PRINCIPALE ====================
            return (
                <div className="app-container">
                    <div className="app-header">
                        <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center", flexWrap: "wrap" }}>
                            <div style={{ display: "flex", alignItems: "center" }}>
                                <BandieraHeader />
                                <div>
                                    <h1 style={{ margin: 0, fontSize: "1.5rem", display: "flex", alignItems: "center" }}>
                                        ðŸ† Arena Cup
                                    </h1>
                                    <p style={{ margin: "5px 0 0 0", color: "#ccc", fontSize: "0.8rem" }}>
                                        {activeTab === "classifica" ? "Classifica" : 
                                         activeTab === "calendario" ? "Calendario" : 
                                         activeTab === "presenze" ? "Partite Giocate" : 
                                         activeTab === "mioscore" ? "Il Mio Score" :
                                         activeTab === "chat" ? "Chat" : 
                                         activeTab === "pagelle" ? "Pagelle" : 
                                         activeTab === "backup" ? "Backup" : "Impostazioni"} | 
                                        {stats.totaleGiocatori} giocatori attivi | Media voto: {stats.mediaTotale || "0.00"}
                                    </p>
                                </div>
                            </div>
                            <div style={{ display: "flex", alignItems: "center", gap: "10px", flexWrap: "wrap" }}>
                                <span style={{ color: "#4CAF50" }}>ðŸ‘¤ {getCurrentUserName()}</span>
                                <button 
                                    onClick={handleLogout}
                                    style={{ 
                                        background: "#F44336", 
                                        color: "#fff", 
                                        border: "none", 
                                        padding: "8px 15px", 
                                        borderRadius: "8px", 
                                        cursor: "pointer",
                                        fontSize: "0.8rem",
                                        transition: "transform 0.3s ease"
                                    }}
                                    onMouseOver={(e) => e.currentTarget.style.transform = "translateY(-2px)"}
                                    onMouseOut={(e) => e.currentTarget.style.transform = "translateY(0)"}
                                >
                                    Esci
                                </button>
                            </div>
                        </div>

                        {/* DESKTOP NAV */}
                        <div className="desktop-nav">
                            <button className={`desktop-nav-button ${activeTab === "classifica" ? "active" : ""}`} onClick={() => setActiveTab("classifica")}>ðŸ† Classifica</button>
                            <button className={`desktop-nav-button ${activeTab === "calendario" ? "active" : ""}`} onClick={() => setActiveTab("calendario")}>ðŸ—“ï¸ Calendario</button>
                            <button className={`desktop-nav-button ${activeTab === "presenze" ? "active" : ""}`} onClick={() => setActiveTab("presenze")}>ðŸ“Š Partite Giocate</button>
                            <button className={`desktop-nav-button ${activeTab === "mioscore" ? "active" : ""}`} onClick={() => setActiveTab("mioscore")}>â­ Il Mio Score</button>
                            <button className={`desktop-nav-button ${activeTab === "chat" ? "active" : ""}`} onClick={() => setActiveTab("chat")}>ðŸ’¬ Chat</button>
                            <button className={`desktop-nav-button ${activeTab === "pagelle" ? "active" : ""}`} onClick={() => setActiveTab("pagelle")}>ðŸ“ Pagelle</button>
                            {isAdminUser() && (
                                <button className={`desktop-nav-button ${activeTab === "backup" ? "active" : ""}`} onClick={() => setActiveTab("backup")}>ðŸ’¾ Backup</button>
                            )}
                        </div>
                    </div>

                    <div className="app-content">
                        {/* TAB CLASSIFICA */}
                        {activeTab === "classifica" && (
                            <div>
                                <h2>ðŸ† Classifiche</h2>
                                
                                {currentMVP && (
                                    <div className={`player-card mvp-glow`} style={{ position: 'relative' }}>
                                        <div className="mvp-crown">ðŸ‘‘</div>
                                        <div style={{ textAlign: 'center', padding: '10px' }}>
                                            <h3 style={{ color: '#FFD700', marginBottom: '10px', fontSize: '1.3rem' }}>
                                                ðŸ† MVP ATTUALE
                                            </h3>
                                            <div style={{ fontSize: '1.5rem', fontWeight: 'bold', color: '#FFC107' }}>
                                                {currentMVP.nome}
                                            </div>
                                            <div style={{ fontSize: '1rem', color: '#ccc', marginTop: '5px' }}>
                                                {currentMVP.mvp_count} MVP totali
                                            </div>
                                            <div className="mvp-stats" style={{ justifyContent: 'center', marginTop: '10px' }}>
                                                <div className="mvp-stat">âš½ {currentMVP.gol || 0} gol</div>
                                                <div className="mvp-stat">ðŸŽ¯ {currentMVP.assist || 0} assist</div>
                                                <div className="mvp-stat">â­ {getMediaSicura(currentMVP)}</div>
                                            </div>
                                        </div>
                                    </div>
                                )}
                                
                                <div className="stats-grid">
                                    <div className="stat-card">
                                        <h3 style={{ color: "#FFD700", margin: "0 0 10px 0", fontSize: "1rem" }}>âš½ Gol Totali</h3>
                                        <p style={{ margin: 0, fontSize: "1.8rem", fontWeight: "bold" }}>{stats.totaleGol}</p>
                                    </div>
                                    <div className="stat-card">
                                        <h3 style={{ color: "#4CAF50", margin: "0 0 10px 0", fontSize: "1rem" }}>ðŸŽ¯ Assist Totali</h3>
                                        <p style={{ margin: 0, fontSize: "1.8rem", fontWeight: "bold" }}>{stats.totaleAssist}</p>
                                    </div>
                                    <div className="stat-card">
                                        <h3 style={{ color: "#FFC107", margin: "0 0 10px 0", fontSize: "1rem" }}>ðŸ† MVP Totali</h3>
                                        <p style={{ margin: 0, fontSize: "1.8rem", fontWeight: "bold" }}>{stats.totaleMVP}</p>
                                    </div>
                                    <div className="stat-card">
                                        <h3 style={{ color: "#2196F3", margin: "0 0 10px 0", fontSize: "1rem" }}>â­ Media Voto</h3>
                                        <p style={{ margin: 0, fontSize: "1.8rem", fontWeight: "bold" }}>{stats.mediaTotale || "0.00"}</p>
                                    </div>
                                </div>

                                {/* CLASSIFICHE */}
                                <div className="classifica-grid">
                                    {/* CLASSIFICA MEDIA VOTO */}
                                    <div className="classifica-card">
                                        <h3 style={{ marginBottom: "15px", color: "#2196F3" }}>â­ Top Media Voto</h3>
                                        {classificaMediaVoto.map((giocatore, index) => (
                                            <div key={giocatore.id} className={`classifica-item-con-foto`}>
                                                <div className="classifica-foto">
                                                    <FotoProfiloManager 
                                                        giocatore={giocatore} 
                                                        size="small"
                                                        onFotoCambiata={() => window.location.reload()}
                                                    />
                                                </div>
                                                <div className="classifica-info">
                                                    <div className={`classifica-pos ${index === 0 ? 'oro' : index === 1 ? 'argento' : index === 2 ? 'bronzo' : ''}`}>
                                                        {index + 1}
                                                    </div>
                                                    <div className="classifica-nome">
                                                        {giocatore.nome}
                                                        <span className="badge-media-voto">
                                                            {giocatore.mediaReale.toFixed(2)}/10
                                                        </span>
                                                    </div>
                                                    <div className="classifica-valore" style={{ color: '#2196F3', fontWeight: 'bold' }}>
                                                        {giocatore.mediaReale.toFixed(2)}
                                                    </div>
                                                </div>
                                            </div>
                                        ))}
                                    </div>

                                    {/* CLASSIFICA WINRATE */}
                                    <div className="classifica-card classifica-winrate">
                                        <h3 style={{ marginBottom: "15px", color: "#4CAF50" }}>ðŸ“ˆ Top WinRate</h3>
                                        {classificaWinrate.length > 0 ? (
                                            classificaWinrate.map((giocatore, index) => {
                                                const statsPartite = calcolaStatistichePartite(giocatore);
                                                return (
                                                    <div key={giocatore.id} className={`classifica-item-con-foto`}>
                                                        <div className="classifica-foto">
                                                            <FotoProfiloManager 
                                                                giocatore={giocatore} 
                                                                size="small"
                                                                onFotoCambiata={() => window.location.reload()}
                                                            />
                                                        </div>
                                                        <div className="classifica-info">
                                                            <div className={`classifica-pos ${index === 0 ? 'oro' : index === 1 ? 'argento' : index === 2 ? 'bronzo' : ''}`}>
                                                                {index + 1}
                                                            </div>
                                                            <div className="classifica-nome">
                                                                {giocatore.nome}
                                                                <span className="badge-partite-giocate">
                                                                    {statsPartite.partiteGiocate} partite
                                                                </span>
                                                            </div>
                                                            <div className="classifica-valore" style={{ color: '#FFD700', fontWeight: 'bold' }}>
                                                                {statsPartite.winRate}%
                                                            </div>
                                                        </div>
                                                    </div>
                                                );
                                            })
                                        ) : (
                                            <div style={{ textAlign: 'center', padding: '20px', color: '#888' }}>
                                                Nessun giocatore con partite giocate sufficienti
                                            </div>
                                        )}
                                    </div>

                                    {/* ALTRE CLASSIFICHE */}
                                    <div className="classifica-card">
                                        <h3 style={{ marginBottom: "15px", color: "#FFD700" }}>âš½ Top Marcatori</h3>
                                        {classificaMarcatori.map((giocatore, index) => (
                                            <div key={giocatore.id} className={`classifica-item-con-foto`}>
                                                <div className="classifica-foto">
                                                    <FotoProfiloManager 
                                                        giocatore={giocatore} 
                                                        size="small"
                                                        onFotoCambiata={() => window.location.reload()}
                                                    />
                                                </div>
                                                <div className="classifica-info">
                                                    <div className={`classifica-pos ${index === 0 ? 'oro' : index === 1 ? 'argento' : index === 2 ? 'bronzo' : ''}`}>
                                                        {index + 1}
                                                    </div>
                                                    <div className="classifica-nome">{giocatore.nome}</div>
                                                    <div className="classifica-valore">{giocatore.gol || 0} gol</div>
                                                </div>
                                            </div>
                                        ))}
                                    </div>

                                    <div className="classifica-card">
                                        <h3 style={{ marginBottom: "15px", color: "#4CAF50" }}>ðŸŽ¯ Top Assist</h3>
                                        {classificaAssist.map((giocatore, index) => (
                                            <div key={giocatore.id} className={`classifica-item-con-foto`}>
                                                <div className="classifica-foto">
                                                    <FotoProfiloManager 
                                                        giocatore={giocatore} 
                                                        size="small"
                                                        onFotoCambiata={() => window.location.reload()}
                                                    />
                                                </div>
                                                <div className="classifica-info">
                                                    <div className={`classifica-pos ${index === 0 ? 'oro' : index === 1 ? 'argento' : index === 2 ? 'bronzo' : ''}`}>
                                                        {index + 1}
                                                    </div>
                                                    <div className="classifica-nome">{giocatore.nome}</div>
                                                    <div className="classifica-valore">{giocatore.assist || 0} assist</div>
                                                </div>
                                            </div>
                                        ))}
                                    </div>

                                    <div className="classifica-card">
                                        <h3 style={{ marginBottom: "15px", color: "#FFC107" }}>ðŸ† MVP Stagione</h3>
                                        {classificaMVP.map((giocatore, index) => (
                                            <div key={giocatore.id} className={`classifica-item-con-foto`}>
                                                <div className="classifica-foto">
                                                    <FotoProfiloManager 
                                                        giocatore={giocatore} 
                                                        size="small"
                                                        onFotoCambiata={() => window.location.reload()}
                                                    />
                                                </div>
                                                <div className="classifica-info">
                                                    <div className={`classifica-pos ${index === 0 ? 'oro' : index === 1 ? 'argento' : index === 2 ? 'bronzo' : ''}`}>
                                                        {index + 1}
                                                    </div>
                                                    <div className="classifica-nome">{giocatore.nome}</div>
                                                    <div className="classifica-valore">{giocatore.mvp_count || 0} MVP</div>
                                                </div>
                                            </div>
                                        ))}
                                    </div>

                                    <div className="classifica-card">
                                        <h3 style={{ marginBottom: "15px", color: "#9C27B0" }}>ðŸ§¤ Benji Price</h3>
                                        {classificaBenjiPrice.map((giocatore, index) => (
                                            <div key={giocatore.id} className={`classifica-item-con-foto`}>
                                                <div className="classifica-foto">
                                                    <FotoProfiloManager 
                                                        giocatore={giocatore} 
                                                        size="small"
                                                        onFotoCambiata={() => window.location.reload()}
                                                    />
                                                </div>
                                                <div className="classifica-info">
                                                    <div className={`classifica-pos ${index === 0 ? 'oro' : index === 1 ? 'argento' : index === 2 ? 'bronzo' : ''}`}>
                                                        {index + 1}
                                                    </div>
                                                    <div className="classifica-nome">{giocatore.nome}</div>
                                                    <div className="classifica-valore" style={{ color: '#9C27B0' }}>
                                                        {giocatore.punteggio_benji} pts
                                                    </div>
                                                </div>
                                            </div>
                                        ))}
                                    </div>

                                    <div className="classifica-card">
                                        <h3 style={{ marginBottom: "15px", color: "#00BCD4" }}>ðŸ“Š Top Presenze</h3>
                                        {classificaPresenze.map((giocatore, index) => (
                                            <div key={giocatore.id} className={`classifica-item-con-foto`}>
                                                <div className="classifica-foto">
                                                    <FotoProfiloManager 
                                                        giocatore={giocatore} 
                                                        size="small"
                                                        onFotoCambiata={() => window.location.reload()}
                                                    />
                                                </div>
                                                <div className="classifica-info">
                                                    <div className={`classifica-pos ${index === 0 ? 'oro' : index === 1 ? 'argento' : index === 2 ? 'bronzo' : ''}`}>
                                                        {index + 1}
                                                    </div>
                                                    <div className="classifica-nome">{giocatore.nome}</div>
                                                    <div className="classifica-valore" style={{ color: '#00BCD4' }}>
                                                        {giocatore.presenze || 0}
                                                    </div>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>

                                {/* GESTIONE GIOCATORI ADMIN */}
                                {isAdminUser() && (
                                    <div className="gestione-giocatori">
                                        <h3 style={{ marginBottom: "15px", color: "#FFC107" }}>ðŸ‘¥ Gestione Giocatori</h3>
                                        
                                        <div className="aggiungi-giocatore-form">
                                            <input 
                                                type="text"
                                                placeholder="Nome del nuovo giocatore"
                                                value={nuovoGiocatore}
                                                onChange={(e) => setNuovoGiocatore(e.target.value)}
                                                className="aggiungi-giocatore-input"
                                                onKeyPress={(e) => e.key === 'Enter' && aggiungiGiocatore()}
                                            />
                                            <button 
                                                onClick={aggiungiGiocatore}
                                                style={{ background: "#4CAF50", color: "white", padding: "15px 20px", border: "none", borderRadius: "8px", cursor: "pointer" }}
                                            >
                                                âž• Aggiungi Giocatore
                                            </button>
                                        </div>

                                        <div className="lista-giocatori-admin">
                                            {giocatori.map(giocatore => (
                                                <div key={giocatore.id} className="giocatore-admin-item">
                                                    <div className="giocatore-admin-nome">{giocatore.nome}</div>
                                                    <div className="giocatore-admin-stats">
                                                        <span>âš½ {giocatore.gol || 0}</span>
                                                        <span>ðŸŽ¯ {giocatore.assist || 0}</span>
                                                        <span>â­ {getMediaSicura(giocatore)}</span>
                                                    </div>
                                                    <div className="giocatore-admin-actions">
                                                        <button 
                                                            onClick={() => eliminaGiocatore(giocatore.id, giocatore.nome)}
                                                            className="btn-elimina"
                                                        >
                                                            ðŸ—‘ï¸ Elimina
                                                        </button>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}

                                {/* LISTA GIOCATORI COMPLETA CON WINRATE */}
                                <div style={{ marginTop: "40px" }}>
                                    <h3>ðŸ‘¥ Lista Completa Giocatori</h3>
                                    {giocatori.map(giocatore => {
                                        const statsPartite = calcolaStatistichePartite(giocatore);
                                        return (
                                            <div key={giocatore.id} className="player-card">
                                                <div style={{ display: "flex", justifyContent: "space-between", alignItems: "flex-start", flexWrap: "wrap" }}>
                                                    <div style={{ flex: 1, display: 'flex', alignItems: 'flex-start', gap: '15px' }}>
                                                        <FotoProfiloManager 
                                                            giocatore={giocatore}
                                                            size="medium"
                                                            onFotoCambiata={() => window.location.reload()}
                                                        />
                                                        
                                                        <div style={{ flex: 1 }}>
                                                            <h4 style={{ margin: "0 0 10px 0", fontSize: "1.2rem" }}>
                                                                {giocatore.nome}
                                                                {!hasGiocatoAlmenoUnaPartita(giocatore) && (
                                                                    <span className="badge-non-giocante">NON HA GIOCATO</span>
                                                                )}
                                                            </h4>
                                                            
                                                            <div style={{ display: "grid", gridTemplateColumns: "repeat(4, 1fr)", gap: "8px", margin: "10px 0" }}>
                                                                <div style={{ textAlign: "center" }}>
                                                                    <div style={{ fontSize: "0.8rem", color: "#ccc" }}>âš½ Gol</div>
                                                                    <div style={{ fontSize: "1.2rem", fontWeight: "bold", color: "#FFD700" }}>
                                                                        {giocatore.gol || 0}
                                                                    </div>
                                                                </div>
                                                                <div style={{ textAlign: "center" }}>
                                                                    <div style={{ fontSize: "0.8rem", color: "#ccc" }}>ðŸŽ¯ Assist</div>
                                                                    <div style={{ fontSize: "1.2rem", fontWeight: "bold", color: "#4CAF50" }}>
                                                                        {giocatore.assist || 0}
                                                                    </div>
                                                                </div>
                                                                <div style={{ textAlign: "center" }}>
                                                                    <div style={{ fontSize: "0.8rem", color: "#ccc" }}>â­ Media</div>
                                                                    <div style={{ fontSize: "1.2rem", fontWeight: "bold", color: "#2196F3" }}>
                                                                        {getMediaSicura(giocatore)}
                                                                    </div>
                                                                </div>
                                                                <div style={{ textAlign: "center" }}>
                                                                    <div style={{ fontSize: "0.8rem", color: "#ccc" }}>ðŸ“ˆ WinRate</div>
                                                                    <div style={{ fontSize: "1.2rem", fontWeight: "bold", color: "#FFC107" }}>
                                                                        {statsPartite.winRate}%
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    
                                                    {isAdminUser() && (
                                                        <div style={{ display: "flex", gap: "8px", flexWrap: "wrap", marginTop: "10px" }}>
                                                            <input id={`gol-${giocatore.id}`} type="number" placeholder="Â±Gol" className="number-input"/>
                                                            <button onClick={() => addGolAssist(giocatore.id, 'gol', document.getElementById(`gol-${giocatore.id}`).value)} style={{ padding: "8px 12px", background: "#FFD700", color: "black", border: "none", borderRadius: "8px", cursor: "pointer", fontSize: "12px" }}>Â±âš½</button>
                                                            
                                                            <input id={`assist-${giocatore.id}`} type="number" placeholder="Â±Assist" className="number-input"/>
                                                            <button onClick={() => addGolAssist(giocatore.id, 'assist', document.getElementById(`assist-${giocatore.id}`).value)} style={{ padding: "8px 12px", background: "#4CAF50", color: "white", border: "none", borderRadius: "8px", cursor: "pointer", fontSize: "12px" }}>Â±ðŸŽ¯</button>
                                                            
                                                            <button onClick={() => addMVP(giocatore.id)} style={{ padding: "8px 12px", background: "#FFC107", color: "black", border: "none", borderRadius: "8px", cursor: "pointer", fontSize: "12px" }}>+ðŸ†</button>
                                                            <button onClick={() => rimuoviMVP(giocatore.id)} style={{ padding: "8px 12px", background: "#F44336", color: "white", border: "none", borderRadius: "8px", cursor: "pointer", fontSize: "12px" }} disabled={giocatore.mvp_count <= 0}>-ðŸ†</button>
                                                        </div>
                                                    )}
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>
                        )}

                        {/* TAB PARTITE GIOCATE */}
                        {activeTab === "presenze" && (
                            <div>
                                <h2>ðŸ“Š Partite Giocate</h2>
                                
                                <div className="score-stats-grid">
                                    <div className="score-stat-card">
                                        <div className="score-stat-label">Partite Totali</div>
                                        <div className="score-stat-value">
                                            {stats.partiteTotali}
                                        </div>
                                    </div>
                                    <div className="score-stat-card">
                                        <div className="score-stat-label">Giocatori Attivi</div>
                                        <div className="score-stat-value">
                                            {stats.totaleGiocatori}
                                        </div>
                                    </div>
                                    <div className="score-stat-card">
                                        <div className="score-stat-label">Media Partite/Giocatore</div>
                                        <div className="score-stat-value">
                                            {stats.totaleGiocatori > 0 
                                                ? (stats.partiteGiocate / stats.totaleGiocatori).toFixed(1)
                                                : "0.0"}
                                        </div>
                                    </div>
                                    <div className="score-stat-card">
                                        <div className="score-stat-label">Presenze Totali</div>
                                        <div className="score-stat-value">
                                            {stats.totalePresenze}
                                        </div>
                                    </div>
                                </div>

                                {/* STATISTICHE PARTITE */}
                                <div style={{ marginTop: "30px" }}>
                                    <h3 style={{ marginBottom: "15px", color: "#4CAF50" }}>ðŸ“ˆ Statistiche Partite Giocatori</h3>
                                    
                                    <div className="classifica-grid">
                                        {giocatori
                                            .filter(hasGiocatoAlmenoUnaPartita)
                                            .sort((a, b) => (b.presenze || 0) - (a.presenze || 0))
                                            .map(giocatore => {
                                                const statsPartite = calcolaStatistichePartite(giocatore);
                                                
                                                return (
                                                    <div key={giocatore.id} className="classifica-card">
                                                        <div style={{ display: "flex", alignItems: "center", marginBottom: "10px" }}>
                                                            <div className="classifica-foto">
                                                                <FotoProfiloManager 
                                                                    giocatore={giocatore} 
                                                                    size="small"
                                                                    onFotoCambiata={() => window.location.reload()}
                                                                />
                                                            </div>
                                                            <div style={{ flex: 1 }}>
                                                                <div style={{ display: "flex", justifyContent: "space-between" }}>
                                                                    <strong>{giocatore.nome}</strong>
                                                                    <span style={{ color: "#FFD700", fontWeight: "bold" }}>
                                                                        {statsPartite.partiteGiocate} partite
                                                                    </span>
                                                                </div>
                                                                <div className="winrate-numbers">
                                                                    <span className="winrate-vittorie">âœ… {statsPartite.vittorie}</span>
                                                                    <span className="winrate-sconfitte">âŒ {statsPartite.sconfitte}</span>
                                                                    <span className="winrate-pareggi">âš¡ {statsPartite.pareggi}</span>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        
                                                        {statsPartite.partiteGiocate > 0 ? (
                                                            <>
                                                                <div className="progress-container">
                                                                    <div className="progress-bar-winrate">
                                                                        <div 
                                                                            className="progress-fill-winrate progress-vittorie"
                                                                            style={{ width: `${statsPartite.percentualeVittorie}%` }}
                                                                        >
                                                                            {statsPartite.percentualeVittorie > 15 ? `${statsPartite.percentualeVittorie}%` : ''}
                                                                        </div>
                                                                        <div 
                                                                            className="progress-fill-winrate progress-pareggi"
                                                                            style={{ width: `${statsPartite.percentualePareggi}%` }}
                                                                        >
                                                                            {statsPartite.percentualePareggi > 15 ? `${statsPartite.percentualePareggi}%` : ''}
                                                                        </div>
                                                                        <div 
                                                                            className="progress-fill-winrate progress-sconfitte"
                                                                            style={{ width: `${statsPartite.percentualeSconfitte}%` }}
                                                                        >
                                                                            {statsPartite.percentualeSconfitte > 15 ? `${statsPartite.percentualeSconfitte}%` : ''}
                                                                        </div>
                                                                    </div>
                                                                    <div className="progress-labels">
                                                                        <span>Vittorie</span>
                                                                        <span>Pareggi</span>
                                                                        <span>Sconfitte</span>
                                                                    </div>
                                                                </div>
                                                                
                                                                <div style={{ display: "flex", justifyContent: "space-between", marginTop: "10px" }}>
                                                                    <span style={{ fontSize: "0.8rem", color: "#ccc" }}>
                                                                        WinRate: <strong style={{ color: "#FFD700" }}>{statsPartite.winRate}%</strong>
                                                                    </span>
                                                                    <span style={{ fontSize: "0.8rem", color: "#ccc" }}>
                                                                        Presenze: <strong style={{ color: "#2196F3" }}>{giocatore.presenze || 0}</strong>
                                                                    </span>
                                                                </div>
                                                            </>
                                                        ) : (
                                                            <div style={{ textAlign: 'center', padding: '10px', color: '#888' }}>
                                                                Nessuna statistica partita disponibile
                                                            </div>
                                                        )}
                                                        
                                                        {isAdminUser() && (
                                                            <div style={{ display: "flex", gap: "8px", marginTop: "10px", flexWrap: "wrap" }}>
                                                                <input id={`vittorie-${giocatore.id}`} type="number" placeholder="Â±Vittorie" className="number-input"/>
                                                                <button onClick={() => aggiungiStatPartita(giocatore.id, 'vittorie', document.getElementById(`vittorie-${giocatore.id}`).value)} style={{ padding: "6px 10px", background: "#4CAF50", color: "white", border: "none", borderRadius: "6px", cursor: "pointer", fontSize: "0.7rem" }}>Â±âœ…</button>
                                                                
                                                                <input id={`sconfitte-${giocatore.id}`} type="number" placeholder="Â±Sconfitte" className="number-input"/>
                                                                <button onClick={() => aggiungiStatPartita(giocatore.id, 'sconfitte', document.getElementById(`sconfitte-${giocatore.id}`).value)} style={{ padding: "6px 10px", background: "#F44336", color: "white", border: "none", borderRadius: "6px", cursor: "pointer", fontSize: "0.7rem" }}>Â±âŒ</button>
                                                                
                                                                <input id={`pareggi-${giocatore.id}`} type="number" placeholder="Â±Pareggi" className="number-input"/>
                                                                <button onClick={() => aggiungiStatPartita(giocatore.id, 'pareggi', document.getElementById(`pareggi-${giocatore.id}`).value)} style={{ padding: "6px 10px", background: "#FFC107", color: "black", border: "none", borderRadius: "6px", cursor: "pointer", fontSize: "0.7rem" }}>Â±âš¡</button>
                                                                
                                                                <input id={`presenze-${giocatore.id}`} type="number" placeholder="Â±Presenze" className="number-input"/>
                                                                <button onClick={() => aggiungiPresenza(giocatore.id, document.getElementById(`presenze-${giocatore.id}`).value)} style={{ padding: "6px 10px", background: "#2196F3", color: "white", border: "none", borderRadius: "6px", cursor: "pointer", fontSize: "0.7rem" }}>Â±ðŸ“Š</button>
                                                            </div>
                                                        )}
                                                    </div>
                                                );
                                            })}
                                    </div>
                                </div>

                                {/* STATISTICHE PORTIERE */}
                                <div style={{ marginTop: "40px" }}>
                                    <h3 style={{ marginBottom: "15px", color: "#9C27B0" }}>ðŸ§¤ Statistiche Portieri</h3>
                                    
                                    {giocatori.filter(g => hasGiocatoAlmenoUnaPartita(g) && (g.partite_portiere || 0) > 0).length > 0 ? (
                                        <div className="classifica-grid">
                                            {giocatori
                                                .filter(g => hasGiocatoAlmenoUnaPartita(g) && (g.partite_portiere || 0) > 0)
                                                .map(giocatore => {
                                                    const punteggioBenji = calcolaPunteggioBenjiPrice(giocatore);
                                                    const mediaParate = (giocatore.partite_portiere || 0) > 0 
                                                        ? ((giocatore.parate || 0) / (giocatore.partite_portiere || 1)).toFixed(1)
                                                        : "0.0";
                                                    
                                                    return (
                                                        <div key={giocatore.id} className="classifica-card">
                                                            <div style={{ display: "flex", alignItems: "center", marginBottom: "15px" }}>
                                                                <div className="classifica-foto">
                                                                    <FotoProfiloManager 
                                                                        giocatore={giocatore} 
                                                                        size="small"
                                                                        onFotoCambiata={() => window.location.reload()}
                                                                    />
                                                                </div>
                                                                <div style={{ flex: 1 }}>
                                                                    <div style={{ display: "flex", justifyContent: "space-between" }}>
                                                                        <strong>{giocatore.nome}</strong>
                                                                        <span style={{ background: "#9C27B0", color: "white", padding: "3px 8px", borderRadius: "12px", fontSize: "0.7rem", fontWeight: "bold" }}>
                                                                            {punteggioBenji} pts
                                                                        </span>
                                                                    </div>
                                                                    <div style={{ fontSize: "0.8rem", color: "#ccc", marginTop: "5px" }}>
                                                                        {giocatore.partite_portiere || 0} partite da portiere
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            
                                                            <div className="score-stats-grid" style={{ gridTemplateColumns: "repeat(2, 1fr)" }}>
                                                                <div className="score-stat-card">
                                                                    <div className="score-stat-label">Parate</div>
                                                                    <div className="score-stat-value">{giocatore.parate || 0}</div>
                                                                </div>
                                                                <div className="score-stat-card">
                                                                    <div className="score-stat-label">Media/Partita</div>
                                                                    <div className="score-stat-value">{mediaParate}</div>
                                                                </div>
                                                                <div className="score-stat-card">
                                                                    <div className="score-stat-label">Parate Difficili</div>
                                                                    <div className="score-stat-value">{giocatore.parate_difficili || 0}</div>
                                                                </div>
                                                                <div className="score-stat-card">
                                                                    <div className="score-stat-label">Rigori Parati</div>
                                                                    <div className="score-stat-value">{giocatore.rigori_parati || 0}</div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    );
                                                })}
                                        </div>
                                    ) : (
                                        <div style={{ textAlign: 'center', padding: '20px', color: '#888' }}>
                                            Nessuna statistica portiere disponibile
                                        </div>
                                    )}
                                </div>
                            </div>
                        )}

                        {/* TAB CALENDARIO CON STATISTICHE VITTORIE FAZIONI */}
                        {activeTab === "calendario" && (
                            <div>
                                <h2>ðŸ—“ï¸ Calendario Partite</h2>
                                
                                {/* STATISTICHE VITTORIE FAZIONI */}
                                <div style={{ marginBottom: "30px" }}>
                                    <h3 style={{ marginBottom: "15px", color: "#FFC107" }}>ðŸ“Š Statistiche Vittorie per Fazione</h3>
                                    {(() => {
                                        const vittorieFazioni = calcolaVittorieFazioni();
                                        const totaleVittorie = vittorieFazioni.bianca + vittorieFazioni.nera + vittorieFazioni.rossa;
                                        
                                        return (
                                            <div className="stats-grid">
                                                <div className="stat-card">
                                                    <h3 style={{ color: "#FFFFFF", margin: "0 0 10px 0", fontSize: "1rem" }}>âšª Bianche</h3>
                                                    <p style={{ margin: 0, fontSize: "1.8rem", fontWeight: "bold" }}>{vittorieFazioni.bianca}</p>
                                                    <p style={{ margin: "5px 0 0 0", fontSize: "0.8rem", color: "#ccc" }}>
                                                        {totaleVittorie > 0 ? ((vittorieFazioni.bianca / totaleVittorie) * 100).toFixed(1) : "0"}%
                                                    </p>
                                                </div>
                                                <div className="stat-card">
                                                    <h3 style={{ color: "#000000", margin: "0 0 10px 0", fontSize: "1rem" }}>âš« Nere</h3>
                                                    <p style={{ margin: 0, fontSize: "1.8rem", fontWeight: "bold" }}>{vittorieFazioni.nera}</p>
                                                    <p style={{ margin: "5px 0 0 0", fontSize: "0.8rem", color: "#ccc" }}>
                                                        {totaleVittorie > 0 ? ((vittorieFazioni.nera / totaleVittorie) * 100).toFixed(1) : "0"}%
                                                    </p>
                                                </div>
                                                <div className="stat-card">
                                                    <h3 style={{ color: "#F44336", margin: "0 0 10px 0", fontSize: "1rem" }}>ðŸ”´ Rosse</h3>
                                                    <p style={{ margin: 0, fontSize: "1.8rem", fontWeight: "bold" }}>{vittorieFazioni.rossa}</p>
                                                    <p style={{ margin: "5px 0 0 0", fontSize: "0.8rem", color: "#ccc" }}>
                                                        {totaleVittorie > 0 ? ((vittorieFazioni.rossa / totaleVittorie) * 100).toFixed(1) : "0"}%
                                                    </p>
                                                </div>
                                                <div className="stat-card">
                                                    <h3 style={{ color: "#4CAF50", margin: "0 0 10px 0", fontSize: "1rem" }}>ðŸ† Totale</h3>
                                                    <p style={{ margin: 0, fontSize: "1.8rem", fontWeight: "bold" }}>{totaleVittorie}</p>
                                                    <p style={{ margin: "5px 0 0 0", fontSize: "0.8rem", color: "#ccc" }}>
                                                        {partite.length} partite totali
                                                    </p>
                                                </div>
                                            </div>
                                        );
                                    })()}
                                </div>
                                
                                {/* LISTA PARTITE */}
                                {partite.length > 0 ? (
                                    partite.map(partita => {
                                        const stato = getStatoPartita(partita);
                                        const confermati = partita.confermati || [];
                                        const limite = partita.triangolare ? 15 : 10;
                                        const nomeVisualizzato = getCurrentUserName();
                                        const isConfermato = confermati.includes(nomeVisualizzato);
                                        
                                        return (
                                            <div key={partita.id} className="match-card">
                                                <div style={{ display: "flex", justifyContent: "space-between", alignItems: "flex-start", flexWrap: "wrap" }}>
                                                    <div style={{ flex: 1 }}>
                                                        <h3 style={{ margin: "0 0 10px 0", color: "#4CAF50" }}>
                                                            {formattaData(partita.data)} - {partita.ora}
                                                        </h3>
                                                        <p style={{ margin: "5px 0", color: "#ccc" }}>
                                                            ðŸ“ {partita.luogo || "Campo Arena"}
                                                            {partita.triangolare && " ðŸ”º TRIANGOLARE"}
                                                        </p>
                                                        <div style={{ display: "flex", alignItems: "center", gap: "10px", margin: "10px 0" }}>
                                                            <span style={{ background: stato.colore, color: "white", padding: "5px 10px", borderRadius: "12px", fontSize: "0.8rem", fontWeight: "bold" }}>
                                                                {stato.testo}
                                                            </span>
                                                            <span style={{ color: "#FFC107" }}>
                                                                {confermati.length}/{limite} confermati
                                                            </span>
                                                        </div>
                                                    </div>
                                                    
                                                    <div style={{ display: "flex", gap: "10px", flexWrap: "wrap" }}>
                                                        <button 
                                                            onClick={() => togglePrenotazionePartita(partita.id)}
                                                            style={{ 
                                                                background: isConfermato ? "#F44336" : "#4CAF50",
                                                                color: "white",
                                                                border: "none",
                                                                padding: "10px 15px",
                                                                borderRadius: "8px",
                                                                cursor: "pointer",
                                                                fontWeight: "bold"
                                                            }}
                                                        >
                                                            {isConfermato ? "âŒ Annulla" : "âœ… Conferma"}
                                                        </button>
                                                    </div>
                                                </div>
                                                
                                                {renderRisultatoPartita(partita)}
                                                
                                                <div style={{ marginTop: "15px" }}>
                                                    <h4 style={{ margin: "0 0 10px 0", color: "#FFC107" }}>Gestione Partita:</h4>
                                                    {isAdminUser() ? (
                                                        <div style={{ display: "flex", gap: "10px", flexWrap: "wrap" }}>
                                                            <button onClick={() => impostaRisultatoPartita(partita.id, "Vittoria")} style={{ padding: "8px 12px", background: "#4CAF50", color: "white", border: "none", borderRadius: "6px", cursor: "pointer", fontSize: "0.8rem" }}>âœ… Vittoria</button>
                                                            <button onClick={() => impostaRisultatoPartita(partita.id, "Sconfitta")} style={{ padding: "8px 12px", background: "#F44336", color: "white", border: "none", borderRadius: "6px", cursor: "pointer", fontSize: "0.8rem" }}>âŒ Sconfitta</button>
                                                            <button onClick={() => impostaRisultatoPartita(partita.id, "Pareggio")} style={{ padding: "8px 12px", background: "#FFC107", color: "black", border: "none", borderRadius: "6px", cursor: "pointer", fontSize: "0.8rem" }}>âš¡ Pareggio</button>
                                                            <button onClick={() => impostaTriangolare(partita.id, !partita.triangolare)} style={{ padding: "8px 12px", background: "#2196F3", color: "white", border: "none", borderRadius: "6px", cursor: "pointer", fontSize: "0.8rem" }}>
                                                                {partita.triangolare ? "ðŸ”º Normale" : "ðŸ”º Triangolare"}
                                                            </button>
                                                        </div>
                                                    ) : (
                                                        <p style={{ color: "#888", fontSize: "0.9rem" }}>Solo gli admin possono gestire i risultati</p>
                                                    )}
                                                </div>
                                                
                                                <div className="confermato-list">
                                                    <h4 style={{ margin: "15px 0 10px 0", color: "#FFC107" }}>Giocatori Confermati:</h4>
                                                    {confermati.length > 0 ? (
                                                        confermati.map((nome, index) => (
                                                            <div key={index} className={`confermato-item`}>
                                                                {nome} {nome === nomeVisualizzato && " (TU)"}
                                                            </div>
                                                        ))
                                                    ) : (
                                                        <div style={{ color: '#888', fontStyle: 'italic' }}>
                                                            Nessun giocatore confermato ancora
                                                        </div>
                                                    )}
                                                </div>
                                            </div>
                                        );
                                    })
                                ) : (
                                    <div className="empty-state">
                                        <div className="icon">ðŸ—“ï¸</div>
                                        <h3>Nessuna partita in programma</h3>
                                        <p style={{ marginTop: "10px", color: "#888" }}>
                                            Non ci sono partite programmate al momento. Controlla piÃ¹ tardi!
                                        </p>
                                    </div>
                                )}
                            </div>
                        )}

                        {/* TAB IL MIO SCORE */}
                        {activeTab === "mioscore" && (
                            <div>
                                <h2>â­ Il Mio Score</h2>
                                
                                {(() => {
                                    const currentGiocatore = getCurrentGiocatore();
                                    const miePagelle = getMiePagelle();
                                    const statsPartite = calcolaStatistichePartite(currentGiocatore);
                                    const punteggioBenji = calcolaPunteggioBenjiPrice(currentGiocatore);
                                    
                                    if (!currentGiocatore || !hasGiocatoAlmenoUnaPartita(currentGiocatore)) {
                                        return (
                                            <div className="empty-state">
                                                <div className="icon">ðŸ˜´</div>
                                                <h3>Nessuna Partita Giocata</h3>
                                                <p style={{ marginTop: "10px", color: "#888" }}>
                                                    Non hai ancora giocato nessuna partita. Partecipa alle prossime partite per vedere le tue statistiche!
                                                </p>
                                            </div>
                                        );
                                    }
                                    
                                    return (
                                        <div>
                                            {/* HEADER PROFILO */}
                                            <div className="score-header">
                                                <div style={{ position: 'relative', display: 'inline-block' }}>
                                                    <FotoProfiloManager 
                                                        giocatore={currentGiocatore}
                                                        size="large"
                                                        onFotoCambiata={() => window.location.reload()}
                                                    />
                                                    {currentMVP && currentMVP.id === currentGiocatore.id && (
                                                        <div style={{ 
                                                            position: 'absolute', 
                                                            top: '-10px', 
                                                            right: '-10px', 
                                                            background: '#FFD700', 
                                                            color: 'black', 
                                                            borderRadius: '50%', 
                                                            width: '30px', 
                                                            height: '30px', 
                                                            display: 'flex', 
                                                            alignItems: 'center', 
                                                            justifyContent: 'center',
                                                            fontSize: '1rem',
                                                            fontWeight: 'bold',
                                                            boxShadow: '0 3px 10px rgba(255, 215, 0, 0.5)'
                                                        }}>
                                                            ðŸ‘‘
                                                        </div>
                                                    )}
                                                </div>
                                                <h2 style={{ margin: "15px 0 5px 0", fontSize: "1.8rem" }}>{currentGiocatore.nome}</h2>
                                                <p style={{ color: "#ccc", fontSize: "0.9rem" }}>
                                                    {currentGiocatore.presenze || 0} presenze â€¢ {statsPartite.partiteGiocate} partite giocate
                                                </p>
                                            </div>
                                            
                                            {/* STATISTICHE PRINCIPALI */}
                                            <div className="stats-grid">
                                                <div className="stat-card">
                                                    <h3 style={{ color: "#FFD700", margin: "0 0 10px 0", fontSize: "1rem" }}>âš½ Gol</h3>
                                                    <p style={{ margin: 0, fontSize: "1.8rem", fontWeight: "bold" }}>{currentGiocatore.gol || 0}</p>
                                                </div>
                                                <div className="stat-card">
                                                    <h3 style={{ color: "#4CAF50", margin: "0 0 10px 0", fontSize: "1rem" }}>ðŸŽ¯ Assist</h3>
                                                    <p style={{ margin: 0, fontSize: "1.8rem", fontWeight: "bold" }}>{currentGiocatore.assist || 0}</p>
                                                </div>
                                                <div className="stat-card">
                                                    <h3 style={{ color: "#2196F3", margin: "0 0 10px 0", fontSize: "1rem" }}>â­ Media</h3>
                                                    <p style={{ margin: 0, fontSize: "1.8rem", fontWeight: "bold" }}>{getMediaSicura(currentGiocatore)}</p>
                                                </div>
                                                <div className="stat-card">
                                                    <h3 style={{ color: "#FFC107", margin: "0 0 10px 0", fontSize: "1rem" }}>ðŸ† MVP</h3>
                                                    <p style={{ margin: 0, fontSize: "1.8rem", fontWeight: "bold" }}>{currentGiocatore.mvp_count || 0}</p>
                                                </div>
                                            </div>
                                            
                                            {/* STATISTICHE PARTITE */}
                                            <div style={{ marginTop: "30px" }}>
                                                <h3 style={{ marginBottom: "15px", color: "#4CAF50" }}>ðŸ“Š Statistiche Partite</h3>
                                                
                                                <div className="score-stats-grid">
                                                    <div className="score-stat-card">
                                                        <div className="score-stat-label">Vittorie</div>
                                                        <div className="score-stat-value" style={{ color: "#4CAF50" }}>
                                                            {statsPartite.vittorie}
                                                        </div>
                                                    </div>
                                                    <div className="score-stat-card">
                                                        <div className="score-stat-label">Sconfitte</div>
                                                        <div className="score-stat-value" style={{ color: "#F44336" }}>
                                                            {statsPartite.sconfitte}
                                                        </div>
                                                    </div>
                                                    <div className="score-stat-card">
                                                        <div className="score-stat-label">Pareggi</div>
                                                        <div className="score-stat-value" style={{ color: "#FFC107" }}>
                                                            {statsPartite.pareggi}
                                                        </div>
                                                    </div>
                                                    <div className="score-stat-card">
                                                        <div className="score-stat-label">WinRate</div>
                                                        <div className="score-stat-value" style={{ color: "#FFD700" }}>
                                                            {statsPartite.winRate}
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                {/* PROGRESS BAR WINRATE */}
                                                {statsPartite.partiteGiocate > 0 && (
                                                    <div className="progress-container" style={{ marginTop: "20px" }}>
                                                        <div style={{ display: "flex", justifyContent: "space-between", marginBottom: "5px" }}>
                                                            <span style={{ fontSize: "0.8rem", color: "#ccc" }}>Distribuzione Partite</span>
                                                            <span style={{ fontSize: "0.8rem", color: "#FFD700", fontWeight: "bold" }}>
                                                                {statsPartite.partiteGiocate} partite totali
                                                            </span>
                                                        </div>
                                                        <div className="progress-bar-winrate">
                                                            <div 
                                                                className="progress-fill-winrate progress-vittorie"
                                                                style={{ width: `${statsPartite.percentualeVittorie}%` }}
                                                            >
                                                                {statsPartite.percentualeVittorie > 15 ? `${statsPartite.percentualeVittorie}%` : ''}
                                                            </div>
                                                            <div 
                                                                className="progress-fill-winrate progress-pareggi"
                                                                style={{ width: `${statsPartite.percentualePareggi}%` }}
                                                            >
                                                                {statsPartite.percentualePareggi > 15 ? `${statsPartite.percentualePareggi}%` : ''}
                                                            </div>
                                                            <div 
                                                                className="progress-fill-winrate progress-sconfitte"
                                                                style={{ width: `${statsPartite.percentualeSconfitte}%` }}
                                                            >
                                                                {statsPartite.percentualeSconfitte > 15 ? `${statsPartite.percentualeSconfitte}%` : ''}
                                                            </div>
                                                        </div>
                                                        <div className="progress-labels">
                                                            <span>Vittorie</span>
                                                            <span>Pareggi</span>
                                                            <span>Sconfitte</span>
                                                        </div>
                                                    </div>
                                                )}
                                            </div>
                                            
                                            {/* STATISTICHE PORTIERE */}
                                            {(currentGiocatore.partite_portiere || 0) > 0 && (
                                                <div style={{ marginTop: "30px" }}>
                                                    <h3 style={{ marginBottom: "15px", color: "#9C27B0" }}>ðŸ§¤ Statistiche da Portiere</h3>
                                                    
                                                    <div className="score-stats-grid">
                                                        <div className="score-stat-card">
                                                            <div className="score-stat-label">Partite Portiere</div>
                                                            <div className="score-stat-value">{currentGiocatore.partite_portiere || 0}</div>
                                                        </div>
                                                        <div className="score-stat-card">
                                                            <div className="score-stat-label">Parate Totali</div>
                                                            <div className="score-stat-value">{currentGiocatore.parate || 0}</div>
                                                        </div>
                                                        <div className="score-stat-card">
                                                            <div className="score-stat-label">Parate Difficili</div>
                                                            <div className="score-stat-value">{currentGiocatore.parate_difficili || 0}</div>
                                                        </div>
                                                        <div className="score-stat-card">
                                                            <div className="score-stat-label">Benji Price</div>
                                                            <div className="score-stat-value" style={{ color: "#9C27B0" }}>
                                                                {punteggioBenji} pts
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            )}
                                            
                                            {/* LE MIE PAGELLE */}
                                            <div style={{ marginTop: "30px" }}>
                                                <h3 style={{ marginBottom: "15px", color: "#FFC107" }}>ðŸ“ Le Mie Ultime Pagelle</h3>
                                                
                                                {miePagelle.length === 0 ? (
                                                    <div style={{ textAlign: 'center', padding: '20px', color: '#888' }}>
                                                        Non hai ancora ricevuto pagelle. Continua a giocare!
                                                    </div>
                                                ) : (
                                                    <div>
                                                        {miePagelle.slice(0, 5).map(pagella => (
                                                            <div key={pagella.id} className={`pagella-card ${getClasseFazione(pagella.fazione)}`}>
                                                                <div className="pagella-header">
                                                                    <div>
                                                                        <div className="pagella-data">
                                                                            Valutato da {pagella.autore || "Vitantonio"} il {pagella.data}
                                                                        </div>
                                                                        {getBadgeFazione(pagella.fazione)}
                                                                        {getBadgeCoppa(pagella)}
                                                                    </div>
                                                                    <div className="pagella-voto">
                                                                        {pagella.voto}/10
                                                                    </div>
                                                                </div>
                                                                
                                                                {pagella.commento && (
                                                                    <div className="pagella-commento">
                                                                        "{pagella.commento}"
                                                                    </div>
                                                                )}
                                                            </div>
                                                        ))}
                                                        
                                                        {miePagelle.length > 5 && (
                                                            <div style={{ textAlign: "center", marginTop: "15px" }}>
                                                                <p style={{ color: "#ccc", fontSize: "0.9rem" }}>
                                                                    + {miePagelle.length - 5} altre pagelle...
                                                                </p>
                                                            </div>
                                                        )}
                                                    </div>
                                                )}
                                            </div>
                                            
                                            {/* POSIZIONE IN CLASSIFICA */}
                                            <div style={{ marginTop: "30px" }}>
                                                <h3 style={{ marginBottom: "15px", color: "#00BCD4" }}>ðŸ… La Tua Posizione</h3>
                                                
                                                <div className="classifica-grid">
                                                    {/* POSIZIONE NELLA CLASSIFICA MEDIA VOTO */}
                                                    <div className="classifica-card">
                                                        <h4 style={{ marginBottom: "10px", color: "#2196F3" }}>â­ Media Voto</h4>
                                                        {(() => {
                                                            const posizione = classificaMediaVoto.findIndex(g => g.id === currentGiocatore.id);
                                                            return posizione >= 0 ? (
                                                                <div style={{ display: "flex", alignItems: "center", padding: "10px" }}>
                                                                    <div className={`classifica-pos ${posizione === 0 ? 'oro' : posizione === 1 ? 'argento' : posizione === 2 ? 'bronzo' : ''}`}>
                                                                        {posizione + 1}
                                                                    </div>
                                                                    <div style={{ flex: 1, marginLeft: "10px" }}>
                                                                        <div style={{ fontWeight: "bold" }}>{currentGiocatore.nome}</div>
                                                                        <div style={{ fontSize: "0.8rem", color: "#ccc" }}>
                                                                            Media: {getMediaSicura(currentGiocatore)}/10
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            ) : (
                                                                <div style={{ textAlign: "center", padding: "20px", color: "#888" }}>
                                                                    Non ancora in classifica
                                                                </div>
                                                            );
                                                        })()}
                                                    </div>
                                                    
                                                    {/* POSIZIONE NELLA CLASSIFICA WINRATE */}
                                                    <div className="classifica-card">
                                                        <h4 style={{ marginBottom: "10px", color: "#4CAF50" }}>ðŸ“ˆ WinRate</h4>
                                                        {(() => {
                                                            const posizione = classificaWinrate.findIndex(g => g.id === currentGiocatore.id);
                                                            return posizione >= 0 ? (
                                                                <div style={{ display: "flex", alignItems: "center", padding: "10px" }}>
                                                                    <div className={`classifica-pos ${posizione === 0 ? 'oro' : posizione === 1 ? 'argento' : posizione === 2 ? 'bronzo' : ''}`}>
                                                                        {posizione + 1}
                                                                    </div>
                                                                    <div style={{ flex: 1, marginLeft: "10px" }}>
                                                                        <div style={{ fontWeight: "bold" }}>{currentGiocatore.nome}</div>
                                                                        <div style={{ fontSize: "0.8rem", color: "#ccc" }}>
                                                                            WinRate: {statsPartite.winRate}
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            ) : (
                                                                <div style={{ textAlign: "center", padding: "20px", color: "#888" }}>
                                                                    Non ancora in classifica
                                                                </div>
                                                            );
                                                        })()}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    );
                                })()}
                            </div>
                        )}

                        {/* TAB CHAT */}
                        {activeTab === "chat" && (
                            <div>
                                <h2>ðŸ’¬ Chat di Gruppo</h2>
                                
                                <div 
                                    ref={chatContainerRef}
                                    style={{ 
                                        height: "400px", 
                                        overflowY: "auto", 
                                        marginBottom: "20px",
                                        padding: "10px",
                                        background: "rgba(255,255,255,0.05)",
                                        borderRadius: "12px"
                                    }}
                                >
                                    {messaggi.length > 0 ? (
                                        messaggi.map(msg => {
                                            const isOwn = msg.mittente === loginForm.username;
                                            const isAdminMsg = msg.mittente === "admin" || msg.mittente === "vitantonio";
                                            const mittenteVisualizzato = msg.mittente_visualizzato || 
                                                (msg.mittente === "admin" ? "Vitantonio" : 
                                                 msg.mittente === "fabrizio" ? "Fabrizio" : msg.mittente);
                                            
                                            return (
                                                <div key={msg.id} className={`message-bubble ${isOwn ? 'own-message' : ''} ${isAdminMsg ? 'admin-message' : ''}`}>
                                                    <div style={{ display: "flex", justifyContent: "space-between", alignItems: "flex-start", marginBottom: "5px" }}>
                                                        <strong style={{ color: isOwn ? "#4CAF50" : isAdminMsg ? "#FFC107" : "#2196F3" }}>
                                                            {mittenteVisualizzato}
                                                            {isAdminMsg && " ðŸ‘‘"}
                                                        </strong>
                                                        <span style={{ fontSize: "0.7rem", color: "#ccc" }}>
                                                            {new Date(msg.timestamp).toLocaleTimeString('it-IT', { 
                                                                hour: '2-digit', minute: '2-digit' 
                                                            })}
                                                        </span>
                                                    </div>
                                                    <div style={{ wordBreak: "break-word" }}>
                                                        {msg.messaggio}
                                                    </div>
                                                </div>
                                            );
                                        })
                                    ) : (
                                        <div style={{ textAlign: 'center', padding: '20px', color: '#888' }}>
                                            Nessun messaggio nella chat. Sii il primo a scrivere!
                                        </div>
                                    )}
                                </div>
                                
                                <div style={{ display: "flex", gap: "10px" }}>
                                    <input 
                                        type="text"
                                        placeholder="Scrivi un messaggio..."
                                        value={nuovoMessaggio}
                                        onChange={(e) => setNuovoMessaggio(e.target.value)}
                                        onKeyPress={(e) => e.key === 'Enter' && inviaMessaggio()}
                                        style={{ flex: 1, padding: "12px", borderRadius: "8px", border: "1px solid rgba(255,255,255,0.2)", background: "rgba(255,255,255,0.1)", color: "white" }}
                                    />
                                    <button 
                                        onClick={inviaMessaggio}
                                        style={{ 
                                            background: "#4CAF50",
                                            color: "white",
                                            border: "none",
                                            padding: "15px 20px",
                                            borderRadius: "8px",
                                            cursor: "pointer",
                                            fontWeight: "bold"
                                        }}
                                    >
                                        Invia
                                    </button>
                                </div>
                            </div>
                        )}

                        {/* TAB PAGELLE */}
                        {activeTab === "pagelle" && (
                            <div>
                                <h2>ðŸ“ Sistema Pagelle</h2>
                                
                                {isAdminUser() && (
                                    <div className="pagella-form">
                                        <h3 style={{ marginBottom: "15px", color: "#FFC107" }}>Aggiungi Nuova Pagella</h3>
                                        
                                        <div style={{ display: "flex", gap: "10px", flexWrap: "wrap", marginBottom: "15px" }}>
                                            <select value={nuovaPagella.giocatore} onChange={(e) => setNuovaPagella(prev => ({ ...prev, giocatore: e.target.value }))} className="giocatore-select">
                                                <option value="">Seleziona Giocatore</option>
                                                {giocatori.map(g => <option key={g.id} value={g.nome}>{g.nome}</option>)}
                                            </select>
                                            
                                            <select value={nuovaPagella.voto} onChange={(e) => setNuovaPagella(prev => ({ ...prev, voto: e.target.value }))} className="voto-select">
                                                <option value="">Voto</option>
                                                {[1, 1.5, 2, 2.5, 3, 3.5, 4, 4.5, 5, 5.5, 6, 6.5, 7, 7.5, 8, 8.5, 9, 9.5, 10].map(voto => (
                                                    <option key={voto} value={voto}>{voto}</option>
                                                ))}
                                            </select>
                                            
                                            <select value={nuovaPagella.fazione} onChange={(e) => setNuovaPagella(prev => ({ ...prev, fazione: e.target.value }))} className="fazione-select">
                                                <option value="nessuna">Senza Fazione</option>
                                                <option value="bianca">âšª Bianca</option>
                                                <option value="nera">âš« Nera</option>
                                                <option value="rossa">ðŸ”´ Rossa</option>
                                            </select>
                                        </div>
                                        
                                        <textarea 
                                            placeholder="Commento (opzionale)"
                                            value={nuovaPagella.commento}
                                            onChange={(e) => setNuovaPagella(prev => ({ ...prev, commento: e.target.value }))}
                                            rows="4"
                                            className="pagella-textarea"
                                        />
                                        
                                        <div className="pagella-actions">
                                            <button 
                                                onClick={aggiungiPagella}
                                                style={{ 
                                                    background: "#4CAF50",
                                                    color: "white",
                                                    border: "none",
                                                    padding: "12px 20px",
                                                    borderRadius: "8px",
                                                    cursor: "pointer",
                                                    fontWeight: "bold"
                                                }}
                                            >
                                                âž• Aggiungi Pagella
                                            </button>
                                        </div>
                                    </div>
                                )}

                                <h3 style={{ marginTop: "30px", marginBottom: "15px" }}>Ultime Pagelle</h3>
                                {pagelle.length > 0 ? (
                                    pagelle.map((pagella, index) => {
                                        const showSeparator = index % 10 === 0;
                                        const groupNumber = Math.floor(index / 10) + 1;
                                        
                                        return (
                                            <React.Fragment key={pagella.id}>
                                                {showSeparator && (
                                                    <div className="pagella-group-header">
                                                        ðŸ“Š Gruppo {groupNumber} - Pagelle da {index + 1} a {Math.min(index + 10, pagelle.length)}
                                                    </div>
                                                )}
                                                
                                                <div className={`pagella-card ${getClasseFazione(pagella.fazione)}`}>
                                                    <div className="pagella-header">
                                                        <div>
                                                            <div className="pagella-giocatore">
                                                                {pagella.giocatore}
                                                                {getBadgeFazione(pagella.fazione)}
                                                                {getBadgeCoppa(pagella)}
                                                            </div>
                                                            <div className="pagella-data">
                                                                Valutato da {pagella.autore || "Vitantonio"} il {pagella.data}
                                                            </div>
                                                        </div>
                                                        <div className="pagella-voto">
                                                            {pagella.voto}/10
                                                        </div>
                                                    </div>
                                                    
                                                    {pagella.commento && (
                                                        <div className="pagella-commento">
                                                            "{pagella.commento}"
                                                        </div>
                                                    )}
                                                </div>
                                            </React.Fragment>
                                        );
                                    })
                                ) : (
                                    <div className="empty-state">
                                        <div className="icon">ðŸ“„</div>
                                        <h3>Nessuna Pagella</h3>
                                        <p style={{ marginTop: "10px", color: "#888" }}>
                                            Non ci sono ancora pagelle. Inizia a valutare i giocatori!
                                        </p>
                                    </div>
                                )}
                            </div>
                        )}

                        {/* TAB BACKUP */}
                        {activeTab === "backup" && isAdminUser() && (
                            <div>
                                <h2>ðŸ’¾ Sistema di Backup</h2>
                                
                                <div className="backup-section">
                                    <h3 style={{ marginBottom: "15px", color: "#4CAF50" }}>ðŸ“Š Dati Correnti</h3>
                                    <div className="backup-stats">
                                        <div className="backup-stat">
                                            <div style={{ fontSize: "0.8rem", color: "#ccc" }}>ðŸ‘¥ Giocatori</div>
                                            <div style={{ fontSize: "1.5rem", fontWeight: "bold", color: "#FFD700" }}>
                                                {giocatori.length}
                                            </div>
                                        </div>
                                        <div className="backup-stat">
                                            <div style={{ fontSize: "0.8rem", color: "#ccc" }}>ðŸ’¬ Messaggi</div>
                                            <div style={{ fontSize: "1.5rem", fontWeight: "bold", color: "#4CAF50" }}>
                                                {messaggi.length}
                                            </div>
                                        </div>
                                        <div className="backup-stat">
                                            <div style={{ fontSize: "0.8rem", color: "#ccc" }}>ðŸ—“ï¸ Partite</div>
                                            <div style={{ fontSize: "1.5rem", fontWeight: "bold", color: "#2196F3" }}>
                                                {partite.length}
                                            </div>
                                        </div>
                                        <div className="backup-stat">
                                            <div style={{ fontSize: "0.8rem", color: "#ccc" }}>ðŸ“ Pagelle</div>
                                            <div style={{ fontSize: "1.5rem", fontWeight: "bold", color: "#9C27B0" }}>
                                                {pagelle.length}
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div className="backup-section">
                                    <h3 style={{ marginBottom: "15px", color: "#2196F3" }}>ðŸ› ï¸ Azioni Backup</h3>
                                    
                                    <div className="backup-actions">
                                        <button onClick={esportaBackup} className="btn-backup export">ðŸ“¥ Esporta Backup</button>
                                        
                                        <label htmlFor="file-input" className="file-input-label">ðŸ“¤ Importa Backup</label>
                                        <input id="file-input" ref={fileInputRef} type="file" accept=".json" onChange={importaBackup} className="file-input"/>
                                        
                                        <button onClick={puliziaDati} className="btn-backup danger">ðŸ—‘ï¸ Pulizia Dati</button>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>

                    {/* MOBILE NAV */}
                    <div className="app-bottom-nav">
                        <button className={`nav-button ${activeTab === "classifica" ? "active" : ""}`} onClick={() => setActiveTab("classifica")}><span className="icon">ðŸ†</span><span>Classifica</span></button>
                        <button className={`nav-button ${activeTab === "calendario" ? "active" : ""}`} onClick={() => setActiveTab("calendario")}><span className="icon">ðŸ—“ï¸</span><span>Calendario</span></button>
                        <button className={`nav-button ${activeTab === "presenze" ? "active" : ""}`} onClick={() => setActiveTab("presenze")}><span className="icon">ðŸ“Š</span><span>Partite</span></button>
                        <button className={`nav-button ${activeTab === "mioscore" ? "active" : ""}`} onClick={() => setActiveTab("mioscore")}><span className="icon">â­</span><span>Il Mio Score</span></button>
                        <button className={`nav-button ${activeTab === "chat" ? "active" : ""}`} onClick={() => setActiveTab("chat")}><span className="icon">ðŸ’¬</span><span>Chat</span></button>
                        <button className={`nav-button ${activeTab === "pagelle" ? "active" : ""}`} onClick={() => setActiveTab("pagelle")}><span className="icon">ðŸ“</span><span>Pagelle</span></button>
                        {isAdminUser() && <button className={`nav-button ${activeTab === "backup" ? "active" : ""}`} onClick={() => setActiveTab("backup")}><span className="icon">ðŸ’¾</span><span>Backup</span></button>}
                    </div>
                </div>
            );
        }

        // ðŸš€ AVVIA APP
        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>